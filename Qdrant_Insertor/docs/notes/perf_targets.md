# 性能与 SLA 备忘

本文档记录了系统在性能方面的目标（Performance Targets）和服务等级协议（SLA）备忘，作为开发和运维的参考。这些指标将指导性能优化工作，并作为系统健康状况的衡量标准。

## 1. 核心 API 性能目标

| API 端点       | 指标     | 目标值       | 备注                                                         |
| :------------- | :------- | :----------- | :----------------------------------------------------------- |
| `POST /upload` | 平均延迟 | < 500ms   | 单文件上传（例如 1MB 文档），不包含 Embedding 时间。         |
|                | QPS      | 待定         | 考虑并发上传场景。                                           |
| `GET /search`  | 平均延迟 | < 100ms   | 包含关键词搜索和向量搜索，RRF 融合。                         |
|                | P95 延迟 | < 200ms   | 95% 的请求应在此时间内完成。                                 |
|                | QPS      | 待定         | 考虑并发搜索场景。                                           |
| `GET /healthz` | 平均延迟 | < 10ms    | 快速响应，用于负载均衡器健康检查。                           |
| `DELETE /doc/:id` | 平均延迟 | < 100ms   | 触发同步状态机进行清理，不包含实际清理完成时间。             |

## 2. 文档处理性能目标

| 流程环节       | 指标     | 目标值       | 备注                                                         |
| :------------- | :------- | :----------- | :----------------------------------------------------------- |
| 文件加载       | 速度     | 待定         | 例如，10MB PDF 文件加载时间。                                |
| 文本切片       | 速度     | 待定         | 例如，10MB 文本切片为 1000 个 Chunk 的时间。                 |
| Embedding 生成 | 速度     | 待定         | 主要受限于外部 Embedding API 的限速和网络延迟。              |
|                | 批量大小 | 待定         | 每次 API 调用发送的文本块数量。                              |
| Qdrant 写入    | 速度     | 待定         | 例如，每秒写入 1000 个向量。                                 |
| SQLite 写入    | 速度     | 待定         | 例如，每秒写入 1000 条元数据记录。                           |

## 3. 系统容量与规模

*   **单 Collection 文档上限**：预计支持约 300 个文档。
*   **单 Collection 文本块上限**：预计支持约 10k 个文本块。
*   **总文档数量**：待定。
*   **总向量数量**：待定。

## 4. 服务等级协议 (SLA) 备忘

*   **可用性 (Availability)**：
    *   API 服务：99.9% (每月停机时间不超过 43.2 分钟)
    *   Qdrant 数据库：99.9%
    *   SQLite 数据库：99.9%
*   **数据一致性**：
    *   Qdrant 与 SQLite 最终一致性：`AutoGC` 模块确保在 24 小时内修复所有不一致数据。
*   **数据持久性**：
    *   所有上传的文档和生成的向量数据应具有高持久性，通过定期备份和冗余存储实现。