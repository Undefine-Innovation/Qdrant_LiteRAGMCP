[{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\contracts\\batch.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\contracts\\collection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\contracts\\document.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\contracts\\error.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\contracts\\monitoring.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\contracts\\preview.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\contracts\\scrape.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\contracts\\search.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\middleware\\db-connection-check.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\middleware\\error-handler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\monitoring.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\routes\\batch.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\routes\\collections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\routes\\common.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\routes\\documents.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\routes\\graph.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\routes\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\routes\\preview.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\routes\\scrape.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\routes\\search.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\api\\swagger\\swagger-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\app.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\core\\Pipeline.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\core\\Step.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\core\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\schemas\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\steps\\EmbedStep.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\steps\\ImportStep.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\steps\\IndexStep.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\steps\\RerankStep.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\steps\\RetrievalStep.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\steps\\SplitStep.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\orchestration\\steps\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\alerting\\AlertNotificationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\alerting\\AlertRuleManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\alerting\\AlertService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\alerting\\AlertServiceCore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\alerting\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\api\\AlertApiService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\api\\MonitoringApiService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\api\\MonitoringApiServiceCore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\api\\NotificationApiService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\api\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\batch\\BatchService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\batch\\ImportService.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4190,4193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4190,4193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8901,8904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8901,8904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":561,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":561,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17692,17695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17692,17695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\batch\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\core\\CollectionService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\core\\DocumentService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\core\\GraphService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\core\\SearchService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\core\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\file-processing\\ContentConverter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\file-processing\\EnhancedFileProcessingService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\file-processing\\FileFormatDetector.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\file-processing\\FileProcessingService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\file-processing\\ThumbnailGenerator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\file-processing\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\monitoring\\HealthCheckService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\monitoring\\MetricsService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\monitoring\\MonitoringService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\monitoring\\MonitoringServiceCore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\monitoring\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\scraping\\ScrapeService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\scraping\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\state-machine\\StateMachineService.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2247,2250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2247,2250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":"访问引擎私有属性"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\state-machine\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\sync\\DocumentSyncProcessor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\sync\\PersistentSyncStateMachine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\sync\\SyncErrorHandler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\sync\\SyncJobManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\sync\\SyncStateMachine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\sync\\SyncStateMachineCore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\sync\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\system\\AutoGCService.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4003,4006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4003,4006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\services\\system\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\use-cases\\ImportAndIndexUseCase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\application\\use-cases\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\aggregates\\AggregateBusinessRules.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\aggregates\\AggregateFactory.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\aggregates\\AggregateRoot.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\aggregates\\CollectionAggregate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\aggregates\\DocumentAggregate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\aggregates\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\constants\\FileConstants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\entities\\Chunk.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\entities\\Collection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\entities\\Doc.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\entities\\embedding.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\entities\\graph.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\entities\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\entities\\scrape.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\entities\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\errors\\ErrorFactory.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\events\\DomainEvents.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\events\\EventHandlerBase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\events\\EventHandlers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\events\\EventPublisher.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\events\\EventStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\events\\EventSystemFactory.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\events\\IDomainEventInterface.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\events\\IEventPublisher.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\events\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IAggregateRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IAlertService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IAutoGCService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IBatchService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\ICollectionService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IDocumentService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IFileProcessingService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IImportService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IKeywordRetriever.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IMonitoringApiService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IMonitoringService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IQdrantRepo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\ISQLiteRepo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\ISearchService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\IStateMachineService.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[364,367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[364,367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\ITransactionManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\repositories\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\CollectionManagementService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\DocumentProcessingService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\EmbeddingGenerationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\EventSystemService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\SearchService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\SearchTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\ValueObjectExampleService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\fileProcessor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\loader.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\splitter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\services\\stream-loader.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\state-machine\\BaseStateMachineEngine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\state-machine\\BaseStateMachineStrategy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\state-machine\\BatchUploadStrategy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\state-machine\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\state-machine\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\sync\\ErrorClassifier.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\sync\\RetryScheduler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\sync\\RetrySchedulerInterface.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\sync\\RetryUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\sync\\SyncJobStatusMapper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\sync\\retry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\sync\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\use-cases\\IImportAndIndexUseCase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\use-cases\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\utils\\id.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\value-objects\\ChunkContent.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\value-objects\\CollectionIdGenerator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\value-objects\\CollectionName.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\value-objects\\DocIdGenerator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\value-objects\\DocumentContent.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\value-objects\\EmbeddingVector.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\value-objects\\base.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\domain\\value-objects\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\generated\\api-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\generated\\api-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\generated\\graphql-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\generated\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\generated\\statechart-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\cache\\CacheStrategy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\cache\\QueryCache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\config\\config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\ConnectionPoolConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\cache\\QueryCache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\AlertHistory.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\AlertRules.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\BaseEntity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\Chunk.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\ChunkFullText.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\ChunkMeta.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\Collection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\Doc.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\Event.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\ScrapeResults.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\SyncJob.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\SystemHealth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\SystemMetrics.ts","messages":[{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options\" declaration.","line":137,"column":3,"nodeType":"Block","endLine":140,"endColumn":6,"fix":{"range":[2335,2381],"text":"/**\r\n   * 创建指标记录\r\n   * 静态方法用于创建标准化的指标记录\r\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.name\" declaration.","line":137,"column":3,"nodeType":"Block","endLine":140,"endColumn":6,"fix":{"range":[2335,2381],"text":"/**\r\n   * 创建指标记录\r\n   * 静态方法用于创建标准化的指标记录\r\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.value\" declaration.","line":137,"column":3,"nodeType":"Block","endLine":140,"endColumn":6,"fix":{"range":[2335,2381],"text":"/**\r\n   * 创建指标记录\r\n   * 静态方法用于创建标准化的指标记录\r\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.unit\" declaration.","line":137,"column":3,"nodeType":"Block","endLine":140,"endColumn":6,"fix":{"range":[2335,2381],"text":"/**\r\n   * 创建指标记录\r\n   * 静态方法用于创建标准化的指标记录\r\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.type\" declaration.","line":137,"column":3,"nodeType":"Block","endLine":140,"endColumn":6,"fix":{"range":[2335,2381],"text":"/**\r\n   * 创建指标记录\r\n   * 静态方法用于创建标准化的指标记录\r\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.tags\" declaration.","line":137,"column":3,"nodeType":"Block","endLine":140,"endColumn":6,"fix":{"range":[2335,2381],"text":"/**\r\n   * 创建指标记录\r\n   * 静态方法用于创建标准化的指标记录\r\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.source\" declaration.","line":137,"column":3,"nodeType":"Block","endLine":140,"endColumn":6,"fix":{"range":[2335,2381],"text":"/**\r\n   * 创建指标记录\r\n   * 静态方法用于创建标准化的指标记录\r\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.description\" declaration.","line":137,"column":3,"nodeType":"Block","endLine":140,"endColumn":6,"fix":{"range":[2335,2381],"text":"/**\r\n   * 创建指标记录\r\n   * 静态方法用于创建标准化的指标记录\r\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.timestamp\" declaration.","line":137,"column":3,"nodeType":"Block","endLine":140,"endColumn":6,"fix":{"range":[2335,2381],"text":"/**\r\n   * 创建指标记录\r\n   * 静态方法用于创建标准化的指标记录\r\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   * @param options\n   * @param options.name\n   * @param options.value\n   * @param options.unit\n   * @param options.type\n   * @param options.tags\n   * @param options.source\n   * @param options.description\n   * @param options.timestamp\n   */"}},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":137,"column":3,"nodeType":"Block","endLine":140,"endColumn":6},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":167,"column":3,"nodeType":"Block","endLine":169,"endColumn":6},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"tags\" declaration.","line":182,"column":3,"nodeType":"Block","endLine":184,"endColumn":6,"fix":{"range":[3355,3378],"text":"/**\r\n   * 设置标签对象\r\n   * @param tags\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"key\" declaration.","line":190,"column":3,"nodeType":"Block","endLine":192,"endColumn":6,"fix":{"range":[3518,3539],"text":"/**\r\n   * 添加标签\r\n   * @param key\n   * @param value\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"value\" declaration.","line":190,"column":3,"nodeType":"Block","endLine":192,"endColumn":6,"fix":{"range":[3518,3539],"text":"/**\r\n   * 添加标签\r\n   * @param key\n   * @param value\n   * @param key\n   * @param value\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"key\" declaration.","line":199,"column":3,"nodeType":"Block","endLine":201,"endColumn":6,"fix":{"range":[3697,3718],"text":"/**\r\n   * 移除标签\r\n   * @param key\n   */"}},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":210,"column":3,"nodeType":"Block","endLine":212,"endColumn":6},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":217,"column":3,"nodeType":"Block","endLine":219,"endColumn":6},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":224,"column":3,"nodeType":"Block","endLine":226,"endColumn":6},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"delta\" declaration.","line":231,"column":3,"nodeType":"Block","endLine":233,"endColumn":6,"fix":{"range":[4222,4245],"text":"/**\r\n   * 增加计数器值\r\n   * @param delta\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"value\" declaration.","line":241,"column":3,"nodeType":"Block","endLine":243,"endColumn":6,"fix":{"range":[4411,4434],"text":"/**\r\n   * 设置仪表盘值\r\n   * @param value\n   */"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":15,"source":"import { Entity, Column, Index, Check } from 'typeorm';\r\nimport { BaseEntity } from './BaseEntity.js';\r\n\r\n/**\r\n * 系统指标实体\r\n * 对应数据库中的system_metrics表\r\n * 优化了索引、约束和查询性能\r\n */\r\n@Entity('system_metrics')\r\n@Index(['metric_name', 'timestamp'])\r\n@Index(['metric_name'])\r\n@Index(['timestamp'])\r\n@Index(['metric_name', 'timestamp', 'tags'])\r\n@Check(`metric_name IS NOT NULL AND metric_name != ''`)\r\n@Check(`LENGTH(metric_name) <= 255`)\r\n@Check(`metric_unit IS NULL OR LENGTH(metric_unit) <= 50`)\r\nexport class SystemMetrics extends BaseEntity {\r\n  /**\r\n   * 指标名称\r\n   * 添加长度约束和验证\r\n   */\r\n  @Column({\r\n    type: 'varchar',\r\n    length: 255,\r\n    nullable: false,\r\n    comment: '指标名称',\r\n  })\r\n  metric_name: string;\r\n\r\n  /**\r\n   * 指标值\r\n   * 添加数值范围约束\r\n   */\r\n  @Column({\r\n    type: 'real',\r\n    nullable: false,\r\n    comment: '指标数值',\r\n  })\r\n  metric_value: number;\r\n\r\n  /**\r\n   * 指标单位\r\n   * 添加长度限制\r\n   */\r\n  @Column({\r\n    type: 'varchar',\r\n    length: 50,\r\n    nullable: true,\r\n    comment: '指标单位',\r\n  })\r\n  metric_unit?: string;\r\n\r\n  /**\r\n   * 指标类型\r\n   * 区分不同类型的指标\r\n   */\r\n  @Column({\r\n    type: 'varchar',\r\n    length: 20,\r\n    default: 'gauge',\r\n    nullable: false,\r\n    comment: '指标类型：gauge/counter/histogram',\r\n  })\r\n  metric_type: 'gauge' | 'counter' | 'histogram' = 'gauge';\r\n\r\n  /**\r\n   * 标签（JSON格式）\r\n   * 添加长度限制\r\n   */\r\n  @Column({\r\n    type: 'text',\r\n    nullable: true,\r\n    comment: '指标标签，JSON格式',\r\n  })\r\n  tags?: string;\r\n\r\n  /**\r\n   * 时间戳\r\n   * 添加索引和约束\r\n   */\r\n  @Column({\r\n    type: 'bigint',\r\n    nullable: false,\r\n    transformer: {\r\n      to: (value: number) => value,\r\n      from: (value: string) => parseInt(value, 10),\r\n    },\r\n    comment: '指标时间戳（毫秒）',\r\n  })\r\n  timestamp: number;\r\n\r\n  /**\r\n   * 指标来源\r\n   * 标识指标来源的组件或服务\r\n   */\r\n  @Column({\r\n    type: 'varchar',\r\n    length: 100,\r\n    nullable: true,\r\n    comment: '指标来源',\r\n  })\r\n  source?: string;\r\n\r\n  /**\r\n   * 指标描述\r\n   */\r\n  @Column({\r\n    type: 'text',\r\n    nullable: true,\r\n    comment: '指标描述',\r\n  })\r\n  description?: string;\r\n\r\n  /**\r\n   * 采样率\r\n   * 用于histogram类型指标\r\n   */\r\n  @Column({\r\n    type: 'real',\r\n    nullable: true,\r\n    comment: '采样率',\r\n  })\r\n  sample_rate?: number;\r\n\r\n  /**\r\n   * 分位数\r\n   * 用于histogram类型指标\r\n   */\r\n  @Column({\r\n    type: 'varchar',\r\n    length: 10,\r\n    nullable: true,\r\n    comment: '分位数（如p50, p95, p99）',\r\n  })\r\n  quantile?: string;\r\n\r\n  /**\r\n   * 创建指标记录\r\n   * 静态方法用于创建标准化的指标记录\r\n   */\r\n  static createMetric(options: {\r\n    name: string;\r\n    value: number;\r\n    unit?: string;\r\n    type?: 'gauge' | 'counter' | 'histogram';\r\n    tags?: Record<string, string>;\r\n    source?: string;\r\n    description?: string;\r\n    timestamp?: number;\r\n  }): SystemMetrics {\r\n    const metric = new SystemMetrics();\r\n    metric.metric_name = options.name;\r\n    metric.metric_value = options.value;\r\n    metric.metric_unit = options.unit;\r\n    metric.metric_type = options.type || 'gauge';\r\n    metric.source = options.source;\r\n    metric.description = options.description;\r\n    metric.timestamp = options.timestamp || Date.now();\r\n\r\n    if (options.tags) {\r\n      metric.tags = JSON.stringify(options.tags);\r\n    }\r\n\r\n    return metric;\r\n  }\r\n\r\n  /**\r\n   * 获取标签对象\r\n   */\r\n  getTagsObject(): Record<string, string> | null {\r\n    if (!this.tags) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      return JSON.parse(this.tags);\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置标签对象\r\n   */\r\n  setTagsObject(tags: Record<string, string>): void {\r\n    this.tags = JSON.stringify(tags);\r\n    this.updated_at = Date.now();\r\n  }\r\n\r\n  /**\r\n   * 添加标签\r\n   */\r\n  addTag(key: string, value: string): void {\r\n    const tags = this.getTagsObject() || {};\r\n    tags[key] = value;\r\n    this.setTagsObject(tags);\r\n  }\r\n\r\n  /**\r\n   * 移除标签\r\n   */\r\n  removeTag(key: string): void {\r\n    const tags = this.getTagsObject();\r\n    if (tags && tags[key]) {\r\n      delete tags[key];\r\n      this.setTagsObject(tags);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查是否为计数器类型\r\n   */\r\n  isCounter(): boolean {\r\n    return this.metric_type === 'counter';\r\n  }\r\n\r\n  /**\r\n   * 检查是否为仪表盘类型\r\n   */\r\n  isGauge(): boolean {\r\n    return this.metric_type === 'gauge';\r\n  }\r\n\r\n  /**\r\n   * 检查是否为直方图类型\r\n   */\r\n  isHistogram(): boolean {\r\n    return this.metric_type === 'histogram';\r\n  }\r\n\r\n  /**\r\n   * 增加计数器值\r\n   */\r\n  incrementCounter(delta: number = 1): void {\r\n    if (this.isCounter()) {\r\n      this.metric_value += delta;\r\n      this.updated_at = Date.now();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置仪表盘值\r\n   */\r\n  setGaugeValue(value: number): void {\r\n    if (this.isGauge()) {\r\n      this.metric_value = value;\r\n      this.updated_at = Date.now();\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\entities\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\initialize.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\migrations\\create-fulltext-search.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\migrations\\run-schema-fix.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\AlertHistoryRepository.ts","messages":[{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":42,"column":3,"nodeType":"Block","endLine":48,"endColumn":6},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":62,"column":3,"nodeType":"Block","endLine":67,"endColumn":6},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"severity\" declaration.","line":79,"column":3,"nodeType":"Block","endLine":81,"endColumn":6,"fix":{"range":[2106,2137],"text":"/**\r\n   * �������س̶Ȼ�ȡ�澯\r\n   * @param severity\n   * @param limit\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"limit\" declaration.","line":79,"column":3,"nodeType":"Block","endLine":81,"endColumn":6,"fix":{"range":[2106,2137],"text":"/**\r\n   * �������س̶Ȼ�ȡ�澯\r\n   * @param severity\n   * @param limit\n   * @param severity\n   * @param limit\n   */"}},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":79,"column":3,"nodeType":"Block","endLine":81,"endColumn":6},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"status\" declaration.","line":98,"column":3,"nodeType":"Block","endLine":100,"endColumn":6,"fix":{"range":[2553,2581],"text":"/**\r\n   * ����״̬��ȡ�澯\r\n   * @param status\n   * @param limit\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"limit\" declaration.","line":98,"column":3,"nodeType":"Block","endLine":100,"endColumn":6,"fix":{"range":[2553,2581],"text":"/**\r\n   * ����״̬��ȡ�澯\r\n   * @param status\n   * @param limit\n   * @param status\n   * @param limit\n   */"}},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":98,"column":3,"nodeType":"Block","endLine":100,"endColumn":6},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"id\" declaration.","line":117,"column":3,"nodeType":"Block","endLine":119,"endColumn":6,"fix":{"range":[2989,3013],"text":"/**\r\n   * ���¸澯״̬\r\n   * @param id\n   * @param status\n   * @param resolvedAt\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"status\" declaration.","line":117,"column":3,"nodeType":"Block","endLine":119,"endColumn":6,"fix":{"range":[2989,3013],"text":"/**\r\n   * ���¸澯״̬\r\n   * @param id\n   * @param status\n   * @param resolvedAt\n   * @param id\n   * @param status\n   * @param resolvedAt\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"resolvedAt\" declaration.","line":117,"column":3,"nodeType":"Block","endLine":119,"endColumn":6,"fix":{"range":[2989,3013],"text":"/**\r\n   * ���¸澯״̬\r\n   * @param id\n   * @param status\n   * @param resolvedAt\n   * @param id\n   * @param status\n   * @param resolvedAt\n   * @param id\n   * @param status\n   * @param resolvedAt\n   */"}},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":117,"column":3,"nodeType":"Block","endLine":119,"endColumn":6},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"ids\" declaration.","line":140,"column":3,"nodeType":"Block","endLine":142,"endColumn":6,"fix":{"range":[3583,3611],"text":"/**\r\n   * �������¸澯״̬\r\n   * @param ids\n   * @param status\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"status\" declaration.","line":140,"column":3,"nodeType":"Block","endLine":142,"endColumn":6,"fix":{"range":[3583,3611],"text":"/**\r\n   * �������¸澯״̬\r\n   * @param ids\n   * @param status\n   * @param ids\n   * @param status\n   */"}},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":140,"column":3,"nodeType":"Block","endLine":142,"endColumn":6},{"ruleId":"jsdoc/require-returns","severity":1,"message":"Missing JSDoc @returns declaration.","line":164,"column":3,"nodeType":"Block","endLine":166,"endColumn":6}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":9,"source":"import { DataSource, FindManyOptions } from 'typeorm';\r\nimport { Logger } from '@logging/logger.js';\r\nimport { AlertHistory } from '../entities/index.js';\r\nimport { BaseRepository } from './BaseRepository.js';\r\n\r\n/**\r\n * AlertHistory Repositoryʵ��\r\n * �̳�BaseRepository���ṩAlertHistory�ض������ݿ����\r\n */\r\nexport class AlertHistoryRepository extends BaseRepository<AlertHistory> {\r\n  /**\r\n   * ����AlertHistoryRepositoryʵ��\r\n   * @param dataSource TypeORM����Դ\r\n   * @param logger ��־��¼��\r\n   */\r\n  constructor(dataSource: DataSource, logger: Logger) {\r\n    super(dataSource, AlertHistory, logger);\r\n  }\r\n\r\n  /**\r\n   * ���ݸ澯����ID��ȡ�澯��ʷ\r\n   * @param ruleId �澯����ID\r\n   * @param limit ��������\r\n   * @returns �澯��ʷ����\r\n   */\r\n  async findByRuleId(\r\n    ruleId: string,\r\n    limit: number = 100,\r\n  ): Promise<AlertHistory[]> {\r\n    try {\r\n      return await this.repository.find({\r\n        where: { rule_id: ruleId },\r\n        order: { created_at: 'DESC' },\r\n        take: limit,\r\n      });\r\n    } catch (error) {\r\n      this.logger.error('���ݸ澯����ID��ȡ�澯��ʷʧ��', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ����ʱ�䷶Χ��ȡ�澯��ʷ\r\n   * @param fieldName ʱ���ֶ�\r\n   * @param startTime ��ʼʱ��\r\n   * @param endTime ����ʱ��\r\n   * @param options ��ѡ��ѯ����\r\n   */\r\n  async findByTimeRange(\r\n    fieldName: string,\r\n    startTime: number,\r\n    endTime: number,\r\n    options: FindManyOptions<AlertHistory> = {},\r\n  ): Promise<AlertHistory[]> {\r\n    const mergedOptions: FindManyOptions<AlertHistory> = {\r\n      ...options,\r\n      order: options.order ?? { triggered_at: 'DESC' },\r\n    };\r\n    return super.findByTimeRange(fieldName, startTime, endTime, mergedOptions);\r\n  }\r\n\r\n  /**\r\n   * �Դ��� triggered_at �ֶβ�ѯ�澯��ʷ\r\n   * @param startTime ��ʼʱ��\r\n   * @param endTime ����ʱ��\r\n   * @param limit ��������\r\n   */\r\n  async findByTriggeredAtRange(\r\n    startTime: number,\r\n    endTime: number,\r\n    limit: number = 100,\r\n  ): Promise<AlertHistory[]> {\r\n    return this.findByTimeRange('triggered_at', startTime, endTime, {\r\n      take: limit,\r\n      order: { triggered_at: 'DESC' },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * �������س̶Ȼ�ȡ�澯\r\n   */\r\n  async findBySeverity(\r\n    severity: 'low' | 'medium' | 'high' | 'critical',\r\n    limit: number = 100,\r\n  ): Promise<AlertHistory[]> {\r\n    try {\r\n      return await this.repository.find({\r\n        where: { severity },\r\n        order: { triggered_at: 'DESC' },\r\n        take: limit,\r\n      });\r\n    } catch (error) {\r\n      this.logger.error('�������س̶Ȼ�ȡ�澯ʧ��', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ����״̬��ȡ�澯\r\n   */\r\n  async findByStatus(\r\n    status: 'triggered' | 'resolved' | 'suppressed',\r\n    limit: number = 100,\r\n  ): Promise<AlertHistory[]> {\r\n    try {\r\n      return await this.repository.find({\r\n        where: { status },\r\n        order: { triggered_at: 'DESC' },\r\n        take: limit,\r\n      });\r\n    } catch (error) {\r\n      this.logger.error('����״̬��ȡ�澯ʧ��', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ���¸澯״̬\r\n   */\r\n  async updateStatus(\r\n    id: string,\r\n    status: 'triggered' | 'resolved' | 'suppressed',\r\n    resolvedAt?: number,\r\n  ): Promise<boolean> {\r\n    try {\r\n      const updateData: { status: typeof status; resolved_at?: number } = {\r\n        status,\r\n      };\r\n      if (resolvedAt) {\r\n        updateData.resolved_at = resolvedAt;\r\n      }\r\n      const result = await this.repository.update({ id }, updateData);\r\n      return (result.affected || 0) > 0;\r\n    } catch (error) {\r\n      this.logger.error('���¸澯״̬ʧ��', { error, id });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * �������¸澯״̬\r\n   */\r\n  async updateStatusBatch(\r\n    ids: string[],\r\n    status: 'triggered' | 'resolved' | 'suppressed',\r\n  ): Promise<number> {\r\n    try {\r\n      if (ids.length === 0) {\r\n        return 0;\r\n      }\r\n      const result = await this.repository\r\n        .createQueryBuilder()\r\n        .update(AlertHistory)\r\n        .set({ status })\r\n        .whereInIds(ids)\r\n        .execute();\r\n      return result.affected || 0;\r\n    } catch (error) {\r\n      this.logger.error('�������¸澯״̬ʧ��', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ��ȡ�澯ͳ����Ϣ\r\n   */\r\n  async getAlertStats(): Promise<{\r\n    total: number;\r\n    triggered: number;\r\n    resolved: number;\r\n    suppressed: number;\r\n  }> {\r\n    try {\r\n      const total = await this.repository.count();\r\n      const triggered = await this.repository.count({\r\n        where: { status: 'triggered' },\r\n      });\r\n      const resolved = await this.repository.count({\r\n        where: { status: 'resolved' },\r\n      });\r\n      const suppressed = await this.repository.count({\r\n        where: { status: 'suppressed' },\r\n      });\r\n      return { total, triggered, resolved, suppressed };\r\n    } catch (error) {\r\n      this.logger.error('��ȡ�澯ͳ��ʧ��', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * �����ѽ���ĸ澯ʷ������������\r\n   * @param daysOld �����쳣������\r\n   * @returns ɾ��������\r\n   */\r\n  async cleanupResolvedAlerts(daysOld: number = 30): Promise<number> {\r\n    try {\r\n      const beforeTime = Date.now() - daysOld * 24 * 60 * 60 * 1000;\r\n      const result = await this.repository\r\n        .createQueryBuilder()\r\n        .delete()\r\n        .from(AlertHistory)\r\n        .where('status = :status AND triggered_at < :beforeTime', {\r\n          status: 'resolved',\r\n          beforeTime,\r\n        })\r\n        .execute();\r\n      return result.affected || 0;\r\n    } catch (error) {\r\n      this.logger.error('�����ѽ���ĸ澯ʧ��', { error });\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\AlertRulesRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\BaseRepository.d.ts","messages":[{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":16,"column":1,"nodeType":"ExportNamedDeclaration","messageId":"missingJsDoc","endLine":17,"endColumn":1,"fix":{"range":[392,392],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":16,"column":8,"nodeType":"TSInterfaceDeclaration","messageId":"missingJsDoc","endLine":17,"endColumn":1,"fix":{"range":[392,392],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":22,"column":1,"nodeType":"ExportNamedDeclaration","messageId":"missingJsDoc","endLine":23,"endColumn":1,"fix":{"range":[517,517],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":22,"column":8,"nodeType":"TSInterfaceDeclaration","messageId":"missingJsDoc","endLine":23,"endColumn":1,"fix":{"range":[517,517],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":35,"column":1,"nodeType":"ExportNamedDeclaration","messageId":"missingJsDoc","endLine":36,"endColumn":1,"fix":{"range":[744,744],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":35,"column":8,"nodeType":"TSInterfaceDeclaration","messageId":"missingJsDoc","endLine":36,"endColumn":1,"fix":{"range":[744,744],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":42,"column":1,"nodeType":"ExportNamedDeclaration","messageId":"missingJsDoc","endLine":43,"endColumn":1,"fix":{"range":[872,872],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":42,"column":8,"nodeType":"ClassDeclaration","messageId":"missingJsDoc","endLine":43,"endColumn":1,"fix":{"range":[872,872],"text":"/**\n *\n */\n"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[989,992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[989,992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":53,"column":14,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":54,"endColumn":1,"fix":{"range":[1280,1280],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":61,"column":9,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":62,"endColumn":1,"fix":{"range":[1499,1499],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":62,"column":17,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":63,"endColumn":1,"fix":{"range":[1544,1544],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":63,"column":14,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":64,"endColumn":1,"fix":{"range":[1597,1597],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":64,"column":25,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":65,"endColumn":1,"fix":{"range":[1671,1671],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":69,"column":11,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":70,"endColumn":1,"fix":{"range":[1795,1795],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":70,"column":12,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":71,"endColumn":1,"fix":{"range":[1839,1839],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":71,"column":10,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":72,"endColumn":1,"fix":{"range":[1882,1882],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":72,"column":10,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":73,"endColumn":1,"fix":{"range":[1941,1941],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":73,"column":21,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":74,"endColumn":1,"fix":{"range":[1997,1997],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":77,"column":18,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":78,"endColumn":1,"fix":{"range":[2166,2166],"text":"/**\n   *\n   */\n  "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2191,2194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2191,2194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":78,"column":20,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":79,"endColumn":1,"fix":{"range":[2216,2216],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":83,"column":16,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":84,"endColumn":1,"fix":{"range":[2342,2342],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":84,"column":8,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":85,"endColumn":1,"fix":{"range":[2411,2411],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":85,"column":16,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":86,"endColumn":1,"fix":{"range":[2467,2467],"text":"/**\n   *\n   */\n  "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2490,2493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2490,2493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":86,"column":9,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":87,"endColumn":1,"fix":{"range":[2534,2534],"text":"/**\n   *\n   */\n  "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2551,2554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2551,2554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2587,2590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2587,2590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":87,"column":9,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":88,"endColumn":1,"fix":{"range":[2596,2596],"text":"/**\n   *\n   */\n  "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2613,2616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2613,2616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2627,2630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2627,2630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":88,"column":13,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":89,"endColumn":1,"fix":{"range":[2636,2636],"text":"/**\n   *\n   */\n  "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2657,2660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2657,2660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2671,2674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2671,2674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":89,"column":14,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":90,"endColumn":1,"fix":{"range":[2680,2680],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":94,"column":18,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":95,"endColumn":1,"fix":{"range":[2816,2816],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":98,"column":13,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":99,"endColumn":1,"fix":{"range":[2915,2915],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":99,"column":10,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":100,"endColumn":1,"fix":{"range":[2947,2947],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":100,"column":18,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":101,"endColumn":1,"fix":{"range":[2976,2976],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":101,"column":21,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":102,"endColumn":1,"fix":{"range":[3053,3053],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":102,"column":16,"nodeType":"TSEmptyBodyFunctionExpression","messageId":"missingJsDoc","endLine":103,"endColumn":1,"fix":{"range":[3115,3115],"text":"/**\n   *\n   */\n  "}}],"suppressedMessages":[],"errorCount":33,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":33,"fixableWarningCount":0,"source":"import type {\r\n  DataSource,\r\n  EntityTarget,\r\n  FindManyOptions,\r\n  FindOneOptions,\r\n  FindOptionsWhere,\r\n  ObjectLiteral,\r\n  Repository,\r\n  SelectQueryBuilder,\r\n  DeepPartial,\r\n} from 'typeorm';\r\nimport type { MetricsCollector } from '../../monitoring/MetricsCollector.js';\r\nimport { Logger } from '@logging/logger.js';\r\nimport { CachedRepositoryBase } from '../../cache/QueryCache.js';\r\n\r\nexport interface PaginationOptions {\r\n  page?: number;\r\n  limit?: number;\r\n  orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n}\r\n\r\nexport interface PaginatedResult<T> {\r\n  data: T[];\r\n  items?: T[];\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n    hasNext: boolean;\r\n    hasPrev: boolean;\r\n  };\r\n}\r\n\r\nexport interface BatchOperationResult {\r\n  success: number;\r\n  failed: number;\r\n  errors?: string[];\r\n  updated?: number;\r\n}\r\n\r\nexport declare class BaseRepository<\r\n  T extends ObjectLiteral,\r\n> extends CachedRepositoryBase {\r\n  [key: string]: any;\r\n  protected readonly dataSource: DataSource;\r\n  protected readonly entity: EntityTarget<T>;\r\n  protected readonly logger: Logger;\r\n  protected readonly metricsCollector?: MetricsCollector;\r\n  protected readonly repository: Repository<T>;\r\n  protected readonly entityName: string;\r\n\r\n  constructor(\r\n    dataSource: DataSource,\r\n    entity: EntityTarget<T>,\r\n    logger: Logger,\r\n    metricsCollector?: MetricsCollector,\r\n    cacheConfig?: import('../../cache/QueryCache.js').QueryCacheConfig,\r\n  );\r\n\r\n  create(data: DeepPartial<T>): Promise<T>;\r\n  createOrUpdate(data: DeepPartial<T>): Promise<T>;\r\n  createBatch(data: DeepPartial<T>[], batchSize?: number): Promise<T[]>;\r\n  createBatchWithManager(\r\n    manager: unknown,\r\n    data: DeepPartial<T>[],\r\n    batchSize?: number,\r\n  ): Promise<T[]>;\r\n  findById(id: string): Promise<T | null>;\r\n  findByIds(ids: string[]): Promise<T[]>;\r\n  findOne(options: FindOneOptions<T>): Promise<T | null>;\r\n  findAll(options?: FindManyOptions<T>): Promise<T[]>;\r\n  findWithPagination(\r\n    paginationOptions?: PaginationOptions,\r\n    query?: string | SelectQueryBuilder<T> | FindOptionsWhere<T>,\r\n  ): Promise<PaginatedResult<T>>;\r\n  findByTimeRange(...args: any[]): Promise<T[]>;\r\n  findByFuzzySearch(\r\n    fieldName: string,\r\n    searchText: string,\r\n    options?: FindManyOptions<T>,\r\n  ): Promise<T[]>;\r\n  findWithQuery(queryBuilder: SelectQueryBuilder<T>): Promise<T[]>;\r\n  count(where?: FindOptionsWhere<T>): Promise<number>;\r\n  getStatistics(...args: any[]): Promise<Record<string, number>>;\r\n  update(criteria: any, data: DeepPartial<T>): Promise<any>;\r\n  delete(criteria: any): Promise<any>;\r\n  softDelete(criteria: any): Promise<any>;\r\n  updateBatch(\r\n    ids: (string | number)[],\r\n    data: DeepPartial<T>,\r\n    batchSize?: number,\r\n  ): Promise<BatchOperationResult>;\r\n  softDeleteBatch(\r\n    ids: (string | number)[],\r\n    batchSize?: number,\r\n  ): Promise<number>;\r\n  clearCache(): Promise<void>;\r\n  destroy(): Promise<void>;\r\n  executeRawQuery(query: string, parameters?: unknown[]): Promise<unknown>;\r\n  createQueryBuilder(alias?: string): SelectQueryBuilder<T>;\r\n  getRepository(): Repository<T>;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\ChunkFullTextRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\ChunkMetaRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\ChunkRepository.ts","messages":[{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options\" declaration.","line":38,"column":3,"nodeType":"Block","endLine":47,"endColumn":6,"fix":{"range":[810,1057],"text":"/**\r\n   * 根据文档ID查找块\r\n   * @param docId 文档ID\r\n   * @param options\n   * @param options.status 块状态\r\n   * @param options.syncStatus 同步状态\r\n   * @param options.limit 限制数量\r\n   * @param options.orderBy 排序字段\r\n   * @param options.includeContent 是否包含内容\r\n   * @returns 块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options\" declaration.","line":121,"column":3,"nodeType":"Block","endLine":130,"endColumn":6,"fix":{"range":[3051,3305],"text":"/**\r\n   * 根据集合ID查找块\r\n   * @param collectionId 集合ID\r\n   * @param options\n   * @param options.status 块状态\r\n   * @param options.syncStatus 同步状态\r\n   * @param options.limit 限制数量\r\n   * @param options.orderBy 排序字段\r\n   * @param options.includeContent 是否包含内容\r\n   * @returns 块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options\" declaration.","line":204,"column":3,"nodeType":"Block","endLine":210,"endColumn":6,"fix":{"range":[5348,5499],"text":"/**\r\n   * 根据点ID数组查找块\r\n   * @param pointIds 点ID数组\r\n   * @param options\n   * @param options.includeContent 是否包含内容\r\n   * @param options.orderBy 排序字段\r\n   * @returns 块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.includeContent\" declaration.","line":269,"column":3,"nodeType":"Block","endLine":274,"endColumn":6,"fix":{"range":[7021,7124],"text":"/**\r\n   * 根据点ID查找单个块\r\n   * @param pointId 点ID\r\n   * @param options 查询选项\r\n   * @param options.includeContent\n   * @returns 找到的块或null\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.status\" declaration.","line":442,"column":3,"nodeType":"Block","endLine":448,"endColumn":6,"fix":{"range":[11305,11433],"text":"/**\r\n   * 获取块总数\r\n   * @param docId 可选的文档ID\r\n   * @param collectionId 可选的集合ID\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.syncStatus\n   * @returns 块总数\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.syncStatus\" declaration.","line":442,"column":3,"nodeType":"Block","endLine":448,"endColumn":6,"fix":{"range":[11305,11433],"text":"/**\r\n   * 获取块总数\r\n   * @param docId 可选的文档ID\r\n   * @param collectionId 可选的集合ID\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.syncStatus\n   * @param options.status\n   * @param options.syncStatus\n   * @returns 块总数\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.status\" declaration.","line":494,"column":3,"nodeType":"Block","endLine":501,"endColumn":6,"fix":{"range":[12594,12759],"text":"/**\r\n   * 分页获取块\r\n   * @param paginationOptions 分页选项\r\n   * @param docId 可选的文档ID\r\n   * @param collectionId 可选的集合ID\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.syncStatus\n   * @param options.includeContent\n   * @returns 分页结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.syncStatus\" declaration.","line":494,"column":3,"nodeType":"Block","endLine":501,"endColumn":6,"fix":{"range":[12594,12759],"text":"/**\r\n   * 分页获取块\r\n   * @param paginationOptions 分页选项\r\n   * @param docId 可选的文档ID\r\n   * @param collectionId 可选的集合ID\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.syncStatus\n   * @param options.includeContent\n   * @param options.status\n   * @param options.syncStatus\n   * @param options.includeContent\n   * @returns 分页结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.includeContent\" declaration.","line":494,"column":3,"nodeType":"Block","endLine":501,"endColumn":6,"fix":{"range":[12594,12759],"text":"/**\r\n   * 分页获取块\r\n   * @param paginationOptions 分页选项\r\n   * @param docId 可选的文档ID\r\n   * @param collectionId 可选的集合ID\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.syncStatus\n   * @param options.includeContent\n   * @param options.status\n   * @param options.syncStatus\n   * @param options.includeContent\n   * @param options.status\n   * @param options.syncStatus\n   * @param options.includeContent\n   * @returns 分页结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.collectionId\" declaration.","line":571,"column":3,"nodeType":"Block","endLine":576,"endColumn":6,"fix":{"range":[14658,14757],"text":"/**\r\n   * 搜索块内容\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @returns 匹配的块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.docId\" declaration.","line":571,"column":3,"nodeType":"Block","endLine":576,"endColumn":6,"fix":{"range":[14658,14757],"text":"/**\r\n   * 搜索块内容\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @returns 匹配的块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.limit\" declaration.","line":571,"column":3,"nodeType":"Block","endLine":576,"endColumn":6,"fix":{"range":[14658,14757],"text":"/**\r\n   * 搜索块内容\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @returns 匹配的块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.searchFields\" declaration.","line":571,"column":3,"nodeType":"Block","endLine":576,"endColumn":6,"fix":{"range":[14658,14757],"text":"/**\r\n   * 搜索块内容\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @returns 匹配的块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.includeContent\" declaration.","line":571,"column":3,"nodeType":"Block","endLine":576,"endColumn":6,"fix":{"range":[14658,14757],"text":"/**\r\n   * 搜索块内容\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @param options.collectionId\n   * @param options.docId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.includeContent\n   * @returns 匹配的块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"fieldNameOrStartTime\" declaration.","line":655,"column":3,"nodeType":"Block","endLine":661,"endColumn":6,"fix":{"range":[16865,16990],"text":"/**\r\n   * 根据时间范围查找块\r\n   * @param startTime 开始时间\r\n   * @param endTime 结束时间\r\n   * @param fieldNameOrStartTime\n   * @param startTimeOrEndTime\n   * @param endTimeOrOptions\n   * @param options 查询选项\r\n   * @returns 块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"startTimeOrEndTime\" declaration.","line":655,"column":3,"nodeType":"Block","endLine":661,"endColumn":6,"fix":{"range":[16865,16990],"text":"/**\r\n   * 根据时间范围查找块\r\n   * @param startTime 开始时间\r\n   * @param endTime 结束时间\r\n   * @param fieldNameOrStartTime\n   * @param startTimeOrEndTime\n   * @param endTimeOrOptions\n   * @param fieldNameOrStartTime\n   * @param startTimeOrEndTime\n   * @param endTimeOrOptions\n   * @param options 查询选项\r\n   * @returns 块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"endTimeOrOptions\" declaration.","line":655,"column":3,"nodeType":"Block","endLine":661,"endColumn":6,"fix":{"range":[16865,16990],"text":"/**\r\n   * 根据时间范围查找块\r\n   * @param startTime 开始时间\r\n   * @param endTime 结束时间\r\n   * @param fieldNameOrStartTime\n   * @param startTimeOrEndTime\n   * @param endTimeOrOptions\n   * @param fieldNameOrStartTime\n   * @param startTimeOrEndTime\n   * @param endTimeOrOptions\n   * @param fieldNameOrStartTime\n   * @param startTimeOrEndTime\n   * @param endTimeOrOptions\n   * @param options 查询选项\r\n   * @returns 块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.status\" declaration.","line":791,"column":3,"nodeType":"Block","endLine":796,"endColumn":6,"fix":{"range":[20822,20919],"text":"/**\r\n   * 根据文档ID统计块数量\r\n   * @param docId 文档ID\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.syncStatus\n   * @returns 块数量\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.syncStatus\" declaration.","line":791,"column":3,"nodeType":"Block","endLine":796,"endColumn":6,"fix":{"range":[20822,20919],"text":"/**\r\n   * 根据文档ID统计块数量\r\n   * @param docId 文档ID\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.syncStatus\n   * @param options.status\n   * @param options.syncStatus\n   * @returns 块数量\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"groupByOrOptions\" declaration.","line":933,"column":3,"nodeType":"Block","endLine":938,"endColumn":6,"fix":{"range":[24231,24336],"text":"/**\r\n   * 获取块统计信息\r\n   * @param collectionId 可选的集合ID\r\n   * @param docId 可选的文档ID\r\n   * @param groupByOrOptions\n   * @param where\n   * @returns 统计信息\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"where\" declaration.","line":933,"column":3,"nodeType":"Block","endLine":938,"endColumn":6,"fix":{"range":[24231,24336],"text":"/**\r\n   * 获取块统计信息\r\n   * @param collectionId 可选的集合ID\r\n   * @param docId 可选的文档ID\r\n   * @param groupByOrOptions\n   * @param where\n   * @param groupByOrOptions\n   * @param where\n   * @returns 统计信息\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"manager.save\" declaration.","line":1040,"column":3,"nodeType":"Block","endLine":1045,"endColumn":6,"fix":{"range":[27332,27435],"text":"/**\r\n   * 批量创建块（带事务管理器）\r\n   * @param chunks 块数组\r\n   * @param manager 事务管理器\r\n   * @param manager.save\n   * @returns 创建的块数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"manager.delete\" declaration.","line":1072,"column":3,"nodeType":"Block","endLine":1077,"endColumn":6,"fix":{"range":[28199,28306],"text":"/**\r\n   * 根据文档ID删除块（带事务管理器）\r\n   * @param docId 文档ID\r\n   * @param manager 事务管理器\r\n   * @param manager.delete\n   * @returns 删除的块数量\r\n   */"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":23,"source":"import type {\r\n  DataSource,\r\n  FindOptionsWhere,\r\n  FindManyOptions,\r\n  Not,\r\n  Between,\r\n  ILike,\r\n  LessThan,\r\n  MoreThan,\r\n  Like,\r\n} from 'typeorm';\r\nimport { In } from 'typeorm';\r\nimport {\r\n  BaseRepository,\r\n  PaginationOptions,\r\n  PaginatedResult,\r\n  BatchOperationResult,\r\n} from './BaseRepository.js';\r\nimport { Chunk } from '../entities/Chunk.js';\r\nimport { Logger } from '@logging/logger.js';\r\nimport { DocId, CollectionId, PointId } from '@domain/entities/types.js';\r\n\r\n/**\r\n * 块Repository\r\n * 提供块相关的数据库操作\r\n * 优化了查询性能和批量操作\r\n */\r\nexport class ChunkRepository extends BaseRepository<Chunk> {\r\n  /**\r\n   * 创建ChunkRepository实例\r\n   * @param dataSource TypeORM数据源\r\n   * @param logger 日志记录器\r\n   */\r\n  constructor(dataSource: DataSource, logger: Logger) {\r\n    super(dataSource, Chunk, logger);\r\n  }\r\n\r\n  /**\r\n   * 根据文档ID查找块\r\n   * @param docId 文档ID\r\n   * @param options.status 块状态\r\n   * @param options.syncStatus 同步状态\r\n   * @param options.limit 限制数量\r\n   * @param options.orderBy 排序字段\r\n   * @param options.includeContent 是否包含内容\r\n   * @returns 块数组\r\n   */\r\n  async findByDocId(\r\n    docId: DocId,\r\n    options: {\r\n      status?: 'pending' | 'processing' | 'completed' | 'failed';\r\n      syncStatus?: 'pending' | 'processing' | 'completed' | 'failed';\r\n      limit?: number;\r\n      orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n      includeContent?: boolean;\r\n    } = {},\r\n  ): Promise<Chunk[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('chunk').where(\r\n        'chunk.docId = :docId',\r\n        { docId },\r\n      );\r\n\r\n      if (options.status) {\r\n        queryBuilder.andWhere('chunk.embeddingStatus = :status', {\r\n          status: options.status,\r\n        });\r\n      }\r\n\r\n      if (options.syncStatus) {\r\n        queryBuilder.andWhere('chunk.syncStatus = :syncStatus', {\r\n          syncStatus: options.syncStatus,\r\n        });\r\n      }\r\n\r\n      if (options.orderBy) {\r\n        Object.entries(options.orderBy).forEach(([field, direction]) => {\r\n          queryBuilder.addOrderBy(`chunk.${field}`, direction);\r\n        });\r\n      } else {\r\n        queryBuilder.addOrderBy('chunk.chunkIndex', 'ASC');\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      if (!options.includeContent) {\r\n        queryBuilder.select([\r\n          'chunk.id',\r\n          'chunk.pointId',\r\n          'chunk.docId',\r\n          'chunk.collectionId',\r\n          'chunk.chunkIndex',\r\n          'chunk.title',\r\n          'chunk.contentLength',\r\n          'chunk.tokenCount',\r\n          'chunk.embeddingStatus',\r\n          'chunk.syncStatus',\r\n          'chunk.embeddedAt',\r\n          'chunk.syncedAt',\r\n          'chunk.error',\r\n          'chunk.metadata',\r\n          'chunk.created_at',\r\n          'chunk.updated_at',\r\n        ]);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`根据文档ID查找块失败`, {\r\n        docId,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据集合ID查找块\r\n   * @param collectionId 集合ID\r\n   * @param options.status 块状态\r\n   * @param options.syncStatus 同步状态\r\n   * @param options.limit 限制数量\r\n   * @param options.orderBy 排序字段\r\n   * @param options.includeContent 是否包含内容\r\n   * @returns 块数组\r\n   */\r\n  async findByCollectionId(\r\n    collectionId: CollectionId,\r\n    options: {\r\n      status?: 'pending' | 'processing' | 'completed' | 'failed';\r\n      syncStatus?: 'pending' | 'processing' | 'completed' | 'failed';\r\n      limit?: number;\r\n      orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n      includeContent?: boolean;\r\n    } = {},\r\n  ): Promise<Chunk[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('chunk').where(\r\n        'chunk.collectionId = :collectionId',\r\n        { collectionId },\r\n      );\r\n\r\n      if (options.status) {\r\n        queryBuilder.andWhere('chunk.embeddingStatus = :status', {\r\n          status: options.status,\r\n        });\r\n      }\r\n\r\n      if (options.syncStatus) {\r\n        queryBuilder.andWhere('chunk.syncStatus = :syncStatus', {\r\n          syncStatus: options.syncStatus,\r\n        });\r\n      }\r\n\r\n      if (options.orderBy) {\r\n        Object.entries(options.orderBy).forEach(([field, direction]) => {\r\n          queryBuilder.addOrderBy(`chunk.${field}`, direction);\r\n        });\r\n      } else {\r\n        queryBuilder.addOrderBy('chunk.chunkIndex', 'ASC');\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      if (!options.includeContent) {\r\n        queryBuilder.select([\r\n          'chunk.id',\r\n          'chunk.pointId',\r\n          'chunk.docId',\r\n          'chunk.collectionId',\r\n          'chunk.chunkIndex',\r\n          'chunk.title',\r\n          'chunk.contentLength',\r\n          'chunk.tokenCount',\r\n          'chunk.embeddingStatus',\r\n          'chunk.syncStatus',\r\n          'chunk.embeddedAt',\r\n          'chunk.syncedAt',\r\n          'chunk.error',\r\n          'chunk.metadata',\r\n          'chunk.created_at',\r\n          'chunk.updated_at',\r\n        ]);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`根据集合ID查找块失败`, {\r\n        collectionId,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据点ID数组查找块\r\n   * @param pointIds 点ID数组\r\n   * @param options.includeContent 是否包含内容\r\n   * @param options.orderBy 排序字段\r\n   * @returns 块数组\r\n   */\r\n  async findByPointIds(\r\n    pointIds: PointId[],\r\n    options: {\r\n      includeContent?: boolean;\r\n      orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n    } = {},\r\n  ): Promise<Chunk[]> {\r\n    try {\r\n      if (pointIds.length === 0) {\r\n        return [];\r\n      }\r\n\r\n      const queryBuilder = this.createQueryBuilder('chunk').where(\r\n        'chunk.pointId IN (:...pointIds)',\r\n        { pointIds },\r\n      );\r\n\r\n      if (options.orderBy) {\r\n        Object.entries(options.orderBy).forEach(([field, direction]) => {\r\n          queryBuilder.addOrderBy(`chunk.${field}`, direction);\r\n        });\r\n      } else {\r\n        queryBuilder.addOrderBy('chunk.chunkIndex', 'ASC');\r\n      }\r\n\r\n      if (!options.includeContent) {\r\n        queryBuilder.select([\r\n          'chunk.id',\r\n          'chunk.pointId',\r\n          'chunk.docId',\r\n          'chunk.collectionId',\r\n          'chunk.chunkIndex',\r\n          'chunk.title',\r\n          'chunk.contentLength',\r\n          'chunk.tokenCount',\r\n          'chunk.embeddingStatus',\r\n          'chunk.syncStatus',\r\n          'chunk.embeddedAt',\r\n          'chunk.syncedAt',\r\n          'chunk.error',\r\n          'chunk.metadata',\r\n          'chunk.created_at',\r\n          'chunk.updated_at',\r\n        ]);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`根据点ID数组查找块失败`, {\r\n        pointIds,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据点ID查找单个块\r\n   * @param pointId 点ID\r\n   * @param options 查询选项\r\n   * @returns 找到的块或null\r\n   */\r\n  async findByPointId(\r\n    pointId: PointId,\r\n    options: {\r\n      includeContent?: boolean;\r\n    } = {},\r\n  ): Promise<Chunk | null> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('chunk').where(\r\n        'chunk.pointId = :pointId',\r\n        { pointId },\r\n      );\r\n\r\n      if (!options.includeContent) {\r\n        queryBuilder.select([\r\n          'chunk.id',\r\n          'chunk.pointId',\r\n          'chunk.docId',\r\n          'chunk.collectionId',\r\n          'chunk.chunkIndex',\r\n          'chunk.title',\r\n          'chunk.contentLength',\r\n          'chunk.tokenCount',\r\n          'chunk.embeddingStatus',\r\n          'chunk.syncStatus',\r\n          'chunk.embeddedAt',\r\n          'chunk.syncedAt',\r\n          'chunk.error',\r\n          'chunk.metadata',\r\n          'chunk.created_at',\r\n          'chunk.updated_at',\r\n        ]);\r\n      }\r\n\r\n      const result = await queryBuilder.getOne();\r\n      return result || null;\r\n    } catch (error) {\r\n      this.logger.error(`根据点ID查找块失败`, {\r\n        pointId,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量创建块\r\n   * @param chunks 块数组\r\n   * @param batchSize 批次大小，默认100\r\n   * @returns 创建的块数组\r\n   */\r\n  async createBatch(\r\n    chunks: Partial<Chunk>[],\r\n    batchSize: number = 100,\r\n  ): Promise<Chunk[]> {\r\n    try {\r\n      // 预处理块数据，计算内容长度\r\n      const processedChunks = chunks.map((chunk) => ({\r\n        ...chunk,\r\n        contentLength: chunk.content ? chunk.content.length : 0,\r\n      }));\r\n\r\n      const results = await super.createBatch(processedChunks, batchSize);\r\n      this.logger.debug(`批量创建块成功`, {\r\n        count: results.length,\r\n      });\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`批量创建块失败`, {\r\n        count: chunks.length,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据文档ID删除块\r\n   * @param docId 文档ID\r\n   * @returns 删除的块数量\r\n   */\r\n  async deleteByDocId(docId: DocId): Promise<number> {\r\n    try {\r\n      const result = await this.repository.delete({ docId });\r\n      const deletedCount = result.affected || 0;\r\n      this.logger.debug(`根据文档ID删除块成功`, {\r\n        docId,\r\n        count: deletedCount,\r\n      });\r\n      return deletedCount;\r\n    } catch (error) {\r\n      this.logger.error(`根据文档ID删除块失败`, {\r\n        docId,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据集合ID删除块\r\n   * @param collectionId 集合ID\r\n   * @returns 删除的块数量\r\n   */\r\n  async deleteByCollectionId(collectionId: CollectionId): Promise<number> {\r\n    try {\r\n      const result = await this.repository.delete({ collectionId });\r\n      const deletedCount = result.affected || 0;\r\n      this.logger.debug(`根据集合ID删除块成功`, {\r\n        collectionId,\r\n        count: deletedCount,\r\n      });\r\n      return deletedCount;\r\n    } catch (error) {\r\n      this.logger.error(`根据集合ID删除块失败`, {\r\n        collectionId,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据点ID数组删除块\r\n   * @param pointIds 点ID数组\r\n   * @param batchSize 批次大小，默认100\r\n   * @returns 删除的块数量\r\n   */\r\n  async deleteByPointIds(\r\n    pointIds: PointId[],\r\n    batchSize: number = 100,\r\n  ): Promise<number> {\r\n    try {\r\n      if (pointIds.length === 0) {\r\n        return 0;\r\n      }\r\n\r\n      let totalDeleted = 0;\r\n      for (let i = 0; i < pointIds.length; i += batchSize) {\r\n        const batch = pointIds.slice(i, i + batchSize);\r\n        const result = await this.repository.delete({\r\n          pointId: In(batch),\r\n        });\r\n        const deletedCount = result.affected || 0;\r\n        totalDeleted += deletedCount;\r\n\r\n        this.logger.debug(`批量删除块批次完成`, {\r\n          batch: Math.floor(i / batchSize) + 1,\r\n          batchSize: batch.length,\r\n          deleted: deletedCount,\r\n        });\r\n      }\r\n\r\n      this.logger.debug(`批量删除块完成`, {\r\n        requested: pointIds.length,\r\n        deleted: totalDeleted,\r\n      });\r\n      return totalDeleted;\r\n    } catch (error) {\r\n      this.logger.error(`批量删除块失败`, {\r\n        pointIds,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取块总数\r\n   * @param docId 可选的文档ID\r\n   * @param collectionId 可选的集合ID\r\n   * @param options 查询选项\r\n   * @returns 块总数\r\n   */\r\n  async getCount(\r\n    docId?: DocId,\r\n    collectionId?: CollectionId,\r\n    options: {\r\n      status?: 'pending' | 'processing' | 'completed' | 'failed';\r\n      syncStatus?: 'pending' | 'processing' | 'completed' | 'failed';\r\n    } = {},\r\n  ): Promise<number> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('chunk');\r\n\r\n      if (docId) {\r\n        queryBuilder.andWhere('chunk.docId = :docId', { docId });\r\n      }\r\n\r\n      if (collectionId) {\r\n        queryBuilder.andWhere('chunk.collectionId = :collectionId', {\r\n          collectionId,\r\n        });\r\n      }\r\n\r\n      if (options.status) {\r\n        queryBuilder.andWhere('chunk.embeddingStatus = :status', {\r\n          status: options.status,\r\n        });\r\n      }\r\n\r\n      if (options.syncStatus) {\r\n        queryBuilder.andWhere('chunk.syncStatus = :syncStatus', {\r\n          syncStatus: options.syncStatus,\r\n        });\r\n      }\r\n\r\n      return await queryBuilder.getCount();\r\n    } catch (error) {\r\n      this.logger.error(`获取块总数失败`, {\r\n        docId,\r\n        collectionId,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 分页获取块\r\n   * @param paginationOptions 分页选项\r\n   * @param docId 可选的文档ID\r\n   * @param collectionId 可选的集合ID\r\n   * @param options 查询选项\r\n   * @returns 分页结果\r\n   */\r\n  async findWithPagination(\r\n    paginationOptions: PaginationOptions = {},\r\n    docId?: DocId,\r\n    collectionId?: CollectionId,\r\n    options: {\r\n      status?: 'pending' | 'processing' | 'completed' | 'failed';\r\n      syncStatus?: 'pending' | 'processing' | 'completed' | 'failed';\r\n      includeContent?: boolean;\r\n    } = {},\r\n  ): Promise<PaginatedResult<Chunk>> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('chunk');\r\n\r\n      if (docId) {\r\n        queryBuilder.andWhere('chunk.docId = :docId', { docId });\r\n      }\r\n\r\n      if (collectionId) {\r\n        queryBuilder.andWhere('chunk.collectionId = :collectionId', {\r\n          collectionId,\r\n        });\r\n      }\r\n\r\n      if (options.status) {\r\n        queryBuilder.andWhere('chunk.embeddingStatus = :status', {\r\n          status: options.status,\r\n        });\r\n      }\r\n\r\n      if (options.syncStatus) {\r\n        queryBuilder.andWhere('chunk.syncStatus = :syncStatus', {\r\n          syncStatus: options.syncStatus,\r\n        });\r\n      }\r\n\r\n      if (!options.includeContent) {\r\n        queryBuilder.select([\r\n          'chunk.id',\r\n          'chunk.pointId',\r\n          'chunk.docId',\r\n          'chunk.collectionId',\r\n          'chunk.chunkIndex',\r\n          'chunk.title',\r\n          'chunk.contentLength',\r\n          'chunk.tokenCount',\r\n          'chunk.embeddingStatus',\r\n          'chunk.syncStatus',\r\n          'chunk.embeddedAt',\r\n          'chunk.syncedAt',\r\n          'chunk.error',\r\n          'chunk.metadata',\r\n          'chunk.created_at',\r\n          'chunk.updated_at',\r\n        ]);\r\n      }\r\n\r\n      return await super.findWithPagination(paginationOptions, queryBuilder);\r\n    } catch (error) {\r\n      this.logger.error(`分页获取块失败`, {\r\n        paginationOptions,\r\n        docId,\r\n        collectionId,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 搜索块内容\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @returns 匹配的块数组\r\n   */\r\n  async searchContent(\r\n    searchText: string,\r\n    options: {\r\n      collectionId?: CollectionId;\r\n      docId?: DocId;\r\n      limit?: number;\r\n      searchFields?: string[];\r\n      includeContent?: boolean;\r\n    } = {},\r\n  ): Promise<Chunk[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('chunk');\r\n\r\n      if (options.collectionId) {\r\n        queryBuilder.andWhere('chunk.collectionId = :collectionId', {\r\n          collectionId: options.collectionId,\r\n        });\r\n      }\r\n\r\n      if (options.docId) {\r\n        queryBuilder.andWhere('chunk.docId = :docId', { docId: options.docId });\r\n      }\r\n\r\n      const searchFields = options.searchFields || ['content', 'title'];\r\n      let firstField = true;\r\n\r\n      for (const field of searchFields) {\r\n        if (firstField) {\r\n          queryBuilder.andWhere(`chunk.${field} ILIKE :searchText`, {\r\n            searchText: `%${searchText}%`,\r\n          });\r\n          firstField = false;\r\n        } else {\r\n          queryBuilder.orWhere(`chunk.${field} ILIKE :searchText`, {\r\n            searchText: `%${searchText}%`,\r\n          });\r\n        }\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      if (!options.includeContent) {\r\n        queryBuilder.select([\r\n          'chunk.id',\r\n          'chunk.pointId',\r\n          'chunk.docId',\r\n          'chunk.collectionId',\r\n          'chunk.chunkIndex',\r\n          'chunk.title',\r\n          'chunk.contentLength',\r\n          'chunk.tokenCount',\r\n          'chunk.embeddingStatus',\r\n          'chunk.syncStatus',\r\n          'chunk.embeddedAt',\r\n          'chunk.syncedAt',\r\n          'chunk.error',\r\n          'chunk.metadata',\r\n          'chunk.created_at',\r\n          'chunk.updated_at',\r\n        ]);\r\n      }\r\n\r\n      queryBuilder.addOrderBy('chunk.chunkIndex', 'ASC');\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`搜索块内容失败`, {\r\n        searchText,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据时间范围查找块\r\n   * @param startTime 开始时间\r\n   * @param endTime 结束时间\r\n   * @param options 查询选项\r\n   * @returns 块数组\r\n   */\r\n  async findByTimeRange(\r\n    fieldNameOrStartTime: string | number,\r\n    startTimeOrEndTime: number,\r\n    endTimeOrOptions?:\r\n      | number\r\n      | {\r\n          collectionId?: CollectionId;\r\n          docId?: DocId;\r\n          status?: 'pending' | 'processing' | 'completed' | 'failed';\r\n          syncStatus?: 'pending' | 'processing' | 'completed' | 'failed';\r\n          limit?: number;\r\n          orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n        },\r\n    options?: FindManyOptions<Chunk>,\r\n  ): Promise<Chunk[]> {\r\n    // 如果调用的是旧的方法签名 (fieldName, startTime, endTime, options)\r\n    if (\r\n      typeof fieldNameOrStartTime === 'string' &&\r\n      typeof startTimeOrEndTime === 'number' &&\r\n      typeof endTimeOrOptions === 'number'\r\n    ) {\r\n      return super.findByTimeRange(\r\n        fieldNameOrStartTime,\r\n        startTimeOrEndTime,\r\n        endTimeOrOptions,\r\n        options,\r\n      );\r\n    }\r\n\r\n    // 如果调用的是新的方法签名 (startTime, endTime, options)\r\n    const startTime = fieldNameOrStartTime as number;\r\n    const endTime = startTimeOrEndTime;\r\n    const adaptedOptions = endTimeOrOptions as Record<string, unknown>;\r\n\r\n    const queryBuilder = this.createQueryBuilder('chunk').where(\r\n      'chunk.created_at BETWEEN :startTime AND :endTime',\r\n      { startTime, endTime },\r\n    );\r\n\r\n    if (adaptedOptions?.collectionId) {\r\n      queryBuilder.andWhere('chunk.collectionId = :collectionId', {\r\n        collectionId: adaptedOptions.collectionId,\r\n      });\r\n    }\r\n\r\n    if (adaptedOptions?.docId) {\r\n      queryBuilder.andWhere('chunk.docId = :docId', {\r\n        docId: adaptedOptions.docId,\r\n      });\r\n    }\r\n\r\n    if (adaptedOptions?.status) {\r\n      queryBuilder.andWhere('chunk.embeddingStatus = :status', {\r\n        status: adaptedOptions.status,\r\n      });\r\n    }\r\n\r\n    if (adaptedOptions?.syncStatus) {\r\n      queryBuilder.andWhere('chunk.syncStatus = :syncStatus', {\r\n        syncStatus: adaptedOptions.syncStatus,\r\n      });\r\n    }\r\n\r\n    if (adaptedOptions?.orderBy) {\r\n      Object.entries(adaptedOptions.orderBy).forEach(([field, direction]) => {\r\n        queryBuilder.addOrderBy(`chunk.${field}`, direction as 'ASC' | 'DESC');\r\n      });\r\n    } else {\r\n      queryBuilder.addOrderBy('chunk.created_at', 'DESC');\r\n    }\r\n\r\n    if (adaptedOptions?.limit) {\r\n      queryBuilder.limit(adaptedOptions.limit);\r\n    }\r\n\r\n    return await queryBuilder.getMany();\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('chunk').where(\r\n        'chunk.created_at BETWEEN :startTime AND :endTime',\r\n        { startTime, endTime },\r\n      );\r\n\r\n      if (options.collectionId) {\r\n        queryBuilder.andWhere('chunk.collectionId = :collectionId', {\r\n          collectionId: options.collectionId,\r\n        });\r\n      }\r\n\r\n      if (options.docId) {\r\n        queryBuilder.andWhere('chunk.docId = :docId', { docId: options.docId });\r\n      }\r\n\r\n      if (options.status) {\r\n        queryBuilder.andWhere('chunk.embeddingStatus = :status', {\r\n          status: options.status,\r\n        });\r\n      }\r\n\r\n      if (options.syncStatus) {\r\n        queryBuilder.andWhere('chunk.syncStatus = :syncStatus', {\r\n          syncStatus: options.syncStatus,\r\n        });\r\n      }\r\n\r\n      if (options.orderBy) {\r\n        Object.entries(options.orderBy).forEach(([field, direction]) => {\r\n          queryBuilder.addOrderBy(`chunk.${field}`, direction);\r\n        });\r\n      } else {\r\n        queryBuilder.addOrderBy('chunk.created_at', 'DESC');\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`根据时间范围查找块失败`, {\r\n        startTime,\r\n        endTime,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据文档ID统计块数量\r\n   * @param docId 文档ID\r\n   * @param options 查询选项\r\n   * @returns 块数量\r\n   */\r\n  async countByDocId(\r\n    docId: DocId,\r\n    options: {\r\n      status?: 'pending' | 'processing' | 'completed' | 'failed';\r\n      syncStatus?: 'pending' | 'processing' | 'completed' | 'failed';\r\n    } = {},\r\n  ): Promise<number> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('chunk').where(\r\n        'chunk.docId = :docId',\r\n        { docId },\r\n      );\r\n\r\n      if (options.status) {\r\n        queryBuilder.andWhere('chunk.embeddingStatus = :status', {\r\n          status: options.status,\r\n        });\r\n      }\r\n\r\n      if (options.syncStatus) {\r\n        queryBuilder.andWhere('chunk.syncStatus = :syncStatus', {\r\n          syncStatus: options.syncStatus,\r\n        });\r\n      }\r\n\r\n      return await queryBuilder.getCount();\r\n    } catch (error) {\r\n      this.logger.error(`统计文档块数量失败`, {\r\n        docId,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据文档ID统计已完成块数量\r\n   * @param docId 文档ID\r\n   * @returns 已完成块数量\r\n   */\r\n  async countCompletedByDocId(docId: DocId): Promise<number> {\r\n    try {\r\n      return await this.countByDocId(docId, {\r\n        status: 'completed',\r\n        syncStatus: 'completed',\r\n      });\r\n    } catch (error) {\r\n      this.logger.error(`统计文档已完成块数量失败`, {\r\n        docId,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据文档ID统计失败块数量\r\n   * @param docId 文档ID\r\n   * @returns 失败块数量\r\n   */\r\n  async countFailedByDocId(docId: DocId): Promise<number> {\r\n    try {\r\n      return await this.countByDocId(docId, {\r\n        status: 'failed',\r\n        syncStatus: 'failed',\r\n      });\r\n    } catch (error) {\r\n      this.logger.error(`统计文档失败块数量失败`, {\r\n        docId,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量更新块状态\r\n   * @param pointIds 点ID数组\r\n   * @param status 新状态\r\n   * @returns 批量操作结果\r\n   */\r\n  async batchUpdateStatus(\r\n    pointIds: PointId[],\r\n    status: 'pending' | 'processing' | 'completed' | 'failed',\r\n  ): Promise<BatchOperationResult> {\r\n    try {\r\n      const result = await this.updateBatch(pointIds, {\r\n        embeddingStatus: status,\r\n      });\r\n      this.logger.debug(`批量更新块状态完成`, {\r\n        requested: pointIds.length,\r\n        updated: result.success,\r\n        failed: result.failed,\r\n        status,\r\n      });\r\n      return result;\r\n    } catch (error) {\r\n      this.logger.error(`批量更新块状态失败`, {\r\n        pointIds,\r\n        status,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量更新同步状态\r\n   * @param pointIds 点ID数组\r\n   * @param syncStatus 新同步状态\r\n   * @returns 批量操作结果\r\n   */\r\n  async batchUpdateSyncStatus(\r\n    pointIds: PointId[],\r\n    syncStatus: 'pending' | 'processing' | 'completed' | 'failed',\r\n  ): Promise<BatchOperationResult> {\r\n    try {\r\n      const result = await this.updateBatch(pointIds, { syncStatus });\r\n      this.logger.debug(`批量更新块同步状态完成`, {\r\n        requested: pointIds.length,\r\n        updated: result.success,\r\n        failed: result.failed,\r\n        syncStatus,\r\n      });\r\n      return result;\r\n    } catch (error) {\r\n      this.logger.error(`批量更新块同步状态失败`, {\r\n        pointIds,\r\n        syncStatus,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取块统计信息\r\n   * @param collectionId 可选的集合ID\r\n   * @param docId 可选的文档ID\r\n   * @returns 统计信息\r\n   */\r\n  async getStatistics(\r\n    groupByOrOptions:\r\n      | string\r\n      | {\r\n          collectionId?: CollectionId;\r\n          docId?: DocId;\r\n        },\r\n    where?: FindOptionsWhere<Chunk>,\r\n  ): Promise<\r\n    | Record<string, number>\r\n    | {\r\n        total: number;\r\n        pending: number;\r\n        processing: number;\r\n        completed: number;\r\n        failed: number;\r\n        totalTokens: number;\r\n        avgContentLength: number;\r\n      }\r\n  > {\r\n    // 如果调用的是旧的方法签名 (collectionId, docId)\r\n    if (typeof groupByOrOptions === 'object' && where === undefined) {\r\n      const collectionId = groupByOrOptions.collectionId;\r\n      const docId = groupByOrOptions.docId;\r\n\r\n      try {\r\n        const queryBuilder = this.createQueryBuilder('chunk')\r\n          .select('COUNT(*)', 'total')\r\n          .addSelect(\r\n            'SUM(CASE WHEN embeddingStatus = :pending THEN 1 ELSE 0 END)',\r\n            'pending',\r\n          )\r\n          .addSelect(\r\n            'SUM(CASE WHEN embeddingStatus = :processing THEN 1 ELSE 0 END)',\r\n            'processing',\r\n          )\r\n          .addSelect(\r\n            'SUM(CASE WHEN embeddingStatus = :completed THEN 1 ELSE 0 END)',\r\n            'completed',\r\n          )\r\n          .addSelect(\r\n            'SUM(CASE WHEN embeddingStatus = :failed THEN 1 ELSE 0 END)',\r\n            'failed',\r\n          )\r\n          .addSelect('SUM(tokenCount)', 'totalTokens')\r\n          .addSelect('AVG(contentLength)', 'avgContentLength')\r\n          .setParameters({\r\n            pending: 'pending',\r\n            processing: 'processing',\r\n            completed: 'completed',\r\n            failed: 'failed',\r\n          });\r\n\r\n        if (collectionId) {\r\n          queryBuilder.andWhere('chunk.collectionId = :collectionId', {\r\n            collectionId,\r\n          });\r\n        }\r\n\r\n        if (docId) {\r\n          queryBuilder.andWhere('chunk.docId = :docId', { docId });\r\n        }\r\n\r\n        const result = await queryBuilder.getRawOne();\r\n\r\n        // 处理空结果的情况\r\n        if (!result) {\r\n          return {\r\n            total: 0,\r\n            pending: 0,\r\n            processing: 0,\r\n            completed: 0,\r\n            failed: 0,\r\n            totalTokens: 0,\r\n            avgContentLength: 0,\r\n          };\r\n        }\r\n\r\n        return {\r\n          total: parseInt(result.total, 10) || 0,\r\n          pending: parseInt(result.pending, 10) || 0,\r\n          processing: parseInt(result.processing, 10) || 0,\r\n          completed: parseInt(result.completed, 10) || 0,\r\n          failed: parseInt(result.failed, 10) || 0,\r\n          totalTokens: parseInt(result.totalTokens, 10) || 0,\r\n          avgContentLength: parseFloat(result.avgContentLength) || 0,\r\n        };\r\n      } catch (error) {\r\n        this.logger.error('获取块统计信息失败', {\r\n          collectionId,\r\n          docId,\r\n          error: (error as Error).message,\r\n        });\r\n        throw error;\r\n      }\r\n    }\r\n\r\n    // 调用父类方法\r\n    return super.getStatistics(groupByOrOptions as string, where);\r\n  }\r\n\r\n  /**\r\n   * 批量创建块（带事务管理器）\r\n   * @param chunks 块数组\r\n   * @param manager 事务管理器\r\n   * @returns 创建的块数组\r\n   */\r\n  async createBatchWithManager(\r\n    chunks: Partial<Chunk>[],\r\n    manager: { save: (entities: unknown[]) => Promise<unknown> },\r\n  ): Promise<Chunk[]> {\r\n    try {\r\n      // 预处理块数据，计算内容长度\r\n      const processedChunks = chunks.map((chunk) => ({\r\n        ...chunk,\r\n        contentLength: chunk.content ? chunk.content.length : 0,\r\n      }));\r\n\r\n      const entities = this.repository.create(processedChunks);\r\n      const results = (await manager.save(entities)) as Chunk[];\r\n      this.logger.debug(`批量创建块成功`, {\r\n        count: results.length,\r\n      });\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`批量创建块失败`, {\r\n        count: chunks.length,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据文档ID删除块（带事务管理器）\r\n   * @param docId 文档ID\r\n   * @param manager 事务管理器\r\n   * @returns 删除的块数量\r\n   */\r\n  async deleteByDocIdWithManager(\r\n    docId: DocId,\r\n    manager: { delete: (entity: unknown, where: unknown) => Promise<{ affected?: number }> },\r\n  ): Promise<number> {\r\n    try {\r\n      const result = await manager.delete(Chunk, { docId });\r\n      const deletedCount = result.affected || 0;\r\n      this.logger.debug(`根据文档ID删除块成功`, {\r\n        docId,\r\n        count: deletedCount,\r\n      });\r\n      return deletedCount;\r\n    } catch (error) {\r\n      this.logger.error(`根据文档ID删除块失败`, {\r\n        docId,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\CollectionAggregateRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\CollectionRepository.ts","messages":[{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.limit\" declaration.","line":279,"column":3,"nodeType":"Block","endLine":284,"endColumn":6,"fix":{"range":[6992,7090],"text":"/**\r\n   * 模糊搜索集合\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @param options.limit\n   * @param options.status\n   * @returns 集合数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.status\" declaration.","line":279,"column":3,"nodeType":"Block","endLine":284,"endColumn":6,"fix":{"range":[6992,7090],"text":"/**\r\n   * 模糊搜索集合\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @param options.limit\n   * @param options.status\n   * @param options.limit\n   * @param options.status\n   * @returns 集合数组\r\n   */"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"import { DataSource, FindOptionsWhere, Not } from 'typeorm';\r\nimport {\r\n  BaseRepository,\r\n  PaginationOptions,\r\n  PaginatedResult,\r\n} from './BaseRepository.js';\r\nimport { Collection } from '../entities/Collection.js';\r\nimport { Logger } from '@logging/logger.js';\r\nimport { CollectionId } from '@domain/entities/types.js';\r\n\r\n/**\r\n * 集合Repository\r\n * 提供集合相关的数据库操作\r\n * 优化了查询性能和批量操作\r\n */\r\nexport class CollectionRepository extends BaseRepository<Collection> {\r\n  /**\r\n   * 创建CollectionRepository实例\r\n   * @param dataSource TypeORM数据源\r\n   * @param logger 日志记录器\r\n   */\r\n  constructor(dataSource: DataSource, logger: Logger) {\r\n    super(dataSource, Collection, logger);\r\n  }\r\n\r\n  /**\r\n   * 根据名称查找集合\r\n   * @param name 集合名称\r\n   * @returns 找到的集合或null\r\n   */\r\n  async findByName(name: string): Promise<Collection | null> {\r\n    try {\r\n      const result = await this.repository.findOne({\r\n        where: {\r\n          name,\r\n          deleted: false,\r\n        } as FindOptionsWhere<Collection>,\r\n      });\r\n      return result || null;\r\n    } catch (error) {\r\n      this.logger.error(`根据名称查找集合失败`, {\r\n        name,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据集合ID查找集合\r\n   * @param collectionId 集合ID\r\n   * @returns 找到的集合或null\r\n   */\r\n  async findByCollectionId(\r\n    collectionId: CollectionId,\r\n  ): Promise<Collection | null> {\r\n    try {\r\n      const result = await this.repository.findOne({\r\n        where: {\r\n          collectionId,\r\n          deleted: false,\r\n        } as FindOptionsWhere<Collection>,\r\n      });\r\n      return result || null;\r\n    } catch (error) {\r\n      this.logger.error(`根据集合ID查找集合失败`, {\r\n        collectionId,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取所有活跃集合\r\n   * @returns 集合数组\r\n   */\r\n  async findAllActive(): Promise<Collection[]> {\r\n    try {\r\n      const results = await this.repository.find({\r\n        where: {\r\n          deleted: false,\r\n          status: 'active',\r\n        } as FindOptionsWhere<Collection>,\r\n        order: { created_at: 'DESC' },\r\n      });\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`获取所有活跃集合失败`, {\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 分页获取集合\r\n   * @param paginationOptions 分页选项\r\n   * @param status 可选的状态过滤\r\n   * @returns 分页结果\r\n   */\r\n  async findWithPagination(\r\n    paginationOptions: PaginationOptions = {},\r\n    status?: 'active' | 'inactive' | 'archived',\r\n  ): Promise<PaginatedResult<Collection>> {\r\n    try {\r\n      // 创建QueryBuilder而不是使用where条件对象\r\n      const queryBuilder = this.createQueryBuilder('collection').where(\r\n        'collection.deleted = :deleted',\r\n        { deleted: false },\r\n      );\r\n\r\n      if (status) {\r\n        queryBuilder.andWhere('collection.status = :status', { status });\r\n      }\r\n\r\n      return await super.findWithPagination(paginationOptions, queryBuilder);\r\n    } catch (error) {\r\n      this.logger.error(`分页获取集合失败`, {\r\n        paginationOptions,\r\n        status,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 分页获取集合（简化版接口，供 CollectionAggregateRepository 使用）\r\n   * @param page 页码\r\n   * @param limit 每页数量\r\n   * @returns 分页结果\r\n   */\r\n  async findPaginated(page: number, limit: number): Promise<PaginatedResult<Collection>> {\r\n    const paginationOptions: PaginationOptions = { page, limit };\r\n    return await this.findWithPagination(paginationOptions);\r\n  }\r\n\r\n  /**\r\n   * 更新集合\r\n   * @param id 集合ID\r\n   * @param data 更新数据\r\n   * @returns 更新后的集合\r\n   */\r\n  async updateCollection(\r\n    id: CollectionId,\r\n    data: Partial<\r\n      Pick<Collection, 'name' | 'description' | 'status' | 'config'>\r\n    >,\r\n  ): Promise<Collection | null> {\r\n    try {\r\n      const result = await this.update(id, data);\r\n      if (result) {\r\n        this.logger.debug(`更新集合成功`, {\r\n          id,\r\n          updatedFields: Object.keys(data),\r\n        });\r\n      }\r\n      return result;\r\n    } catch (error) {\r\n      this.logger.error(`更新集合失败`, {\r\n        id,\r\n        data,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查集合名称是否存在\r\n   * @param name 集合名称\r\n   * @param excludeId 排除的ID（用于更新时检查）\r\n   * @returns 是否存在\r\n   */\r\n  async existsByName(name: string, excludeId?: CollectionId): Promise<boolean> {\r\n    try {\r\n      const whereCondition: FindOptionsWhere<Collection> = {\r\n        name,\r\n        deleted: false,\r\n      };\r\n\r\n      if (excludeId) {\r\n        whereCondition.id = Not(excludeId);\r\n      }\r\n\r\n      const count = await this.repository.count({ where: whereCondition });\r\n      return count > 0;\r\n    } catch (error) {\r\n      this.logger.error(`检查集合名称存在性失败`, {\r\n        name,\r\n        excludeId,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取集合总数\r\n   * @param status 可选的状态过滤\r\n   * @returns 集合总数\r\n   */\r\n  async getCount(status?: 'active' | 'inactive' | 'archived'): Promise<number> {\r\n    try {\r\n      const whereCondition: FindOptionsWhere<Collection> = { deleted: false };\r\n      if (status) {\r\n        whereCondition.status = status;\r\n      }\r\n\r\n      return await this.repository.count({ where: whereCondition });\r\n    } catch (error) {\r\n      this.logger.error(`获取集合总数失败`, {\r\n        status,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据前缀查找集合\r\n   * @param prefix 前缀\r\n   * @param limit 结果限制\r\n   * @returns 集合数组\r\n   */\r\n  async findByPrefix(prefix: string, limit?: number): Promise<Collection[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('collection')\r\n        .where('collection.name LIKE :prefix', { prefix: `${prefix}%` })\r\n        .andWhere('collection.deleted = :deleted', { deleted: false })\r\n        .orderBy('collection.created_at', 'DESC');\r\n\r\n      if (limit) {\r\n        queryBuilder.limit(limit);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`根据前缀查找集合失败`, {\r\n        prefix,\r\n        limit,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据后缀查找集合\r\n   * @param suffix 后缀\r\n   * @param limit 结果限制\r\n   * @returns 集合数组\r\n   */\r\n  async findBySuffix(suffix: string, limit?: number): Promise<Collection[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('collection')\r\n        .where('collection.name LIKE :suffix', { suffix: `%${suffix}` })\r\n        .andWhere('collection.deleted = :deleted', { deleted: false })\r\n        .orderBy('collection.created_at', 'DESC');\r\n\r\n      if (limit) {\r\n        queryBuilder.limit(limit);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`根据后缀查找集合失败`, {\r\n        suffix,\r\n        limit,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 模糊搜索集合\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @returns 集合数组\r\n   */\r\n  async searchCollections(\r\n    searchText: string,\r\n    options: {\r\n      limit?: number;\r\n      status?: 'active' | 'inactive' | 'archived';\r\n    } = {},\r\n  ): Promise<Collection[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('collection')\r\n        .where('collection.name ILIKE :searchText', {\r\n          searchText: `%${searchText}%`,\r\n        })\r\n        .orWhere('collection.description ILIKE :searchText', {\r\n          searchText: `%${searchText}%`,\r\n        })\r\n        .andWhere('collection.deleted = :deleted', { deleted: false });\r\n\r\n      if (options.status) {\r\n        queryBuilder.andWhere('collection.status = :status', {\r\n          status: options.status,\r\n        });\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      queryBuilder.orderBy('collection.created_at', 'DESC');\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`模糊搜索集合失败`, {\r\n        searchText,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取集合统计信息\r\n   * @returns 统计信息\r\n   */\r\n  async getStatistics(): Promise<{\r\n    total: number;\r\n    active: number;\r\n    inactive: number;\r\n    archived: number;\r\n    totalDocuments: number;\r\n    totalChunks: number;\r\n  }> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('collection')\r\n        .select('COUNT(*)', 'total')\r\n        .addSelect(\r\n          'SUM(CASE WHEN status = :active THEN 1 ELSE 0 END)',\r\n          'active',\r\n        )\r\n        .addSelect(\r\n          'SUM(CASE WHEN status = :inactive THEN 1 ELSE 0 END)',\r\n          'inactive',\r\n        )\r\n        .addSelect(\r\n          'SUM(CASE WHEN status = :archived THEN 1 ELSE 0 END)',\r\n          'archived',\r\n        )\r\n        .addSelect('SUM(documentCount)', 'totalDocuments')\r\n        .addSelect('SUM(chunkCount)', 'totalChunks')\r\n        .where('collection.deleted = :deleted', { deleted: false })\r\n        .setParameters({\r\n          active: 'active',\r\n          inactive: 'inactive',\r\n          archived: 'archived',\r\n        });\r\n\r\n      const result = await queryBuilder.getRawOne();\r\n\r\n      // 处理空结果的情况\r\n      if (!result) {\r\n        return {\r\n          total: 0,\r\n          active: 0,\r\n          inactive: 0,\r\n          archived: 0,\r\n          totalDocuments: 0,\r\n          totalChunks: 0,\r\n        };\r\n      }\r\n\r\n      return {\r\n        total: parseInt(result.total, 10) || 0,\r\n        active: parseInt(result.active, 10) || 0,\r\n        inactive: parseInt(result.inactive, 10) || 0,\r\n        archived: parseInt(result.archived, 10) || 0,\r\n        totalDocuments: parseInt(result.totalDocuments, 10) || 0,\r\n        totalChunks: parseInt(result.totalChunks, 10) || 0,\r\n      };\r\n    } catch (error) {\r\n      this.logger.error(`获取集合统计信息失败`, {\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量更新集合状态\r\n   * @param ids 集合ID数组\r\n   * @param status 新状态\r\n   * @returns 批量操作结果\r\n   */\r\n  async batchUpdateStatus(\r\n    ids: CollectionId[],\r\n    status: 'active' | 'inactive' | 'archived',\r\n  ): Promise<{ updated: number; failed: number }> {\r\n    try {\r\n      const result = await this.updateBatch(ids, { status });\r\n      const response = {\r\n        updated: result.success,\r\n        failed: result.failed,\r\n      };\r\n      this.logger.debug(`批量更新集合状态完成`, {\r\n        requested: ids.length,\r\n        updated: response.updated,\r\n        failed: response.failed,\r\n        status,\r\n      });\r\n      return response;\r\n    } catch (error) {\r\n      this.logger.error(`批量更新集合状态失败`, {\r\n        ids,\r\n        status,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量软删除集合\r\n   * @param ids 集合ID数组\r\n   * @returns 删除的记录数\r\n   */\r\n  async batchSoftDelete(ids: CollectionId[]): Promise<number> {\r\n    try {\r\n      const deletedCount = await this.softDeleteBatch(ids);\r\n      this.logger.debug(`批量软删除集合完成`, {\r\n        requested: ids.length,\r\n        deleted: deletedCount,\r\n      });\r\n      return deletedCount;\r\n    } catch (error) {\r\n      this.logger.error(`批量软删除集合失败`, {\r\n        ids,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新集合文档数量\r\n   * @param id 集合ID\r\n   * @param count 文档数量\r\n   * @returns 是否更新成功\r\n   */\r\n  async updateDocumentCount(id: CollectionId, count: number): Promise<boolean> {\r\n    try {\r\n      const result = await this.update(id, { documentCount: count });\r\n      if (result) {\r\n        this.logger.debug(`更新集合文档数量成功`, { id, count });\r\n      }\r\n      return !!result;\r\n    } catch (error) {\r\n      this.logger.error(`更新集合文档数量失败`, {\r\n        id,\r\n        count,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新集合块数量\r\n   * @param id 集合ID\r\n   * @param count 块数量\r\n   * @returns 是否更新成功\r\n   */\r\n  async updateChunkCount(id: CollectionId, count: number): Promise<boolean> {\r\n    try {\r\n      const result = await this.update(id, { chunkCount: count });\r\n      if (result) {\r\n        this.logger.debug(`更新集合块数量成功`, { id, count });\r\n      }\r\n      return !!result;\r\n    } catch (error) {\r\n      this.logger.error(`更新集合块数量失败`, {\r\n        id,\r\n        count,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新最后同步时间\r\n   * @param id 集合ID\r\n   * @returns 是否更新成功\r\n   */\r\n  async updateLastSyncTime(id: CollectionId): Promise<boolean> {\r\n    try {\r\n      const result = await this.update(id, { lastSyncAt: Date.now() });\r\n      if (result) {\r\n        this.logger.debug(`更新集合最后同步时间成功`, { id });\r\n      }\r\n      return !!result;\r\n    } catch (error) {\r\n      this.logger.error(`更新集合最后同步时间失败`, {\r\n        id,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\CompatibilityAdapter.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3561,3564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3561,3564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3876,3879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3876,3879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":257,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6447,6450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6447,6450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":268,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6755,6758],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6755,6758],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":408,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":408,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9874,9877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9874,9877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":418,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":418,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10145,10148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10145,10148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\DocRepository.ts","messages":[{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.status\" declaration.","line":27,"column":3,"nodeType":"Block","endLine":32,"endColumn":6,"fix":{"range":[695,799],"text":"/**\r\n   * 根据集合ID查找文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.limit\" declaration.","line":27,"column":3,"nodeType":"Block","endLine":32,"endColumn":6,"fix":{"range":[695,799],"text":"/**\r\n   * 根据集合ID查找文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.orderBy\" declaration.","line":27,"column":3,"nodeType":"Block","endLine":32,"endColumn":6,"fix":{"range":[695,799],"text":"/**\r\n   * 根据集合ID查找文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.status\" declaration.","line":105,"column":3,"nodeType":"Block","endLine":109,"endColumn":6,"fix":{"range":[2666,2737],"text":"/**\r\n   * 获取所有活跃文档\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.limit\" declaration.","line":105,"column":3,"nodeType":"Block","endLine":109,"endColumn":6,"fix":{"range":[2666,2737],"text":"/**\r\n   * 获取所有活跃文档\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.orderBy\" declaration.","line":105,"column":3,"nodeType":"Block","endLine":109,"endColumn":6,"fix":{"range":[2666,2737],"text":"/**\r\n   * 获取所有活跃文档\r\n   * @param options 查询选项\r\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.status\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"query.page\" declaration.","line":426,"column":3,"nodeType":"Block","endLine":431,"endColumn":6,"fix":{"range":[10451,10557],"text":"/**\r\n   * 根据集合ID分页查找文档\r\n   * @param collectionId 集合ID\r\n   * @param query 分页查询参数\r\n   * @param query.page\n   * @param query.limit\n   * @param query.status\n   * @returns 分页结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"query.limit\" declaration.","line":426,"column":3,"nodeType":"Block","endLine":431,"endColumn":6,"fix":{"range":[10451,10557],"text":"/**\r\n   * 根据集合ID分页查找文档\r\n   * @param collectionId 集合ID\r\n   * @param query 分页查询参数\r\n   * @param query.page\n   * @param query.limit\n   * @param query.status\n   * @param query.page\n   * @param query.limit\n   * @param query.status\n   * @returns 分页结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"query.status\" declaration.","line":426,"column":3,"nodeType":"Block","endLine":431,"endColumn":6,"fix":{"range":[10451,10557],"text":"/**\r\n   * 根据集合ID分页查找文档\r\n   * @param collectionId 集合ID\r\n   * @param query 分页查询参数\r\n   * @param query.page\n   * @param query.limit\n   * @param query.status\n   * @param query.page\n   * @param query.limit\n   * @param query.status\n   * @param query.page\n   * @param query.limit\n   * @param query.status\n   * @returns 分页结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.collectionId\" declaration.","line":457,"column":3,"nodeType":"Block","endLine":462,"endColumn":6,"fix":{"range":[11181,11277],"text":"/**\r\n   * 根据状态查找文档\r\n   * @param status 文档状态\r\n   * @param options 查询选项\r\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.limit\" declaration.","line":457,"column":3,"nodeType":"Block","endLine":462,"endColumn":6,"fix":{"range":[11181,11277],"text":"/**\r\n   * 根据状态查找文档\r\n   * @param status 文档状态\r\n   * @param options 查询选项\r\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.orderBy\" declaration.","line":457,"column":3,"nodeType":"Block","endLine":462,"endColumn":6,"fix":{"range":[11181,11277],"text":"/**\r\n   * 根据状态查找文档\r\n   * @param status 文档状态\r\n   * @param options 查询选项\r\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.limit\" declaration.","line":539,"column":3,"nodeType":"Block","endLine":544,"endColumn":6,"fix":{"range":[13354,13456],"text":"/**\r\n   * 查找已删除的文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.orderBy\" declaration.","line":539,"column":3,"nodeType":"Block","endLine":544,"endColumn":6,"fix":{"range":[13354,13456],"text":"/**\r\n   * 查找已删除的文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.limit\" declaration.","line":588,"column":3,"nodeType":"Block","endLine":593,"endColumn":6,"fix":{"range":[14555,14656],"text":"/**\r\n   * 查找失败的文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.orderBy\" declaration.","line":588,"column":3,"nodeType":"Block","endLine":593,"endColumn":6,"fix":{"range":[14555,14656],"text":"/**\r\n   * 查找失败的文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.limit\" declaration.","line":631,"column":3,"nodeType":"Block","endLine":636,"endColumn":6,"fix":{"range":[15728,15830],"text":"/**\r\n   * 查找已完成的文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.orderBy\" declaration.","line":631,"column":3,"nodeType":"Block","endLine":636,"endColumn":6,"fix":{"range":[15728,15830],"text":"/**\r\n   * 查找已完成的文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @param options.limit\n   * @param options.orderBy\n   * @param options.limit\n   * @param options.orderBy\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.collectionId\" declaration.","line":674,"column":3,"nodeType":"Block","endLine":680,"endColumn":6,"fix":{"range":[16909,17036],"text":"/**\r\n   * 根据时间范围查找文档\r\n   * @param startTime 开始时间\r\n   * @param endTime 结束时间\r\n   * @param options 查询选项\r\n   * @param options.collectionId\n   * @param options.status\n   * @param options.limit\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.status\" declaration.","line":674,"column":3,"nodeType":"Block","endLine":680,"endColumn":6,"fix":{"range":[16909,17036],"text":"/**\r\n   * 根据时间范围查找文档\r\n   * @param startTime 开始时间\r\n   * @param endTime 结束时间\r\n   * @param options 查询选项\r\n   * @param options.collectionId\n   * @param options.status\n   * @param options.limit\n   * @param options.collectionId\n   * @param options.status\n   * @param options.limit\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.limit\" declaration.","line":674,"column":3,"nodeType":"Block","endLine":680,"endColumn":6,"fix":{"range":[16909,17036],"text":"/**\r\n   * 根据时间范围查找文档\r\n   * @param startTime 开始时间\r\n   * @param endTime 结束时间\r\n   * @param options 查询选项\r\n   * @param options.collectionId\n   * @param options.status\n   * @param options.limit\n   * @param options.collectionId\n   * @param options.status\n   * @param options.limit\n   * @param options.collectionId\n   * @param options.status\n   * @param options.limit\n   * @returns 文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.collectionId\" declaration.","line":729,"column":3,"nodeType":"Block","endLine":734,"endColumn":6,"fix":{"range":[18294,18395],"text":"/**\r\n   * 搜索文档内容\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.searchFields\n   * @returns 匹配的文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.limit\" declaration.","line":729,"column":3,"nodeType":"Block","endLine":734,"endColumn":6,"fix":{"range":[18294,18395],"text":"/**\r\n   * 搜索文档内容\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.searchFields\n   * @returns 匹配的文档数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.searchFields\" declaration.","line":729,"column":3,"nodeType":"Block","endLine":734,"endColumn":6,"fix":{"range":[18294,18395],"text":"/**\r\n   * 搜索文档内容\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.searchFields\n   * @param options.collectionId\n   * @param options.limit\n   * @param options.searchFields\n   * @returns 匹配的文档数组\r\n   */"}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":961,"column":29,"severity":1,"nodeType":null,"fix":{"range":[24311,24368],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":25,"fixableErrorCount":0,"fixableWarningCount":25,"source":"import { DataSource, FindOptionsWhere, Not, In, Between, EntityManager } from 'typeorm';\r\nimport {\r\n  BaseRepository,\r\n  PaginationOptions,\r\n  PaginatedResult,\r\n  BatchOperationResult,\r\n} from './BaseRepository.js';\r\nimport { Doc } from '../entities/Doc.js';\r\nimport { Logger } from '@logging/logger.js';\r\nimport { DocId, CollectionId } from '@domain/entities/types.js';\r\n\r\n/**\r\n * 文档Repository\r\n * 提供文档相关的数据库操作\r\n * 优化了查询性能和批量操作\r\n */\r\nexport class DocRepository extends BaseRepository<Doc> {\r\n  /**\r\n   * 创建DocRepository实例\r\n   * @param dataSource TypeORM数据源\r\n   * @param logger 日志记录器\r\n   */\r\n  constructor(dataSource: DataSource, logger: Logger) {\r\n    super(dataSource, Doc, logger);\r\n  }\r\n\r\n  /**\r\n   * 根据集合ID查找文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @returns 文档数组\r\n   */\r\n  async findByCollectionId(\r\n    collectionId: CollectionId,\r\n    options: {\r\n      status?: 'new' | 'processing' | 'completed' | 'failed';\r\n      limit?: number;\r\n      orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n    } = {},\r\n  ): Promise<Doc[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc')\r\n        .where('doc.collectionId = :collectionId', { collectionId })\r\n        .andWhere('doc.deleted = :deleted', { deleted: false });\r\n\r\n      if (options.status) {\r\n        queryBuilder.andWhere('doc.status = :status', {\r\n          status: options.status,\r\n        });\r\n      }\r\n\r\n      if (options.orderBy) {\r\n        Object.entries(options.orderBy).forEach(([field, direction]) => {\r\n          queryBuilder.addOrderBy(`doc.${field}`, direction);\r\n        });\r\n      } else {\r\n        queryBuilder.addOrderBy('doc.created_at', 'DESC');\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`根据集合ID查找文档失败`, {\r\n        collectionId,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据键值查找文档\r\n   * @param collectionId 集合ID\r\n   * @param key 文档键值\r\n   * @returns 找到的文档或null\r\n   */\r\n  async findByCollectionAndKey(\r\n    collectionId: CollectionId,\r\n    key: string,\r\n  ): Promise<Doc | null> {\r\n    try {\r\n      const result = await this.repository.findOne({\r\n        where: {\r\n          collectionId,\r\n          key,\r\n          deleted: false,\r\n        } as FindOptionsWhere<Doc>,\r\n      });\r\n      return result || null;\r\n    } catch (error) {\r\n      this.logger.error(`根据集合和键值查找文档失败`, {\r\n        collectionId,\r\n        key,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取所有活跃文档\r\n   * @param options 查询选项\r\n   * @returns 文档数组\r\n   */\r\n  async findAllActive(\r\n    options: {\r\n      status?: 'new' | 'processing' | 'completed' | 'failed';\r\n      limit?: number;\r\n      orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n    } = {},\r\n  ): Promise<Doc[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc').where(\r\n        'doc.deleted = :deleted',\r\n        { deleted: false },\r\n      );\r\n\r\n      if (options.status) {\r\n        queryBuilder.andWhere('doc.status = :status', {\r\n          status: options.status,\r\n        });\r\n      }\r\n\r\n      if (options.orderBy) {\r\n        Object.entries(options.orderBy).forEach(([field, direction]) => {\r\n          queryBuilder.addOrderBy(`doc.${field}`, direction);\r\n        });\r\n      } else {\r\n        queryBuilder.addOrderBy('doc.created_at', 'DESC');\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`获取所有活跃文档失败`, {\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 分页获取文档\r\n   * @param paginationOptions 分页选项\r\n   * @param collectionId 可选的集合ID\r\n   * @param status 可选的状态过滤\r\n   * @returns 分页结果\r\n   */\r\n  async findWithPagination(\r\n    paginationOptions: PaginationOptions = {},\r\n    collectionId?: CollectionId,\r\n    status?: 'new' | 'processing' | 'completed' | 'failed',\r\n  ): Promise<PaginatedResult<Doc>> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc').where(\r\n        'doc.deleted = :deleted',\r\n        { deleted: false },\r\n      );\r\n\r\n      if (collectionId) {\r\n        queryBuilder.andWhere('doc.collectionId = :collectionId', {\r\n          collectionId,\r\n        });\r\n      }\r\n\r\n      if (status) {\r\n        queryBuilder.andWhere('doc.status = :status', { status });\r\n      }\r\n\r\n      return await super.findWithPagination(paginationOptions, queryBuilder);\r\n    } catch (error) {\r\n      this.logger.error(`分页获取文档失败`, {\r\n        paginationOptions,\r\n        collectionId,\r\n        status,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 分页获取文档（简化版接口，供 DocumentAggregateRepository 使用）\r\n   * @param page 页码\r\n   * @param limit 每页数量\r\n   * @returns 分页结果\r\n   */\r\n  async findPaginated(page: number, limit: number): Promise<PaginatedResult<Doc>> {\r\n    const paginationOptions: PaginationOptions = { page, limit };\r\n    return await this.findWithPagination(paginationOptions);\r\n  }\r\n\r\n  /**\r\n   * 获取文档总数\r\n   * @param collectionId 可选的集合ID\r\n   * @param status 可选的状态过滤\r\n   * @returns 文档总数\r\n   */\r\n  async getCount(\r\n    collectionId?: CollectionId,\r\n    status?: 'new' | 'processing' | 'completed' | 'failed',\r\n  ): Promise<number> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc').where(\r\n        'doc.deleted = :deleted',\r\n        { deleted: false },\r\n      );\r\n\r\n      if (collectionId) {\r\n        queryBuilder.andWhere('doc.collectionId = :collectionId', {\r\n          collectionId,\r\n        });\r\n      }\r\n\r\n      if (status) {\r\n        queryBuilder.andWhere('doc.status = :status', { status });\r\n      }\r\n\r\n      return await queryBuilder.getCount();\r\n    } catch (error) {\r\n      this.logger.error(`获取文档总数失败`, {\r\n        collectionId,\r\n        status,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 软删除文档\r\n   * @param id 文档ID\r\n   * @returns 是否删除成功\r\n   */\r\n  async softDelete(id: DocId): Promise<boolean> {\r\n    try {\r\n      const result = await this.repository.update(id, {\r\n        deleted: true,\r\n        deleted_at: Date.now(),\r\n        updated_at: Date.now(),\r\n      });\r\n      const success = (result.affected || 0) > 0;\r\n      if (success) {\r\n        this.logger.debug(`软删除文档成功`, { id });\r\n      }\r\n      return success;\r\n    } catch (error) {\r\n      this.logger.error(`软删除文档失败`, {\r\n        id,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量软删除文档\r\n   * @param ids 文档ID数组\r\n   * @returns 删除的记录数\r\n   */\r\n  async batchSoftDelete(ids: DocId[]): Promise<number> {\r\n    try {\r\n      const deletedCount = await this.softDeleteBatch(ids);\r\n      this.logger.debug(`批量软删除文档完成`, {\r\n        requested: ids.length,\r\n        deleted: deletedCount,\r\n      });\r\n      return deletedCount;\r\n    } catch (error) {\r\n      this.logger.error(`批量软删除文档失败`, {\r\n        ids,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 恢复已删除的文档\r\n   * @param id 文档ID\r\n   * @returns 是否恢复成功\r\n   */\r\n  async restore(id: DocId): Promise<boolean> {\r\n    try {\r\n      const result = await this.repository.update(id, {\r\n        deleted: false,\r\n        deleted_at: () => 'NULL',\r\n        updated_at: Date.now(),\r\n      });\r\n      const success = (result.affected || 0) > 0;\r\n      if (success) {\r\n        this.logger.debug(`恢复文档成功`, { id });\r\n      }\r\n      return success;\r\n    } catch (error) {\r\n      this.logger.error(`恢复文档失败`, {\r\n        id,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量恢复文档\r\n   * @param ids 文档ID数组\r\n   * @returns 恢复的记录数\r\n   */\r\n  async batchRestore(ids: DocId[]): Promise<number> {\r\n    try {\r\n      const result = await this.repository\r\n        .createQueryBuilder()\r\n        .update(Doc)\r\n        .set({\r\n          deleted: false,\r\n          deleted_at: () => 'NULL',\r\n          updated_at: Date.now(),\r\n        })\r\n        .where('id IN (:...ids)', { ids })\r\n        .execute();\r\n\r\n      const restoredCount = result.affected || 0;\r\n      this.logger.debug(`批量恢复文档完成`, {\r\n        requested: ids.length,\r\n        restored: restoredCount,\r\n      });\r\n      return restoredCount;\r\n    } catch (error) {\r\n      this.logger.error(`批量恢复文档失败`, {\r\n        ids,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据内容哈希查找文档\r\n   * @param contentHash 内容哈希\r\n   * @returns 找到的文档或null\r\n   */\r\n  async findByContentHash(contentHash: string): Promise<Doc | null> {\r\n    try {\r\n      const result = await this.repository.findOne({\r\n        where: {\r\n          content_hash: contentHash,\r\n          deleted: false,\r\n        } as FindOptionsWhere<Doc>,\r\n      });\r\n      return result || null;\r\n    } catch (error) {\r\n      this.logger.error(`根据内容哈希查找文档失败`, {\r\n        contentHash,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量查找内容哈希\r\n   * @param contentHashes 内容哈希数组\r\n   * @returns 文档数组\r\n   */\r\n  async findByContentHashes(contentHashes: string[]): Promise<Doc[]> {\r\n    try {\r\n      if (contentHashes.length === 0) {\r\n        return [];\r\n      }\r\n\r\n      const results = await this.repository.find({\r\n        where: {\r\n          content_hash: In(contentHashes),\r\n          deleted: false,\r\n        } as FindOptionsWhere<Doc>,\r\n      });\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`批量查找内容哈希失败`, {\r\n        contentHashes,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新文档基本信息\r\n   * @param id 文档ID\r\n   * @param data 更新数据\r\n   * @returns 更新后的文档\r\n   */\r\n  async updateDocInfo(\r\n    id: DocId,\r\n    data: Partial<Pick<Doc, 'name' | 'mime' | 'size_bytes'>>,\r\n  ): Promise<Doc | null> {\r\n    try {\r\n      const result = await this.update(id, data);\r\n      if (result) {\r\n        this.logger.debug(`更新文档基本信息成功`, {\r\n          id,\r\n          updatedFields: Object.keys(data),\r\n        });\r\n      }\r\n      return result;\r\n    } catch (error) {\r\n      this.logger.error(`更新文档基本信息失败`, {\r\n        id,\r\n        data,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据集合ID分页查找文档\r\n   * @param collectionId 集合ID\r\n   * @param query 分页查询参数\r\n   * @returns 分页结果\r\n   */\r\n  async findByCollectionIdPaginated(\r\n    collectionId: CollectionId,\r\n    query: {\r\n      page?: number;\r\n      limit?: number;\r\n      status?: 'new' | 'processing' | 'completed' | 'failed';\r\n    },\r\n  ): Promise<PaginatedResult<Doc>> {\r\n    try {\r\n      const { page = 1, limit = 10, status } = query;\r\n      return await this.findWithPagination(\r\n        { page, limit },\r\n        collectionId,\r\n        status,\r\n      );\r\n    } catch (error) {\r\n      this.logger.error(`根据集合ID分页查找文档失败`, {\r\n        collectionId,\r\n        query,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据状态查找文档\r\n   * @param status 文档状态\r\n   * @param options 查询选项\r\n   * @returns 文档数组\r\n   */\r\n  async findByStatus(\r\n    status: 'new' | 'processing' | 'completed' | 'failed',\r\n    options: {\r\n      collectionId?: CollectionId;\r\n      limit?: number;\r\n      orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n    } = {},\r\n  ): Promise<Doc[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc')\r\n        .where('doc.status = :status', { status })\r\n        .andWhere('doc.deleted = :deleted', { deleted: false });\r\n\r\n      if (options.collectionId) {\r\n        queryBuilder.andWhere('doc.collectionId = :collectionId', {\r\n          collectionId: options.collectionId,\r\n        });\r\n      }\r\n\r\n      if (options.orderBy) {\r\n        Object.entries(options.orderBy).forEach(([field, direction]) => {\r\n          queryBuilder.addOrderBy(`doc.${field}`, direction);\r\n        });\r\n      } else {\r\n        queryBuilder.addOrderBy('doc.created_at', 'DESC');\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`根据状态查找文档失败`, {\r\n        status,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 查找可处理的文档\r\n   * @param collectionId 集合ID\r\n   * @param limit 限制数量\r\n   * @returns 文档数组\r\n   */\r\n  async findProcessable(\r\n    collectionId: CollectionId,\r\n    limit?: number,\r\n  ): Promise<Doc[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc')\r\n        .where('doc.collectionId = :collectionId', { collectionId })\r\n        .andWhere('doc.status = :status', { status: 'new' })\r\n        .andWhere('doc.deleted = :deleted', { deleted: false })\r\n        .orderBy('doc.created_at', 'ASC');\r\n\r\n      if (limit) {\r\n        queryBuilder.limit(limit);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`查找可处理文档失败`, {\r\n        collectionId,\r\n        limit,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 查找已删除的文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @returns 文档数组\r\n   */\r\n  async findDeleted(\r\n    collectionId?: CollectionId,\r\n    options: {\r\n      limit?: number;\r\n      orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n    } = {},\r\n  ): Promise<Doc[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc').where(\r\n        'doc.deleted = :deleted',\r\n        { deleted: true },\r\n      );\r\n\r\n      if (collectionId) {\r\n        queryBuilder.andWhere('doc.collectionId = :collectionId', {\r\n          collectionId,\r\n        });\r\n      }\r\n\r\n      if (options.orderBy) {\r\n        Object.entries(options.orderBy).forEach(([field, direction]) => {\r\n          queryBuilder.addOrderBy(`doc.${field}`, direction);\r\n        });\r\n      } else {\r\n        queryBuilder.addOrderBy('doc.updated_at', 'DESC');\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`查找已删除文档失败`, {\r\n        collectionId,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 查找失败的文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @returns 文档数组\r\n   */\r\n  async findFailed(\r\n    collectionId: CollectionId,\r\n    options: {\r\n      limit?: number;\r\n      orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n    } = {},\r\n  ): Promise<Doc[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc')\r\n        .where('doc.collectionId = :collectionId', { collectionId })\r\n        .andWhere('doc.status = :status', { status: 'failed' })\r\n        .andWhere('doc.deleted = :deleted', { deleted: false });\r\n\r\n      if (options.orderBy) {\r\n        Object.entries(options.orderBy).forEach(([field, direction]) => {\r\n          queryBuilder.addOrderBy(`doc.${field}`, direction);\r\n        });\r\n      } else {\r\n        queryBuilder.addOrderBy('doc.updated_at', 'DESC');\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`查找失败文档失败`, {\r\n        collectionId,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 查找已完成的文档\r\n   * @param collectionId 集合ID\r\n   * @param options 查询选项\r\n   * @returns 文档数组\r\n   */\r\n  async findCompleted(\r\n    collectionId: CollectionId,\r\n    options: {\r\n      limit?: number;\r\n      orderBy?: Record<string, 'ASC' | 'DESC'>;\r\n    } = {},\r\n  ): Promise<Doc[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc')\r\n        .where('doc.collectionId = :collectionId', { collectionId })\r\n        .andWhere('doc.status = :status', { status: 'completed' })\r\n        .andWhere('doc.deleted = :deleted', { deleted: false });\r\n\r\n      if (options.orderBy) {\r\n        Object.entries(options.orderBy).forEach(([field, direction]) => {\r\n          queryBuilder.addOrderBy(`doc.${field}`, direction);\r\n        });\r\n      } else {\r\n        queryBuilder.addOrderBy('doc.updated_at', 'DESC');\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`查找已完成文档失败`, {\r\n        collectionId,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据时间范围查找文档\r\n   * @param startTime 开始时间\r\n   * @param endTime 结束时间\r\n   * @param options 查询选项\r\n   * @returns 文档数组\r\n   */\r\n  async findByTimeRange(\r\n    startTime: number,\r\n    endTime: number,\r\n    options: {\r\n      collectionId?: CollectionId;\r\n      status?: 'new' | 'processing' | 'completed' | 'failed';\r\n      limit?: number;\r\n    } = {},\r\n  ): Promise<Doc[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc')\r\n        .where('doc.created_at BETWEEN :startTime AND :endTime', {\r\n          startTime,\r\n          endTime,\r\n        })\r\n        .andWhere('doc.deleted = :deleted', { deleted: false });\r\n\r\n      if (options.collectionId) {\r\n        queryBuilder.andWhere('doc.collectionId = :collectionId', {\r\n          collectionId: options.collectionId,\r\n        });\r\n      }\r\n\r\n      if (options.status) {\r\n        queryBuilder.andWhere('doc.status = :status', {\r\n          status: options.status,\r\n        });\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      queryBuilder.addOrderBy('doc.created_at', 'DESC');\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`根据时间范围查找文档失败`, {\r\n        startTime,\r\n        endTime,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 搜索文档内容\r\n   * @param searchText 搜索文本\r\n   * @param options 搜索选项\r\n   * @returns 匹配的文档数组\r\n   */\r\n  async searchContent(\r\n    searchText: string,\r\n    options: {\r\n      collectionId?: CollectionId;\r\n      limit?: number;\r\n      searchFields?: string[];\r\n    } = {},\r\n  ): Promise<Doc[]> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc').where(\r\n        'doc.deleted = :deleted',\r\n        { deleted: false },\r\n      );\r\n\r\n      if (options.collectionId) {\r\n        queryBuilder.andWhere('doc.collectionId = :collectionId', {\r\n          collectionId: options.collectionId,\r\n        });\r\n      }\r\n\r\n      const searchFields = options.searchFields || ['name', 'key'];\r\n      let firstField = true;\r\n\r\n      for (const field of searchFields) {\r\n        if (firstField) {\r\n          queryBuilder.andWhere(`doc.${field} ILIKE :searchText`, {\r\n            searchText: `%${searchText}%`,\r\n          });\r\n          firstField = false;\r\n        } else {\r\n          queryBuilder.orWhere(`doc.${field} ILIKE :searchText`, {\r\n            searchText: `%${searchText}%`,\r\n          });\r\n        }\r\n      }\r\n\r\n      if (options.limit) {\r\n        queryBuilder.limit(options.limit);\r\n      }\r\n\r\n      queryBuilder.addOrderBy('doc.created_at', 'DESC');\r\n\r\n      const results = await queryBuilder.getMany();\r\n      return results;\r\n    } catch (error) {\r\n      this.logger.error(`搜索文档内容失败`, {\r\n        searchText,\r\n        options,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量更新文档状态\r\n   * @param ids 文档ID数组\r\n   * @param status 新状态\r\n   * @returns 批量操作结果\r\n   */\r\n  async batchUpdateStatus(\r\n    ids: DocId[],\r\n    status: 'new' | 'processing' | 'completed' | 'failed',\r\n  ): Promise<BatchOperationResult> {\r\n    try {\r\n      const result = await this.updateBatch(ids, { status });\r\n      const enrichedResult: BatchOperationResult = {\r\n        ...result,\r\n        updated: result.success,\r\n      };\r\n      this.logger.debug(`批量更新文档状态完成`, {\r\n        requested: ids.length,\r\n        updated: enrichedResult.updated,\r\n        failed: enrichedResult.failed,\r\n        status,\r\n      });\r\n      return enrichedResult;\r\n    } catch (error) {\r\n      this.logger.error(`批量更新文档状态失败`, {\r\n        ids,\r\n        status,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据集合ID统计文档数量\r\n   * @param collectionId 集合ID\r\n   * @param status 可选的状态过滤\r\n   * @returns 文档数量\r\n   */\r\n  async countByCollectionId(\r\n    collectionId: CollectionId,\r\n    status?: 'new' | 'processing' | 'completed' | 'failed',\r\n  ): Promise<number> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc')\r\n        .where('doc.collectionId = :collectionId', { collectionId })\r\n        .andWhere('doc.deleted = :deleted', { deleted: false });\r\n\r\n      if (status) {\r\n        queryBuilder.andWhere('doc.status = :status', { status });\r\n      }\r\n\r\n      return await queryBuilder.getCount();\r\n    } catch (error) {\r\n      this.logger.error(`统计集合文档数量失败`, {\r\n        collectionId,\r\n        status,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据集合ID统计已完成文档数量\r\n   * @param collectionId 集合ID\r\n   * @returns 已完成文档数量\r\n   */\r\n  async countCompletedByCollectionId(\r\n    collectionId: CollectionId,\r\n  ): Promise<number> {\r\n    try {\r\n      return await this.countByCollectionId(collectionId, 'completed');\r\n    } catch (error) {\r\n      this.logger.error(`统计集合已完成文档数量失败`, {\r\n        collectionId,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取文档统计信息\r\n   * @param collectionId 可选的集合ID\r\n   * @returns 统计信息\r\n   */\r\n  async getStatistics(collectionId?: CollectionId): Promise<{\r\n    total: number;\r\n    new: number;\r\n    processing: number;\r\n    completed: number;\r\n    failed: number;\r\n    deleted: number;\r\n    totalSize: number;\r\n  }> {\r\n    try {\r\n      const queryBuilder = this.createQueryBuilder('doc')\r\n        .select('COUNT(*)', 'total')\r\n        .addSelect('SUM(CASE WHEN status = :new THEN 1 ELSE 0 END)', 'new')\r\n        .addSelect(\r\n          'SUM(CASE WHEN status = :processing THEN 1 ELSE 0 END)',\r\n          'processing',\r\n        )\r\n        .addSelect(\r\n          'SUM(CASE WHEN status = :completed THEN 1 ELSE 0 END)',\r\n          'completed',\r\n        )\r\n        .addSelect(\r\n          'SUM(CASE WHEN status = :failed THEN 1 ELSE 0 END)',\r\n          'failed',\r\n        )\r\n        .addSelect(\r\n          'SUM(CASE WHEN deleted = :deleted THEN 1 ELSE 0 END)',\r\n          'deleted',\r\n        )\r\n        .addSelect('SUM(size_bytes)', 'totalSize')\r\n        .setParameters({\r\n          new: 'new',\r\n          processing: 'processing',\r\n          completed: 'completed',\r\n          failed: 'failed',\r\n          deleted: true,\r\n        });\r\n\r\n      if (collectionId) {\r\n        queryBuilder.andWhere('doc.collectionId = :collectionId', {\r\n          collectionId,\r\n        });\r\n      }\r\n\r\n      const result = await queryBuilder.getRawOne();\r\n\r\n      // 处理空结果的情况\r\n      if (!result) {\r\n        return {\r\n          total: 0,\r\n          new: 0,\r\n          processing: 0,\r\n          completed: 0,\r\n          failed: 0,\r\n          deleted: 0,\r\n          totalSize: 0,\r\n        };\r\n      }\r\n\r\n      return {\r\n        total: parseInt(result.total, 10) || 0,\r\n        new: parseInt(result.new, 10) || 0,\r\n        processing: parseInt(result.processing, 10) || 0,\r\n        completed: parseInt(result.completed, 10) || 0,\r\n        failed: parseInt(result.failed, 10) || 0,\r\n        deleted: parseInt(result.deleted, 10) || 0,\r\n        totalSize: parseInt(result.totalSize, 10) || 0,\r\n      };\r\n    } catch (error) {\r\n      this.logger.error(`获取文档统计信息失败`, {\r\n        collectionId,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 使用事务管理器删除文档\r\n   * @param id 文档ID\r\n   * @param manager 事务管理器\r\n   * @returns 删除结果\r\n   */\r\n  async deleteWithManager(\r\n    id: DocId,\r\n    manager: EntityManager, // eslint-disable-line @typescript-eslint/no-explicit-any\r\n  ): Promise<{ affected?: number }> {\r\n    try {\r\n      const result = await manager.delete(Doc, { id });\r\n      return { affected: result.affected || undefined };\r\n    } catch (error) {\r\n      this.logger.error(`使用事务管理器删除文档失败`, {\r\n        id,\r\n        error: (error as Error).message,\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\DocumentAggregateRepository.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":534,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":534,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14383,14386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14383,14386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":537,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":537,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14533,14536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14533,14536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\KeywordRetrieverFactory.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\PostgreSQLKeywordRetriever.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\ScrapeResultsRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\SimpleBaseRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\SyncJobRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\SyncJobsTableAdapter.ts","messages":[{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":101,"column":25,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":102,"endColumn":1,"fix":{"range":[2229,2229],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":112,"column":27,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":113,"endColumn":1,"fix":{"range":[2495,2495],"text":"/**\n   *\n   */\n  "}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { SyncJobRepository } from './SyncJobRepository.js';\r\nimport { SyncJobEntity } from '../entities/SyncJob.js';\r\nimport { SyncJob } from '../../../domain/sync/types.js';\r\nimport { SyncJobStatus } from '../../../domain/sync/types.js';\r\nimport { ErrorCategory } from '../../../domain/sync/retry.js';\r\nimport {\r\n  SyncJobStatusMapper,\r\n  DbSyncJobStatus,\r\n} from '../../../domain/sync/SyncJobStatusMapper.js';\r\n\r\n/**\r\n * SyncJobsTable接口\r\n */\r\n/**\r\n * SyncJobsTable接口\r\n */\r\ninterface ISyncJobsTable {\r\n  /**\r\n   * 数据库实例\r\n   */\r\n  db: Record<string, unknown>;\r\n  /**\r\n   * 根据ID获取同步作业\r\n   * @param id 作业ID\r\n   * @returns 同步作业或null\r\n   */\r\n  getById(id: string): SyncJob | null;\r\n  /**\r\n   * 根据文档ID获取同步作业\r\n   * @param docId 文档ID\r\n   * @returns 同步作业或null\r\n   */\r\n  getByDocId(docId: string): SyncJob | null;\r\n  /**\r\n   * 获取所有同步作业\r\n   * @param limit 限制数量\r\n   * @param offset 偏移量\r\n   * @returns 同步作业数组\r\n   */\r\n  getAll(limit?: number, offset?: number): SyncJob[];\r\n  /**\r\n   * 根据状态获取同步作业\r\n   * @param status 作业状态\r\n   * @param limit 限制数量\r\n   * @returns 同步作业数组\r\n   */\r\n  getByStatus(status: SyncJobStatus, limit?: number): SyncJob[];\r\n  /**\r\n   * 根据状态获取作业数量\r\n   * @param status 作业状态\r\n   * @returns 作业数量\r\n   */\r\n  getCountByStatus(status: SyncJobStatus): number;\r\n  /**\r\n   * 获取作业统计信息\r\n   * @returns 统计信息对象\r\n   */\r\n  getStats(): {\r\n    total: number;\r\n    byStatus: Record<SyncJobStatus, number>;\r\n    avgDuration: number;\r\n    successRate: number;\r\n  };\r\n  /**\r\n   * 清理过期作业\r\n   * @param olderThanDays 过期天数\r\n   * @returns 删除的作业数量\r\n   */\r\n  cleanup(olderThanDays?: number): number;\r\n  /**\r\n   * 检查数据库连接\r\n   * @returns 连接状态\r\n   */\r\n  ping(): boolean;\r\n  /**\r\n   * 将数据库行映射为SyncJob对象\r\n   * @param row 数据库行\r\n   * @returns SyncJob对象\r\n   */\r\n  mapRowToSyncJob(row: Record<string, unknown>): SyncJob;\r\n}\r\n\r\n/**\r\n * SyncJobsTable适配器\r\n * 将SyncJobRepository适配为SyncJobsTable接口\r\n */\r\n/**\r\n * SyncJobsTable适配器\r\n * 将SyncJobRepository适配为SyncJobsTable接口\r\n */\r\nexport class SyncJobsTableAdapter {\r\n  /**\r\n   * 构造函数\r\n   * @param syncJobRepository SyncJobRepository实例\r\n   * @param db 数据库实例\r\n   */\r\n  constructor(\r\n    private readonly syncJobRepository: SyncJobRepository,\r\n    private readonly db: Record<string, unknown> = {}, // 添加db属性以满足接口要求\r\n  ) {}\r\n  private toEntityStatus(status?: SyncJobStatus): DbSyncJobStatus | undefined {\r\n    if (!status) {\r\n      return undefined;\r\n    }\r\n    try {\r\n      return SyncJobStatusMapper.toDbStatus(status);\r\n    } catch {\r\n      return DbSyncJobStatus.PENDING;\r\n    }\r\n  }\r\n\r\n  private fromEntityStatus(status: DbSyncJobStatus): SyncJobStatus {\r\n    return SyncJobStatusMapper.toDomainStatusSafe(status, SyncJobStatus.NEW);\r\n  }\r\n\r\n  /**\r\n   * 创建同步作业\r\n   * @param job - 同步作业数据，不包含ID\r\n   * @returns 返回新创建的同步作业ID\r\n   */\r\n  create(job: Omit<SyncJob, 'id'>): string {\r\n    const id = `sync_${job.docId}_${Date.now()}`;\r\n    // 异步调用，但接口要求同步返回\r\n    this.syncJobRepository\r\n      .create({\r\n        id,\r\n        docId: job.docId,\r\n        status: this.toEntityStatus(job.status) ?? DbSyncJobStatus.PENDING,\r\n        retries: job.retries,\r\n        started_at: undefined, // SyncJob接口没有started_at字段\r\n        completed_at: undefined, // SyncJob接口没有completed_at字段\r\n        created_at: job.createdAt,\r\n        updated_at: job.updatedAt,\r\n        progress: 0,\r\n      })\r\n      .catch((error) => {\r\n        console.error('Failed to create sync job:', error);\r\n      });\r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * 更新同步作业\r\n   * @param id - 同步作业ID\r\n   * @param updates - 要更新的字段数据\r\n   * @returns 返回是否更新成功\r\n   */\r\n  async update(\r\n    id: string,\r\n    updates: Partial<\r\n      SyncJob & {\r\n        started_at?: number;\r\n        completed_at?: number;\r\n        duration_ms?: number;\r\n        error_category?: ErrorCategory;\r\n        last_retry_strategy?: string;\r\n        progress?: number;\r\n      }\r\n    >,\r\n  ): Promise<boolean> {\r\n    try {\r\n      const payload: Partial<SyncJobEntity> = {\r\n        retries: updates.retries,\r\n        last_attempt_at: updates.lastAttemptAt,\r\n        error: updates.error,\r\n        started_at: updates.started_at,\r\n        completed_at: updates.completed_at,\r\n        progress: updates.progress,\r\n      };\r\n      if (updates.status) {\r\n        payload.status = this.toEntityStatus(updates.status);\r\n      }\r\n      const result = await this.syncJobRepository.update(id, payload);\r\n      return Boolean(result?.affected ?? result);\r\n    } catch (error) {\r\n      console.error('Failed to update sync job:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据ID获取同步作业\r\n   * @param id - 同步作业ID\r\n   * @returns 返回同步作业对象，如果不存在则返回null\r\n   */\r\n  async getById(id: string): Promise<SyncJob | null> {\r\n    try {\r\n      const job = await this.syncJobRepository.findById(id);\r\n      if (!job) return null;\r\n\r\n      return {\r\n        id: job.id,\r\n        docId: job.docId,\r\n        status: this.fromEntityStatus(job.status),\r\n        retries: job.retries,\r\n        lastAttemptAt: job.last_attempt_at,\r\n        error: job.error,\r\n        createdAt: job.created_at,\r\n        updatedAt: job.updated_at,\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to get sync job by id:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据文档ID获取同步作业\r\n   * @param docId - 文档ID\r\n   * @returns 返回最新的同步作业对象，如果不存在则返回null\r\n   */\r\n  async getByDocId(docId: string): Promise<SyncJob | null> {\r\n    try {\r\n      const jobs = await this.syncJobRepository.findByDocId(docId);\r\n      if (jobs.length === 0) return null;\r\n\r\n      const latestJob = jobs[0];\r\n      return {\r\n        id: latestJob.id,\r\n        docId: latestJob.docId,\r\n        status: this.fromEntityStatus(latestJob.status),\r\n        retries: latestJob.retries,\r\n        lastAttemptAt: latestJob.last_attempt_at,\r\n        error: latestJob.error,\r\n        createdAt: latestJob.created_at,\r\n        updatedAt: latestJob.updated_at,\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to get sync job by docId:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取所有同步作业\r\n   * @param limit - 返回记录数量限制\r\n   * @param offset - 偏移量\r\n   * @returns 返回同步作业数组\r\n   */\r\n  async getAll(limit?: number, offset?: number): Promise<SyncJob[]> {\r\n    try {\r\n      const jobs = await this.syncJobRepository.findAll();\r\n      const result = jobs.map((job) => ({\r\n        id: job.id,\r\n        docId: job.docId,\r\n        status: this.fromEntityStatus(job.status),\r\n        retries: job.retries,\r\n        lastAttemptAt: job.last_attempt_at,\r\n        error: job.error,\r\n        createdAt: job.created_at,\r\n        updatedAt: job.updated_at,\r\n      }));\r\n\r\n      if (offset !== undefined) {\r\n        return result.slice(offset);\r\n      }\r\n      if (limit !== undefined) {\r\n        return result.slice(0, limit);\r\n      }\r\n      return result;\r\n    } catch (error) {\r\n      console.error('Failed to get all sync jobs:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 根据状态获取同步作业\r\n   * @param status - 同步作业状态\r\n   * @param limit - 返回记录数量限制\r\n   * @returns 返回同步作业数组\r\n   */\r\n  async getByStatus(status: SyncJobStatus, limit?: number): Promise<SyncJob[]> {\r\n    try {\r\n      const dbStatus = this.toEntityStatus(status) ?? DbSyncJobStatus.PENDING;\r\n      const jobs = await this.syncJobRepository.findByStatus(dbStatus);\r\n      const result = jobs.map((job) => ({\r\n        id: job.id,\r\n        docId: job.docId,\r\n        status: this.fromEntityStatus(job.status),\r\n        retries: job.retries,\r\n        lastAttemptAt: job.last_attempt_at,\r\n        error: job.error,\r\n        createdAt: job.created_at,\r\n        updatedAt: job.updated_at,\r\n      }));\r\n\r\n      if (limit !== undefined) {\r\n        return result.slice(0, limit);\r\n      }\r\n      return result;\r\n    } catch (error) {\r\n      console.error('Failed to get sync jobs by status:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取指定状态的作业数量\r\n   * @param status - 同步作业状态\r\n   * @returns 返回作业数量\r\n   */\r\n  async getCountByStatus(status: SyncJobStatus): Promise<number> {\r\n    try {\r\n      const dbStatus = this.toEntityStatus(status) ?? DbSyncJobStatus.PENDING;\r\n      const jobs = await this.syncJobRepository.findByStatus(dbStatus);\r\n      return jobs.length;\r\n    } catch (error) {\r\n      console.error('Failed to get sync job count by status:', error);\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取作业统计信息\r\n   * @returns 返回包含总数、按状态分组、平均持续时间和成功率的统计对象\r\n   */\r\n  async getStats(): Promise<{\r\n    total: number;\r\n    byStatus: Record<SyncJobStatus, number>;\r\n    avgDuration: number;\r\n    successRate: number;\r\n  }> {\r\n    try {\r\n      const allJobs = await this.syncJobRepository.findAll();\r\n\r\n      const byStatus: Record<SyncJobStatus, number> = {\r\n        [SyncJobStatus.NEW]: 0,\r\n        [SyncJobStatus.SPLIT_OK]: 0,\r\n        [SyncJobStatus.EMBED_OK]: 0,\r\n        [SyncJobStatus.SYNCED]: 0,\r\n        [SyncJobStatus.FAILED]: 0,\r\n        [SyncJobStatus.RETRYING]: 0,\r\n        [SyncJobStatus.DEAD]: 0,\r\n      };\r\n\r\n      let totalDuration = 0;\r\n      let completedJobs = 0;\r\n      let successfulJobs = 0;\r\n\r\n      allJobs.forEach((job) => {\r\n        const status = this.fromEntityStatus(job.status);\r\n        byStatus[status] = (byStatus[status] || 0) + 1;\r\n\r\n        if (job.started_at && job.completed_at) {\r\n          const duration = job.completed_at - job.started_at;\r\n          totalDuration += duration;\r\n          completedJobs++;\r\n        }\r\n\r\n        if (status === SyncJobStatus.SYNCED) {\r\n          successfulJobs++;\r\n        }\r\n      });\r\n\r\n      const avgDuration = completedJobs > 0 ? totalDuration / completedJobs : 0;\r\n      const successRate =\r\n        allJobs.length > 0 ? successfulJobs / allJobs.length : 0;\r\n\r\n      return {\r\n        total: allJobs.length,\r\n        byStatus,\r\n        avgDuration,\r\n        successRate,\r\n      };\r\n    } catch (error) {\r\n      console.error('Failed to get sync job stats:', error);\r\n      return {\r\n        total: 0,\r\n        byStatus: {\r\n          [SyncJobStatus.NEW]: 0,\r\n          [SyncJobStatus.SPLIT_OK]: 0,\r\n          [SyncJobStatus.EMBED_OK]: 0,\r\n          [SyncJobStatus.SYNCED]: 0,\r\n          [SyncJobStatus.FAILED]: 0,\r\n          [SyncJobStatus.RETRYING]: 0,\r\n          [SyncJobStatus.DEAD]: 0,\r\n        },\r\n        avgDuration: 0,\r\n        successRate: 0,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 清理过期的同步作业\r\n   * @param olderThanDays - 过期天数，默认为7天\r\n   * @returns 返回删除的记录数量\r\n   */\r\n  async cleanup(olderThanDays: number = 7): Promise<number> {\r\n    // SyncJobRepository没有cleanup方法，这里返回0\r\n    // 实际实现需要在SyncJobRepository中添加cleanup方法\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * 检查数据库连接是否存活\r\n   * @returns 返回数据库连接状态，true表示连接正常，false表示连接异常\r\n   */\r\n  ping(): boolean {\r\n    // SyncJobRepository没有ping方法，这里返回true\r\n    // 实际实现需要在SyncJobRepository中添加ping方法\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * 将数据库行映射为SyncJob对象\r\n   * @param row 数据库行数据\r\n   * @returns SyncJob对象\r\n   */\r\n  /**\r\n   * 将数据库行映射为SyncJob对象\r\n   * @param row 数据库行数据\r\n   * @returns SyncJob对象\r\n   */\r\n  mapRowToSyncJob(row: Record<string, unknown>): SyncJob {\r\n    return {\r\n      id: String(row.id),\r\n      docId: String(row.docId),\r\n      status: this.fromEntityStatus(row.status as DbSyncJobStatus),\r\n      retries: Number(row.retries),\r\n      lastAttemptAt: row.last_attempt_at\r\n        ? Number(row.last_attempt_at)\r\n        : undefined,\r\n      error: row.error ? String(row.error) : undefined,\r\n      createdAt: Number(row.created_at),\r\n      updatedAt: Number(row.updated_at),\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\SystemHealthRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\SystemMetricsRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\TypeORMRepository.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7611,7614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7611,7614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\repositories\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\database\\test-compatibility.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\di\\services.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\errors\\ErrorMapper.ts","messages":[{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":84,"column":32,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":85,"endColumn":1,"fix":{"range":[2153,2153],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":362,"column":14,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":363,"endColumn":1,"fix":{"range":[8672,8672],"text":"/**\n   *\n   */\n  "}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { AppError, ErrorCode } from '@api/contracts/error.js';\nimport { TransactionError, TransactionErrorType } from '@infrastructure/transactions/TransactionErrorHandler.js';\nimport { ErrorCategory } from '@domain/sync/retry.js';\nimport { ErrorFactory, ErrorContext } from '@domain/errors/ErrorFactory.js';\n\n/**\n * 错误映射策略接口\n */\nexport interface ErrorMappingStrategy {\n  /** 策略名称 */\n  name: string;\n  /** 优先级（数字越小优先级越高） */\n  priority: number;\n  /** 是否可以处理指定的错误 */\n  canHandle(error: Error): boolean;\n  /** 将错误映射为AppError */\n  map(error: Error, context?: ErrorContext): AppError;\n}\n\n/**\n * 数据库错误映射策略\n */\nexport class DatabaseErrorMappingStrategy implements ErrorMappingStrategy {\n  name = 'DatabaseErrorMapping';\n  priority = 1;\n\n  canHandle(error: Error): boolean {\n    const message = error.message.toLowerCase();\n    const dbKeywords = [\n      'database',\n      'sqlite',\n      'sql',\n      'db',\n      'constraint',\n      'unique',\n      'foreign key',\n      'timeout',\n      'locked',\n      'busy',\n    ];\n    return dbKeywords.some(keyword => message.includes(keyword));\n  }\n\n  map(error: Error, context?: ErrorContext): AppError {\n    const message = error.message.toLowerCase();\n\n    // 约束违反\n    if (message.includes('constraint') || message.includes('unique') || message.includes('foreign key')) {\n      return ErrorFactory.createValidationError(\n        'Database constraint violation.',\n        { \n          originalError: error.message,\n          constraintType: this.extractConstraintType(message)\n        },\n        context,\n      );\n    }\n\n    // 连接错误\n    if (message.includes('connection') || message.includes('connect')) {\n      return ErrorFactory.createServiceUnavailableError(\n        'Database',\n        context,\n      );\n    }\n\n    // 超时错误\n    if (message.includes('timeout') || message.includes('locked') || message.includes('busy')) {\n      return ErrorFactory.createServiceUnavailableError(\n        'Database',\n        context,\n      );\n    }\n\n    // 默认数据库错误\n    return ErrorFactory.createInternalServerError(\n      'Database operation failed.',\n      { originalError: error.message },\n      context,\n      error,\n    );\n  }\n\n  private extractConstraintType(message: string): string {\n    if (message.includes('unique')) return 'UNIQUE';\n    if (message.includes('foreign key')) return 'FOREIGN_KEY';\n    if (message.includes('not null')) return 'NOT_NULL';\n    if (message.includes('check')) return 'CHECK';\n    return 'UNKNOWN';\n  }\n}\n\n/**\n * 网络错误映射策略\n */\nexport class NetworkErrorMappingStrategy implements ErrorMappingStrategy {\n  name = 'NetworkErrorMapping';\n  priority = 2;\n\n  canHandle(error: Error): boolean {\n    const message = error.message.toLowerCase();\n    const name = error.constructor.name.toLowerCase();\n    const networkKeywords = [\n      'network',\n      'connection',\n      'connect',\n      'timeout',\n      'etimedout',\n      'enotfound',\n      'econnrefused',\n      'econnreset',\n      'socket',\n      'dns',\n    ];\n    return networkKeywords.some(keyword => \n      message.includes(keyword) || name.includes(keyword)\n    );\n  }\n\n  map(error: Error, context?: ErrorContext): AppError {\n    const message = error.message.toLowerCase();\n\n    // DNS错误\n    if (message.includes('enotfound') || message.includes('dns')) {\n      return ErrorFactory.createServiceUnavailableError(\n        'DNS Resolution',\n        context,\n      );\n    }\n\n    // 连接被拒绝\n    if (message.includes('econnrefused') || message.includes('connection refused')) {\n      return ErrorFactory.createServiceUnavailableError(\n        'Remote Service',\n        context,\n      );\n    }\n\n    // 超时错误\n    if (message.includes('timeout') || message.includes('etimedout')) {\n      return ErrorFactory.createServiceUnavailableError(\n        'Network Service',\n        context,\n      );\n    }\n\n    // 连接重置\n    if (message.includes('econnreset') || message.includes('connection reset')) {\n      return ErrorFactory.createServiceUnavailableError(\n        'Network Connection',\n        context,\n      );\n    }\n\n    // 默认网络错误\n    return ErrorFactory.createServiceUnavailableError(\n      'Network Service',\n      context,\n    );\n  }\n}\n\n/**\n * 文件处理错误映射策略\n */\nexport class FileProcessingErrorMappingStrategy implements ErrorMappingStrategy {\n  name = 'FileProcessingErrorMapping';\n  priority = 3;\n\n  canHandle(error: Error): boolean {\n    const message = error.message.toLowerCase();\n    const fileKeywords = [\n      'file',\n      'upload',\n      'size',\n      'format',\n      'type',\n      'extension',\n      'mime',\n      'corrupted',\n      'invalid',\n    ];\n    return fileKeywords.some(keyword => message.includes(keyword));\n  }\n\n  map(error: Error, context?: ErrorContext): AppError {\n    const message = error.message.toLowerCase();\n\n    // 文件过大\n    if (message.includes('too large') || message.includes('size') || message.includes('limit')) {\n      return ErrorFactory.createFileTooLargeError(\n        context?.resourceId,\n        undefined,\n        undefined,\n        context,\n      );\n    }\n\n    // 不支持的文件类型\n    if (message.includes('type') || message.includes('format') || message.includes('extension')) {\n      return ErrorFactory.createUnsupportedFileTypeError(\n        context?.resourceId,\n        undefined,\n        undefined,\n        context,\n      );\n    }\n\n    // 文件损坏\n    if (message.includes('corrupted') || message.includes('invalid')) {\n      return ErrorFactory.createFileUploadFailedError(\n        'File is corrupted or invalid',\n        context?.resourceId,\n        context,\n      );\n    }\n\n    // 默认文件处理错误\n    return ErrorFactory.createFileUploadFailedError(\n      error.message,\n      context?.resourceId,\n      context,\n    );\n  }\n}\n\n/**\n * 验证错误映射策略\n */\nexport class ValidationErrorMappingStrategy implements ErrorMappingStrategy {\n  name = 'ValidationErrorMapping';\n  priority = 4;\n\n  canHandle(error: Error): boolean {\n    const message = error.message.toLowerCase();\n    const name = error.constructor.name.toLowerCase();\n    const validationKeywords = [\n      'validation',\n      'invalid',\n      'required',\n      'missing',\n      'format',\n      'schema',\n      'zod',\n      'joi',\n      'yup',\n    ];\n    return validationKeywords.some(keyword => \n      message.includes(keyword) || name.includes(keyword)\n    );\n  }\n\n  map(error: Error, context?: ErrorContext): AppError {\n    return ErrorFactory.createValidationError(\n      error.message,\n      { originalError: error.message },\n      context,\n    );\n  }\n}\n\n/**\n * 权限错误映射策略\n */\nexport class PermissionErrorMappingStrategy implements ErrorMappingStrategy {\n  name = 'PermissionErrorMapping';\n  priority = 5;\n\n  canHandle(error: Error): boolean {\n    const message = error.message.toLowerCase();\n    const permissionKeywords = [\n      'unauthorized',\n      'forbidden',\n      'permission',\n      'access denied',\n      'not allowed',\n      'authentication',\n      'auth',\n    ];\n    return permissionKeywords.some(keyword => message.includes(keyword));\n  }\n\n  map(error: Error, context?: ErrorContext): AppError {\n    const message = error.message.toLowerCase();\n\n    // 未授权\n    if (message.includes('unauthorized') || message.includes('authentication')) {\n      return ErrorFactory.createUnauthorizedError(\n        error.message,\n        context,\n      );\n    }\n\n    // 禁止访问\n    if (message.includes('forbidden') || message.includes('permission') || message.includes('access denied')) {\n      return ErrorFactory.createForbiddenError(\n        error.message,\n        context,\n      );\n    }\n\n    // 默认权限错误\n    return ErrorFactory.createUnauthorizedError(\n      error.message,\n      context,\n    );\n  }\n}\n\n/**\n * 资源未找到错误映射策略\n */\nexport class NotFoundErrorMappingStrategy implements ErrorMappingStrategy {\n  name = 'NotFoundErrorMapping';\n  priority = 6;\n\n  canHandle(error: Error): boolean {\n    const message = error.message.toLowerCase();\n    const notFoundKeywords = [\n      'not found',\n      'does not exist',\n      'missing',\n      'no such',\n      'undefined',\n      'null',\n    ];\n    return notFoundKeywords.some(keyword => message.includes(keyword));\n  }\n\n  map(error: Error, context?: ErrorContext): AppError {\n    return ErrorFactory.createNotFoundError(\n      'Resource',\n      context?.resourceId,\n      context,\n    );\n  }\n}\n\n/**\n * 默认错误映射策略\n */\nexport class DefaultErrorMappingStrategy implements ErrorMappingStrategy {\n  name = 'DefaultErrorMapping';\n  priority = 999;\n\n  canHandle(error: Error): boolean {\n    return true; // 默认策略总是可以处理\n  }\n\n  map(error: Error, context?: ErrorContext): AppError {\n    return ErrorFactory.fromError(error, context);\n  }\n}\n\n/**\n * 错误映射器类\n * 提供错误映射策略的管理和执行\n */\nexport class ErrorMapper {\n  private strategies: ErrorMappingStrategy[] = [];\n\n  constructor() {\n    // 注册默认映射策略（按优先级排序）\n    this.registerStrategy(new DatabaseErrorMappingStrategy());\n    this.registerStrategy(new NetworkErrorMappingStrategy());\n    this.registerStrategy(new FileProcessingErrorMappingStrategy());\n    this.registerStrategy(new ValidationErrorMappingStrategy());\n    this.registerStrategy(new PermissionErrorMappingStrategy());\n    this.registerStrategy(new NotFoundErrorMappingStrategy());\n    this.registerStrategy(new DefaultErrorMappingStrategy());\n  }\n\n  /**\n   * 注册错误映射策略\n   * @param strategy 映射策略\n   */\n  registerStrategy(strategy: ErrorMappingStrategy): void {\n    this.strategies.push(strategy);\n    // 按优先级排序\n    this.strategies.sort((a, b) => a.priority - b.priority);\n  }\n\n  /**\n   * 移除错误映射策略\n   * @param strategyName 策略名称\n   */\n  removeStrategy(strategyName: string): void {\n    this.strategies = this.strategies.filter(s => s.name !== strategyName);\n  }\n\n  /**\n   * 获取所有已注册的策略\n   * @returns 策略列表\n   */\n  getStrategies(): ErrorMappingStrategy[] {\n    return [...this.strategies];\n  }\n\n  /**\n   * 将错误映射为AppError\n   * @param error 原始错误\n   * @param context 错误上下文\n   * @returns 映射后的AppError\n   */\n  map(error: Error, context?: ErrorContext): AppError {\n    // 如果已经是AppError，直接返回\n    if (error instanceof AppError) {\n      return error;\n    }\n\n    // 如果是TransactionError，使用专门的转换方法\n    if (error instanceof TransactionError) {\n      return ErrorFactory.fromTransactionError(error, context);\n    }\n\n    // 遍历策略，找到第一个可以处理的策略\n    for (const strategy of this.strategies) {\n      if (strategy.canHandle(error)) {\n        try {\n          return strategy.map(error, context);\n        } catch (mappingError) {\n          // 如果映射失败，记录错误并继续尝试下一个策略\n          console.error(`Error mapping strategy '${strategy.name}' failed:`, mappingError);\n          continue;\n        }\n      }\n    }\n\n    // 如果所有策略都失败，使用默认策略\n    return new DefaultErrorMappingStrategy().map(error, context);\n  }\n\n  /**\n   * 批量映射错误\n   * @param errors 错误数组\n   * @param context 错误上下文\n   * @returns 映射后的AppError数组\n   */\n  mapBatch(errors: Error[], context?: ErrorContext): AppError[] {\n    return errors.map(error => this.map(error, context));\n  }\n\n  /**\n   * 创建带有上下文的错误映射器\n   * @param baseContext 基础上下文\n   * @returns 带有上下文的错误映射器\n   */\n  withContext(baseContext: ErrorContext): {\n    map: (error: Error, additionalContext?: ErrorContext) => AppError;\n    mapBatch: (errors: Error[], additionalContext?: ErrorContext) => AppError[];\n  } {\n    return {\n      map: (error: Error, additionalContext?: ErrorContext) => {\n        const mergedContext = { ...baseContext, ...additionalContext };\n        return this.map(error, mergedContext);\n      },\n      mapBatch: (errors: Error[], additionalContext?: ErrorContext) => {\n        const mergedContext = { ...baseContext, ...additionalContext };\n        return this.mapBatch(errors, mergedContext);\n      },\n    };\n  }\n\n  /**\n   * 根据错误分类映射错误\n   * @param category 错误分类\n   * @param error 原始错误\n   * @param context 错误上下文\n   * @returns 映射后的AppError\n   */\n  mapByCategory(category: ErrorCategory, error: Error, context?: ErrorContext): AppError {\n    return ErrorFactory.fromErrorCategory(category, error.message, context, error);\n  }\n}\n\n/**\n * 创建默认错误映射器实例\n * @returns 错误映射器实例\n */\nexport function createErrorMapper(): ErrorMapper {\n  return new ErrorMapper();\n}\n\n/**\n * 全局错误映射器实例\n */\nexport const globalErrorMapper = createErrorMapper();","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\BaseFileProcessor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\ContentExtractor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\DefaultStreamFileLoader.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\FileFormatDetector.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\FileProcessorRegistry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\LocalFileLoader.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\MarkdownSplitter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\MarkdownSplitterAdapter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\OpenAIEmbeddingProvider.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\WebCrawler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\processors\\MarkdownFileProcessor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\external\\processors\\TextFileProcessor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\lifecycle\\shutdown.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\logging\\enhanced-logger.ts","messages":[{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":124,"column":14,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":125,"endColumn":1,"fix":{"range":[2527,2527],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":170,"column":14,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":171,"endColumn":1,"fix":{"range":[3926,3926],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":310,"column":14,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":311,"endColumn":1,"fix":{"range":[7691,7691],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":318,"column":8,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":319,"endColumn":1,"fix":{"range":[7877,7877],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":322,"column":7,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":323,"endColumn":1,"fix":{"range":[8006,8006],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":326,"column":7,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":327,"endColumn":1,"fix":{"range":[8133,8133],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":330,"column":8,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":331,"endColumn":1,"fix":{"range":[8260,8260],"text":"/**\n   *\n   */\n  "}}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":7,"fixableWarningCount":0,"source":"/**\r\n * 增强的日志模块，基于 Winston 实现结构化、分级别的日志输出\r\n * 支持 TAG、traceID、模块化日志等功能\r\n */\r\n\r\nimport winston from 'winston';\r\nimport DailyRotateFile from 'winston-daily-rotate-file';\r\nimport fs from 'node:fs';\r\nimport path from 'node:path';\r\nimport { randomUUID } from 'node:crypto';\r\nimport { AppConfig } from '@config/config.js';\r\nimport type { Logger } from './logger.js';\r\n\r\n/**\r\n * 日志级别枚举\r\n */\r\nexport enum LogLevel {\r\n  DEBUG = 'debug',\r\n  INFO = 'info',\r\n  WARN = 'warn',\r\n  ERROR = 'error',\r\n}\r\n\r\n/**\r\n * 日志模块TAG枚举\r\n */\r\nexport enum LogTag {\r\n  // 核心模块\r\n  API = 'API',\r\n  DATABASE = 'DATABASE',\r\n  QDRANT = 'QDRANT',\r\n  EMBEDDING = 'EMBEDDING',\r\n\r\n  // 业务模块\r\n  COLLECTION = 'COLLECTION',\r\n  DOCUMENT = 'DOCUMENT',\r\n  SEARCH = 'SEARCH',\r\n  IMPORT = 'IMPORT',\r\n  BATCH = 'BATCH',\r\n  SCRAPE = 'SCRAPE',\r\n\r\n  // 系统模块\r\n  SYSTEM = 'SYSTEM',\r\n  MONITORING = 'MONITORING',\r\n  GC = 'GC',\r\n  SCHEDULER = 'SCHEDULER',\r\n\r\n  // 通用模块\r\n  AUTH = 'AUTH',\r\n  MIDDLEWARE = 'MIDDLEWARE',\r\n  ERROR = 'ERROR',\r\n  UTILS = 'UTILS',\r\n}\r\n\r\n/**\r\n * 日志上下文接口\r\n */\r\nexport interface LogContext {\r\n  traceId?: string;\r\n  userId?: string;\r\n  requestId?: string;\r\n  [key: string]: unknown;\r\n}\r\n\r\n/**\r\n * 增强的日志器接口，支持不同级别的日志输出和上下文信息\r\n */\r\nexport interface EnhancedLogger {\r\n  /**\r\n   * 输出调试级别日志\r\n   * @param message - 日志消息\r\n   * @param tag - 日志模块TAG（可选，如果使用withTag则不需要）\r\n   * @param context - 日志上下文信息\r\n   */\r\n  debug(message: string, tag?: LogTag, context?: LogContext): void;\r\n\r\n  /**\r\n   * 输出信息级别日志\r\n   * @param message - 日志消息\r\n   * @param tag - 日志模块TAG（可选，如果使用withTag则不需要）\r\n   * @param context - 日志上下文信息\r\n   */\r\n  info(message: string, tag?: LogTag, context?: LogContext): void;\r\n\r\n  /**\r\n   * 输出警告级别日志\r\n   * @param message - 日志消息\r\n   * @param tag - 日志模块TAG（可选，如果使用withTag则不需要）\r\n   * @param context - 日志上下文信息\r\n   */\r\n  warn(message: string, tag?: LogTag, context?: LogContext): void;\r\n\r\n  /**\r\n   * 输出错误级别日志\r\n   * @param message - 日志消息\r\n   * @param tag - 日志模块TAG（可选，如果使用withTag则不需要）\r\n   * @param context - 日志上下文信息\r\n   */\r\n  error(message: string, tag?: LogTag, context?: LogContext): void;\r\n\r\n  /**\r\n   * 创建带有特定上下文的子日志器\r\n   * @param context - 上下文信息\r\n   * @returns 带有上下文的日志器\r\n   */\r\n  withContext(context: LogContext): EnhancedLogger;\r\n\r\n  /**\r\n   * 创建带有特定TAG的子日志器\r\n   * @param tag - 日志模块TAG\r\n   * @returns 带有TAG的日志器\r\n   */\r\n  withTag(tag: LogTag): EnhancedLogger;\r\n}\r\n\r\n/**\r\n * 增强的日志器实现类\r\n */\r\nexport class WinstonEnhancedLogger implements EnhancedLogger {\r\n  private logger: winston.Logger;\r\n  private defaultContext: LogContext;\r\n  private presetTag?: LogTag;\r\n\r\n  constructor(\r\n    logger: winston.Logger,\r\n    defaultContext: LogContext = {},\r\n    presetTag?: LogTag,\r\n  ) {\r\n    this.logger = logger;\r\n    this.defaultContext = defaultContext;\r\n    this.presetTag = presetTag;\r\n  }\r\n\r\n  debug(message: string, tag?: LogTag, context?: LogContext): void {\r\n    const actualTag = tag || this.presetTag || LogTag.SYSTEM;\r\n    this.log(LogLevel.DEBUG, actualTag, message, context);\r\n  }\r\n\r\n  info(message: string, tag?: LogTag, context?: LogContext): void {\r\n    const actualTag = tag || this.presetTag || LogTag.SYSTEM;\r\n    this.log(LogLevel.INFO, actualTag, message, context);\r\n  }\r\n\r\n  warn(message: string, tag?: LogTag, context?: LogContext): void {\r\n    const actualTag = tag || this.presetTag || LogTag.SYSTEM;\r\n    this.log(LogLevel.WARN, actualTag, message, context);\r\n  }\r\n\r\n  error(message: string, tag?: LogTag, context?: LogContext): void {\r\n    const actualTag = tag || this.presetTag || LogTag.SYSTEM;\r\n    this.log(LogLevel.ERROR, actualTag, message, context);\r\n  }\r\n\r\n  withContext(context: LogContext): EnhancedLogger {\r\n    return new WinstonEnhancedLogger(\r\n      this.logger,\r\n      { ...this.defaultContext, ...context },\r\n      this.presetTag,\r\n    );\r\n  }\r\n\r\n  withTag(tag: LogTag): EnhancedLogger {\r\n    return new WinstonEnhancedLogger(\r\n      this.logger,\r\n      { ...this.defaultContext, tag },\r\n      tag, // 存储预设的TAG\r\n    );\r\n  }\r\n\r\n  private log(\r\n    level: LogLevel,\r\n    tag: LogTag,\r\n    message: string,\r\n    context?: LogContext,\r\n  ): void {\r\n    const logData = {\r\n      level,\r\n      tag,\r\n      message,\r\n      timestamp: new Date().toISOString(),\r\n      ...this.defaultContext,\r\n      ...context,\r\n    };\r\n\r\n    this.logger.log(level, message, logData);\r\n  }\r\n}\r\n\r\n/**\r\n * TraceID 生成器\r\n */\r\nexport class TraceIdGenerator {\r\n  /**\r\n   * 生成新的traceID\r\n   * @returns 新的traceID字符串\r\n   */\r\n  static generate(): string {\r\n    return randomUUID();\r\n  }\r\n\r\n  /**\r\n   * 从请求头中提取traceID，如果不存在则生成新的\r\n   * @param headers - 请求头对象\r\n   * @returns traceID字符串\r\n   */\r\n  static extractOrGenerate(headers: Record<string, string>): string {\r\n    const traceId = headers['x-trace-id'] || headers['trace-id'];\r\n    return traceId || this.generate();\r\n  }\r\n}\r\n\r\n/**\r\n * 创建一个增强的 Winston Logger 实例\r\n * @param config - 应用程序配置，用于获取日志级别\r\n * @returns 配置好的增强日志器实例\r\n */\r\nexport function createEnhancedLogger(config: AppConfig): EnhancedLogger {\r\n  const { combine, timestamp, json, colorize, simple, printf } = winston.format;\r\n\r\n  // 确保日志目录存在\r\n  const logsDir = path.resolve(process.cwd(), 'logs');\r\n  try {\r\n    fs.mkdirSync(logsDir, { recursive: true });\r\n  } catch {\r\n    // 目录创建失败不应阻断应用启动，继续使用控制台输出\r\n  }\r\n\r\n  // 自定义日志格式\r\n  const customFormat = printf(\r\n    ({ level, message, tag, traceId, timestamp, ...meta }) => {\r\n      const logObj = {\r\n        timestamp,\r\n        level: level.toUpperCase(),\r\n        tag: tag || 'UNKNOWN',\r\n        traceId: traceId || 'N/A',\r\n        message,\r\n        ...meta,\r\n      };\r\n      return JSON.stringify(logObj);\r\n    },\r\n  );\r\n\r\n  const logger = winston.createLogger({\r\n    level: config.log.level, // 从配置中获取日志级别\r\n    format: combine(timestamp(), customFormat), // 使用自定义格式进行结构化日志输出\r\n    transports: [\r\n      // 配置控制台传输器\r\n      new winston.transports.Console({\r\n        format: combine(\r\n          colorize(),\r\n          printf(({ level, message, tag, traceId, timestamp, ...meta }) => {\r\n            const traceIdStr = traceId ? `[${traceId}]` : '';\r\n            return `${timestamp} ${level} [${tag || 'UNKNOWN'}]${traceIdStr} ${message} ${\r\n              Object.keys(meta).length > 0 ? JSON.stringify(meta) : ''\r\n            }`;\r\n          }),\r\n        ),\r\n      }),\r\n      // 配置按日期滚动的文件传输器\r\n      new DailyRotateFile({\r\n        dirname: logsDir,\r\n        filename: 'app-%DATE%.log',\r\n        datePattern: config.log?.datePattern || 'YYYY-MM-DD',\r\n        zippedArchive: config.log?.zippedArchive ?? true,\r\n        maxSize: config.log?.maxSize || '20m',\r\n        // 支持天数(如 '14d')或数量(如 '30')。\r\n        maxFiles: config.log?.maxFiles || '14d',\r\n        level: config.log.level,\r\n      }),\r\n      // 错误日志单独文件\r\n      new DailyRotateFile({\r\n        dirname: logsDir,\r\n        filename: 'error-%DATE%.log',\r\n        datePattern: config.log?.datePattern || 'YYYY-MM-DD',\r\n        zippedArchive: config.log?.zippedArchive ?? true,\r\n        maxSize: config.log?.maxSize || '20m',\r\n        maxFiles: config.log?.maxFiles || '14d',\r\n        level: 'error',\r\n      }),\r\n    ],\r\n  });\r\n\r\n  // TODO: 未来可集成 Sentry 进行错误上报\r\n\r\n  return new WinstonEnhancedLogger(logger);\r\n}\r\n\r\n/**\r\n * 默认的增强日志器实例，方便在未明确配置时使用\r\n * 其配置是最小化的，仅为满足 AppConfig 接口要求\r\n */\r\nexport const enhancedLogger: EnhancedLogger = createEnhancedLogger({\r\n  log: { level: 'info' },\r\n  // 为满足 AppConfig 接口，提供模拟值。在实际应用中，应使用完整配置创建 Logger\r\n  openai: { baseUrl: '', apiKey: '', model: '' },\r\n  db: { type: 'sqlite', path: '' },\r\n  qdrant: { url: '', collection: '', vectorSize: 0 },\r\n  embedding: { batchSize: 0 },\r\n  api: { port: 0 },\r\n  gc: { intervalHours: 0 },\r\n});\r\n\r\n/**\r\n * 兼容性适配器，将增强的日志器适配为原始日志器接口\r\n */\r\nexport class LoggerAdapter implements Logger {\r\n  private enhancedLogger: EnhancedLogger;\r\n  private defaultTag: LogTag;\r\n\r\n  constructor(\r\n    enhancedLogger: EnhancedLogger,\r\n    defaultTag: LogTag = LogTag.SYSTEM,\r\n  ) {\r\n    this.enhancedLogger = enhancedLogger;\r\n    this.defaultTag = defaultTag;\r\n  }\r\n\r\n  debug(message: string, ...args: unknown[]): void {\r\n    this.enhancedLogger.debug(message, this.defaultTag, { args });\r\n  }\r\n\r\n  info(message: string, ...args: unknown[]): void {\r\n    this.enhancedLogger.info(message, this.defaultTag, { args });\r\n  }\r\n\r\n  warn(message: string, ...args: unknown[]): void {\r\n    this.enhancedLogger.warn(message, this.defaultTag, { args });\r\n  }\r\n\r\n  error(message: string, ...args: unknown[]): void {\r\n    this.enhancedLogger.error(message, this.defaultTag, { args });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\logging\\logger-test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\logging\\logger.ts","messages":[{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":116,"column":1,"nodeType":"ExportNamedDeclaration","messageId":"missingJsDoc","endLine":117,"endColumn":1,"fix":{"range":[2950,2950],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":118,"column":1,"nodeType":"ExportNamedDeclaration","messageId":"missingJsDoc","endLine":119,"endColumn":1,"fix":{"range":[3025,3025],"text":"/**\n *\n */\n"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"/**\r\n * 日志模块，基于 Winston 实现结构化、分级别的日志输出\r\n * 兼容性模块，推荐使用增强的日志系统\r\n */\r\n\r\nimport winston from 'winston';\r\nimport DailyRotateFile from 'winston-daily-rotate-file';\r\nimport fs from 'node:fs';\r\nimport path from 'node:path';\r\nimport { AppConfig } from '@config/config.js';\r\nimport {\r\n  createEnhancedLogger,\r\n  LoggerAdapter,\r\n  LogTag,\r\n} from './enhanced-logger.js';\r\n\r\n/**\r\n * 定义日志器接口，支持不同级别的日志输出\r\n */\r\nexport interface Logger {\r\n  /**\r\n   * 输出调试级别日志\r\n   * @param message - 日志消息\r\n   * @param args - 额外参数\r\n   */\r\n  debug(message: string, ...args: unknown[]): void;\r\n  /**\r\n   * 输出信息级别日志\r\n   * @param message - 日志消息\r\n   * @param args - 额外参数\r\n   */\r\n  info(message: string, ...args: unknown[]): void;\r\n  /**\r\n   * 输出警告级别日志\r\n   * @param message - 日志消息\r\n   * @param args - 额外参数\r\n   */\r\n  warn(message: string, ...args: unknown[]): void;\r\n  /**\r\n   * 输出错误级别日志\r\n   * @param message - 日志消息\r\n   * @param args - 额外参数\r\n   */\r\n  error(message: string, ...args: unknown[]): void;\r\n}\r\n\r\n/**\r\n * 创建一个 Winston Logger 实例\r\n * @param config - 应用程序配置，用于获取日志级别\r\n * @returns 配置好的日志器实例\r\n */\r\nexport function createLogger(config: AppConfig): Logger {\r\n  const { combine, timestamp, json, colorize, simple } = winston.format;\r\n\r\n  // 确保日志目录存在\r\n  const logsDir = path.resolve(process.cwd(), 'logs');\r\n  try {\r\n    fs.mkdirSync(logsDir, { recursive: true });\r\n  } catch {\r\n    // 目录创建失败不应阻断应用启动，继续使用控制台输出\r\n  }\r\n\r\n  const logger = winston.createLogger({\r\n    level: config.log.level, // 从配置中获取日志级别\r\n    format: combine(timestamp(), json()), // 结合时间戳和 JSON 格式进行结构化日志输出\r\n    transports: [\r\n      // 配置控制台传输器\r\n      new winston.transports.Console({\r\n        format: combine(colorize(), simple()), // 控制台输出带颜色和简洁格式\r\n      }),\r\n      // 配置按日期滚动的文件传输器\r\n      new DailyRotateFile({\r\n        dirname: logsDir,\r\n        filename: 'app-%DATE%.log',\r\n        datePattern: config.log?.datePattern || 'YYYY-MM-DD',\r\n        zippedArchive: config.log?.zippedArchive ?? true,\r\n        maxSize: config.log?.maxSize || '20m',\r\n        // 支持天数(如 '14d')或数量(如 '30')。\r\n        maxFiles: config.log?.maxFiles || '14d',\r\n        level: config.log.level,\r\n      }),\r\n    ],\r\n  });\r\n\r\n  // TODO: 未来可集成 Sentry 进行错误上报\r\n\r\n  return logger;\r\n}\r\n\r\n/**\r\n * 创建增强的日志器实例（推荐使用）\r\n * @param config - 应用程序配置，用于获取日志级别\r\n * @returns 配置好的增强日志器实例\r\n */\r\nexport function createEnhancedLoggerFromConfig(config: AppConfig): Logger {\r\n  const enhancedLogger = createEnhancedLogger(config);\r\n  return new LoggerAdapter(enhancedLogger, LogTag.SYSTEM);\r\n}\r\n\r\n/**\r\n * 默认的日志器实例，方便在未明确配置时使用\r\n * 其配置是最小化的，仅为满足 AppConfig 接口要求\r\n */\r\nexport const logger: Logger = createLogger({\r\n  log: { level: 'info' },\r\n  // 为满足 AppConfig 接口，提供模拟值。在实际应用中，应使用完整配置创建 Logger\r\n  openai: { baseUrl: '', apiKey: '', model: '' },\r\n  db: { type: 'sqlite', path: '' },\r\n  qdrant: { url: '', collection: '', vectorSize: 0 },\r\n  embedding: { batchSize: 0 },\r\n  api: { port: 0 },\r\n  gc: { intervalHours: 0 }, // 新增 gc 属性以符合 AppConfig 接口\r\n});\r\n\r\n// 重新导出增强日志系统的相关类型和函数\r\nexport type { EnhancedLogger, LogContext } from './enhanced-logger.js';\r\n\r\nexport {\r\n  LogTag,\r\n  LogLevel,\r\n  TraceIdGenerator,\r\n  createEnhancedLogger,\r\n  WinstonEnhancedLogger,\r\n  LoggerAdapter,\r\n} from './enhanced-logger.js';\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\monitoring\\MetricsCollector.ts","messages":[{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":100,"column":14,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":101,"endColumn":1,"fix":{"range":[1835,1835],"text":"/**\n   *\n   */\n  "}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { Logger } from '@logging/logger.js';\r\n\r\n/**\r\n * 指标类型枚举\r\n */\r\nexport enum MetricType {\r\n  COUNTER = 'counter',\r\n  GAUGE = 'gauge',\r\n  HISTOGRAM = 'histogram',\r\n  TIMER = 'timer',\r\n}\r\n\r\n/**\r\n * 指标接口\r\n */\r\nexport interface Metric {\r\n  name: string;\r\n  type: MetricType;\r\n  value: number;\r\n  timestamp: number;\r\n  labels?: Record<string, string>;\r\n  description?: string;\r\n  unit?: string;\r\n}\r\n\r\n/**\r\n * 直方图桶配置\r\n */\r\nexport interface HistogramBucket {\r\n  le: number; // 小于等于\r\n  count: number;\r\n}\r\n\r\n/**\r\n * 直方图数据\r\n */\r\nexport interface HistogramData {\r\n  buckets: HistogramBucket[];\r\n  count: number;\r\n  sum: number;\r\n}\r\n\r\n/**\r\n * 指标收集器配置\r\n */\r\nexport interface MetricsCollectorConfig {\r\n  // 是否启用指标收集\r\n  enabled?: boolean;\r\n\r\n  // 指标保留时间（毫秒）\r\n  retentionPeriod?: number;\r\n\r\n  // 清理间隔（毫秒）\r\n  cleanupInterval?: number;\r\n\r\n  // 最大指标数量\r\n  maxMetrics?: number;\r\n\r\n  // 是否启用持久化\r\n  enablePersistence?: boolean;\r\n\r\n  // 持久化间隔（毫秒）\r\n  persistenceInterval?: number;\r\n\r\n  // 慢查询阈值（毫秒）\r\n  slowQueryThreshold?: number;\r\n\r\n  // 内存使用阈值（字节）\r\n  memoryThreshold?: number;\r\n\r\n  // CPU使用阈值（百分比）\r\n  cpuThreshold?: number;\r\n}\r\n\r\n/**\r\n * 默认指标收集器配置\r\n */\r\nexport const DEFAULT_METRICS_CONFIG: MetricsCollectorConfig = {\r\n  enabled: true,\r\n  retentionPeriod: 3600000, // 1小时\r\n  cleanupInterval: 300000, // 5分钟\r\n  maxMetrics: 10000,\r\n  enablePersistence: false,\r\n  persistenceInterval: 60000, // 1分钟\r\n  slowQueryThreshold: 1000, // 1秒\r\n  memoryThreshold: 1024 * 1024 * 1024, // 1GB\r\n  cpuThreshold: 80, // 80%\r\n};\r\n\r\n/**\r\n * 指标收集器\r\n */\r\nexport class MetricsCollector {\r\n  private metrics: Map<string, Metric[]> = new Map();\r\n  private histograms: Map<string, HistogramData> = new Map();\r\n  private timers: Map<string, number> = new Map();\r\n  private cleanupTimer: NodeJS.Timeout | null = null;\r\n  private persistenceTimer: NodeJS.Timeout | null = null;\r\n\r\n  constructor(\r\n    private readonly config: MetricsCollectorConfig = {},\r\n    private readonly logger?: Logger,\r\n  ) {\r\n    const finalConfig = { ...DEFAULT_METRICS_CONFIG, ...config };\r\n    this.config = finalConfig;\r\n\r\n    if (finalConfig.enabled) {\r\n      this.startCleanupTimer();\r\n      if (finalConfig.enablePersistence) {\r\n        this.startPersistenceTimer();\r\n      }\r\n\r\n      this.logger?.info('指标收集器已启动', {\r\n        retentionPeriod: finalConfig.retentionPeriod,\r\n        cleanupInterval: finalConfig.cleanupInterval,\r\n        maxMetrics: finalConfig.maxMetrics,\r\n      });\r\n    } else {\r\n      this.logger?.info('指标收集器已禁用');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 记录计数器指标\r\n   * @param name 指标名称\r\n   * @param value 增量值，默认为1\r\n   * @param labels 标签\r\n   * @param description 描述\r\n   */\r\n  incrementCounter(\r\n    name: string,\r\n    value: number = 1,\r\n    labels?: Record<string, string>,\r\n    description?: string,\r\n  ): void {\r\n    if (!this.config.enabled) return;\r\n\r\n    this.recordMetric({\r\n      name,\r\n      type: MetricType.COUNTER,\r\n      value,\r\n      timestamp: Date.now(),\r\n      labels,\r\n      description,\r\n    });\r\n\r\n    this.logger?.debug('计数器指标已记录', { name, value, labels });\r\n  }\r\n\r\n  /**\r\n   * 设置仪表盘指标\r\n   * @param name 指标名称\r\n   * @param value 指标值\r\n   * @param labels 标签\r\n   * @param description 描述\r\n   * @param unit 单位\r\n   */\r\n  setGauge(\r\n    name: string,\r\n    value: number,\r\n    labels?: Record<string, string>,\r\n    description?: string,\r\n    unit?: string,\r\n  ): void {\r\n    if (!this.config.enabled) return;\r\n\r\n    this.recordMetric({\r\n      name,\r\n      type: MetricType.GAUGE,\r\n      value,\r\n      timestamp: Date.now(),\r\n      labels,\r\n      description,\r\n      unit,\r\n    });\r\n\r\n    this.logger?.debug('仪表盘指标已设置', { name, value, labels, unit });\r\n  }\r\n\r\n  /**\r\n   * 记录直方图指标\r\n   * @param name 指标名称\r\n   * @param value 观测值\r\n   * @param buckets 桶配置，可选\r\n   * @param labels 标签\r\n   * @param description 描述\r\n   * @param unit 单位\r\n   */\r\n  recordHistogram(\r\n    name: string,\r\n    value: number,\r\n    buckets?: number[],\r\n    labels?: Record<string, string>,\r\n    description?: string,\r\n    unit?: string,\r\n  ): void {\r\n    if (!this.config.enabled) return;\r\n\r\n    // 获取或创建直方图数据\r\n    let histogramData = this.histograms.get(name);\r\n    if (!histogramData) {\r\n      // 默认桶配置\r\n      const defaultBuckets = buckets || [\r\n        0.1, 0.5, 1, 2.5, 5, 10, 25, 50, 100, 250, 500, 1000, 2500, 5000, 10000,\r\n      ];\r\n      histogramData = {\r\n        buckets: defaultBuckets.map((le) => ({ le, count: 0 })),\r\n        count: 0,\r\n        sum: 0,\r\n      };\r\n      this.histograms.set(name, histogramData);\r\n    }\r\n\r\n    // 更新直方图数据\r\n    histogramData.count++;\r\n    histogramData.sum += value;\r\n\r\n    for (const bucket of histogramData.buckets) {\r\n      if (value <= bucket.le) {\r\n        bucket.count++;\r\n      }\r\n    }\r\n\r\n    this.logger?.debug('直方图指标已记录', { name, value, labels });\r\n  }\r\n\r\n  /**\r\n   * 开始计时器\r\n   * @param name 计时器名称\r\n   * @param labels 标签\r\n   * @returns 计时器ID\r\n   */\r\n  startTimer(name: string, labels?: Record<string, string>): string {\r\n    if (!this.config.enabled) return '';\r\n\r\n    const timerId = `${name}_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\r\n    this.timers.set(timerId, Date.now());\r\n\r\n    this.logger?.debug('计时器已启动', { name, timerId, labels });\r\n    return timerId;\r\n  }\r\n\r\n  /**\r\n   * 结束计时器并记录时间\r\n   * @param timerId 计时器ID\r\n   * @param labels 标签\r\n   * @param description 描述\r\n   */\r\n  endTimer(\r\n    timerId: string,\r\n    labels?: Record<string, string>,\r\n    description?: string,\r\n  ): void {\r\n    if (!this.config.enabled) return;\r\n\r\n    const startTime = this.timers.get(timerId);\r\n    if (!startTime) {\r\n      this.logger?.warn('计时器未找到', { timerId });\r\n      return;\r\n    }\r\n\r\n    const duration = Date.now() - startTime;\r\n    this.timers.delete(timerId);\r\n\r\n    // 从计时器ID中提取名称\r\n    const name = timerId.split('_')[0];\r\n\r\n    this.recordMetric({\r\n      name,\r\n      type: MetricType.TIMER,\r\n      value: duration,\r\n      timestamp: Date.now(),\r\n      labels,\r\n      description,\r\n      unit: 'ms',\r\n    });\r\n\r\n    this.logger?.debug('计时器已结束', { name, timerId, duration, labels });\r\n  }\r\n\r\n  /**\r\n   * 记录数据库查询指标\r\n   * @param operation 操作类型\r\n   * @param table 表名\r\n   * @param duration 查询时间（毫秒）\r\n   * @param success 是否成功\r\n   * @param rowCount 影响行数\r\n   */\r\n  recordDatabaseQuery(\r\n    operation: string,\r\n    table: string,\r\n    duration: number,\r\n    success: boolean,\r\n    rowCount?: number,\r\n  ): void {\r\n    if (!this.config.enabled) return;\r\n\r\n    const labels = {\r\n      operation,\r\n      table,\r\n      success: success.toString(),\r\n    };\r\n\r\n    // 记录查询时间\r\n    this.recordHistogram(\r\n      'database_query_duration',\r\n      duration,\r\n      undefined,\r\n      labels,\r\n      '数据库查询持续时间',\r\n      'ms',\r\n    );\r\n\r\n    // 记录查询计数\r\n    this.incrementCounter(\r\n      'database_queries_total',\r\n      1,\r\n      labels,\r\n      '数据库查询总数',\r\n    );\r\n\r\n    // 记录慢查询\r\n    if (\r\n      this.config.slowQueryThreshold &&\r\n      duration > this.config.slowQueryThreshold\r\n    ) {\r\n      this.incrementCounter(\r\n        'database_slow_queries_total',\r\n        1,\r\n        labels,\r\n        '慢查询总数',\r\n      );\r\n      this.logger?.warn('检测到慢查询', {\r\n        operation,\r\n        table,\r\n        duration,\r\n        threshold: this.config.slowQueryThreshold,\r\n      });\r\n    }\r\n\r\n    // 记录影响行数\r\n    if (rowCount !== undefined) {\r\n      this.recordHistogram(\r\n        'database_query_rows',\r\n        rowCount,\r\n        undefined,\r\n        labels,\r\n        '数据库查询影响行数',\r\n        'rows',\r\n      );\r\n    }\r\n\r\n    // 记录成功/失败率\r\n    if (!success) {\r\n      this.incrementCounter(\r\n        'database_query_errors_total',\r\n        1,\r\n        labels,\r\n        '数据库查询错误总数',\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 记录缓存指标\r\n   * @param operation 操作类型\r\n   * @param cacheType 缓存类型\r\n   * @param hit 是否命中\r\n   * @param duration 操作时间（毫秒）\r\n   */\r\n  recordCacheOperation(\r\n    operation: string,\r\n    cacheType: string,\r\n    hit: boolean,\r\n    duration?: number,\r\n  ): void {\r\n    if (!this.config.enabled) return;\r\n\r\n    const labels = {\r\n      operation,\r\n      cache_type: cacheType,\r\n      hit: hit.toString(),\r\n    };\r\n\r\n    // 记录缓存操作计数\r\n    this.incrementCounter('cache_operations_total', 1, labels, '缓存操作总数');\r\n\r\n    // 记录缓存命中率\r\n    this.incrementCounter('cache_hits_total', 1, labels, '缓存命中总数');\r\n\r\n    // 记录缓存操作时间\r\n    if (duration !== undefined) {\r\n      this.recordHistogram(\r\n        'cache_operation_duration',\r\n        duration,\r\n        undefined,\r\n        labels,\r\n        '缓存操作持续时间',\r\n        'ms',\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 记录HTTP请求指标\r\n   * @param method HTTP方法\r\n   * @param route 路由\r\n   * @param statusCode 状态码\r\n   * @param duration 请求时间（毫秒）\r\n   * @param contentLength 响应内容长度\r\n   */\r\n  recordHttpRequest(\r\n    method: string,\r\n    route: string,\r\n    statusCode: number,\r\n    duration: number,\r\n    contentLength?: number,\r\n  ): void {\r\n    if (!this.config.enabled) return;\r\n\r\n    const labels = {\r\n      method,\r\n      route,\r\n      status_code: statusCode.toString(),\r\n      status_class: this.getStatusClass(statusCode),\r\n    };\r\n\r\n    // 记录请求计数\r\n    this.incrementCounter('http_requests_total', 1, labels, 'HTTP请求总数');\r\n\r\n    // 记录请求时间\r\n    this.recordHistogram(\r\n      'http_request_duration',\r\n      duration,\r\n      undefined,\r\n      labels,\r\n      'HTTP请求持续时间',\r\n      'ms',\r\n    );\r\n\r\n    // 记录响应大小\r\n    if (contentLength !== undefined) {\r\n      this.recordHistogram(\r\n        'http_response_size_bytes',\r\n        contentLength,\r\n        undefined,\r\n        labels,\r\n        'HTTP响应大小',\r\n        'bytes',\r\n      );\r\n    }\r\n\r\n    // 记录错误请求\r\n    if (statusCode >= 400) {\r\n      this.incrementCounter('http_errors_total', 1, labels, 'HTTP错误总数');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 记录系统指标\r\n   * @param cpuUsage CPU使用率（百分比）\r\n   * @param memoryUsage 内存使用量（字节）\r\n   * @param diskUsage 磁盘使用量（字节）\r\n   * @param networkIO 网络IO（字节）\r\n   */\r\n  recordSystemMetrics(\r\n    cpuUsage?: number,\r\n    memoryUsage?: number,\r\n    diskUsage?: number,\r\n    networkIO?: number,\r\n  ): void {\r\n    if (!this.config.enabled) return;\r\n\r\n    // 记录CPU使用率\r\n    if (cpuUsage !== undefined) {\r\n      this.setGauge(\r\n        'system_cpu_usage_percent',\r\n        cpuUsage,\r\n        undefined,\r\n        '系统CPU使用率',\r\n        '%',\r\n      );\r\n\r\n      // 检查CPU阈值\r\n      if (this.config.cpuThreshold && cpuUsage > this.config.cpuThreshold) {\r\n        this.logger?.warn('CPU使用率超过阈值', {\r\n          usage: cpuUsage,\r\n          threshold: this.config.cpuThreshold,\r\n        });\r\n        this.incrementCounter(\r\n          'system_cpu_threshold_exceeded_total',\r\n          1,\r\n          undefined,\r\n          'CPU阈值超出次数',\r\n        );\r\n      }\r\n    }\r\n\r\n    // 记录内存使用量\r\n    if (memoryUsage !== undefined) {\r\n      this.setGauge(\r\n        'system_memory_usage_bytes',\r\n        memoryUsage,\r\n        undefined,\r\n        '系统内存使用量',\r\n        'bytes',\r\n      );\r\n\r\n      // 检查内存阈值\r\n      if (\r\n        this.config.memoryThreshold &&\r\n        memoryUsage > this.config.memoryThreshold\r\n      ) {\r\n        this.logger?.warn('内存使用量超过阈值', {\r\n          usage: memoryUsage,\r\n          threshold: this.config.memoryThreshold,\r\n        });\r\n        this.incrementCounter(\r\n          'system_memory_threshold_exceeded_total',\r\n          1,\r\n          undefined,\r\n          '内存阈值超出次数',\r\n        );\r\n      }\r\n    }\r\n\r\n    // 记录磁盘使用量\r\n    if (diskUsage !== undefined) {\r\n      this.setGauge(\r\n        'system_disk_usage_bytes',\r\n        diskUsage,\r\n        undefined,\r\n        '系统磁盘使用量',\r\n        'bytes',\r\n      );\r\n    }\r\n\r\n    // 记录网络IO\r\n    if (networkIO !== undefined) {\r\n      this.setGauge(\r\n        'system_network_io_bytes',\r\n        networkIO,\r\n        undefined,\r\n        '系统网络IO',\r\n        'bytes',\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取指标数据\r\n   * @param name 指标名称，可选\r\n   * @param startTime 开始时间，可选\r\n   * @param endTime 结束时间，可选\r\n   * @returns 指标数据\r\n   */\r\n  getMetrics(name?: string, startTime?: number, endTime?: number): Metric[] {\r\n    if (!this.config.enabled) return [];\r\n\r\n    let metrics: Metric[] = [];\r\n\r\n    if (name) {\r\n      const namedMetrics = this.metrics.get(name) || [];\r\n      metrics = namedMetrics.filter((metric) => {\r\n        if (startTime && metric.timestamp < startTime) return false;\r\n        if (endTime && metric.timestamp > endTime) return false;\r\n        return true;\r\n      });\r\n    } else {\r\n      for (const namedMetrics of this.metrics.values()) {\r\n        metrics.push(\r\n          ...namedMetrics.filter((metric) => {\r\n            if (startTime && metric.timestamp < startTime) return false;\r\n            if (endTime && metric.timestamp > endTime) return false;\r\n            return true;\r\n          }),\r\n        );\r\n      }\r\n    }\r\n\r\n    return metrics.sort((a, b) => b.timestamp - a.timestamp);\r\n  }\r\n\r\n  /**\r\n   * 获取直方图数据\r\n   * @param name 直方图名称\r\n   * @returns 直方图数据\r\n   */\r\n  getHistogram(name: string): HistogramData | null {\r\n    if (!this.config.enabled) return null;\r\n    return this.histograms.get(name) || null;\r\n  }\r\n\r\n  /**\r\n   * 获取所有指标名称\r\n   * @returns 指标名称数组\r\n   */\r\n  getMetricNames(): string[] {\r\n    if (!this.config.enabled) return [];\r\n    return Array.from(this.metrics.keys());\r\n  }\r\n\r\n  /**\r\n   * 清空所有指标\r\n   */\r\n  clearMetrics(): void {\r\n    if (!this.config.enabled) return;\r\n\r\n    this.metrics.clear();\r\n    this.histograms.clear();\r\n    this.timers.clear();\r\n\r\n    this.logger?.debug('所有指标已清空');\r\n  }\r\n\r\n  /**\r\n   * 销毁指标收集器\r\n   */\r\n  destroy(): void {\r\n    if (this.cleanupTimer) {\r\n      clearInterval(this.cleanupTimer);\r\n      this.cleanupTimer = null;\r\n    }\r\n\r\n    if (this.persistenceTimer) {\r\n      clearInterval(this.persistenceTimer);\r\n      this.persistenceTimer = null;\r\n    }\r\n\r\n    this.clearMetrics();\r\n    this.logger?.debug('指标收集器已销毁');\r\n  }\r\n\r\n  /**\r\n   * 记录指标\r\n   * @param metric 指标数据\r\n   */\r\n  private recordMetric(metric: Metric): void {\r\n    const namedMetrics = this.metrics.get(metric.name) || [];\r\n    namedMetrics.push(metric);\r\n    this.metrics.set(metric.name, namedMetrics);\r\n\r\n    // 检查指标数量限制\r\n    if (\r\n      this.config.maxMetrics &&\r\n      namedMetrics.length > this.config.maxMetrics\r\n    ) {\r\n      // 移除最旧的指标\r\n      const removed = namedMetrics.splice(\r\n        0,\r\n        namedMetrics.length - this.config.maxMetrics,\r\n      );\r\n      this.logger?.debug('指标数量超限，已移除旧指标', {\r\n        count: removed.length,\r\n        metricName: metric.name,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取HTTP状态码类别\r\n   * @param statusCode 状态码\r\n   * @returns 状态码类别\r\n   */\r\n  private getStatusClass(statusCode: number): string {\r\n    if (statusCode < 200) return '1xx';\r\n    if (statusCode < 300) return '2xx';\r\n    if (statusCode < 400) return '3xx';\r\n    if (statusCode < 500) return '4xx';\r\n    return '5xx';\r\n  }\r\n\r\n  /**\r\n   * 启动清理定时器\r\n   */\r\n  private startCleanupTimer(): void {\r\n    if (!this.config.cleanupInterval || this.config.cleanupInterval <= 0) {\r\n      return;\r\n    }\r\n\r\n    this.cleanupTimer = setInterval(() => {\r\n      this.cleanup();\r\n    }, this.config.cleanupInterval);\r\n  }\r\n\r\n  /**\r\n   * 启动持久化定时器\r\n   */\r\n  private startPersistenceTimer(): void {\r\n    if (\r\n      !this.config.persistenceInterval ||\r\n      this.config.persistenceInterval <= 0\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    this.persistenceTimer = setInterval(() => {\r\n      this.persistMetrics();\r\n    }, this.config.persistenceInterval);\r\n  }\r\n\r\n  /**\r\n   * 清理过期指标\r\n   */\r\n  private cleanup(): void {\r\n    if (!this.config.retentionPeriod) return;\r\n\r\n    const now = Date.now();\r\n    const cutoffTime = now - this.config.retentionPeriod;\r\n    let totalRemoved = 0;\r\n\r\n    for (const [name, metrics] of this.metrics.entries()) {\r\n      const originalLength = metrics.length;\r\n      const filteredMetrics = metrics.filter(\r\n        (metric) => metric.timestamp > cutoffTime,\r\n      );\r\n\r\n      if (filteredMetrics.length < originalLength) {\r\n        this.metrics.set(name, filteredMetrics);\r\n        totalRemoved += originalLength - filteredMetrics.length;\r\n      }\r\n    }\r\n\r\n    if (totalRemoved > 0) {\r\n      this.logger?.debug('过期指标已清理', { count: totalRemoved });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 持久化指标\r\n   */\r\n  private async persistMetrics(): Promise<void> {\r\n    try {\r\n      // TODO: 实现指标持久化逻辑\r\n      this.logger?.debug('指标持久化功能尚未实现');\r\n    } catch (error) {\r\n      this.logger?.error('指标持久化失败', { error });\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\persistence\\DAOStub.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":56,"column":3,"severity":1,"nodeType":null,"fix":{"range":[1568,1630],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1776,1779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1776,1779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":77,"column":3,"severity":1,"nodeType":null,"fix":{"range":[2191,2253],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2375,2378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2375,2378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":112,"column":3,"severity":1,"nodeType":null,"fix":{"range":[3295,3357],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3476,3479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3476,3479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":120,"column":3,"severity":1,"nodeType":null,"fix":{"range":[3509,3571],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3667,3670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3667,3670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[300,303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[300,303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[322,325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[322,325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[469,472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[469,472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[491,494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[491,494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[695,698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[695,698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[811,814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[811,814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[825,828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[825,828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[964,967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[964,967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1115,1118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1115,1118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1230,1233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1230,1233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1244,1247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1244,1247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1493,1496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1493,1496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2012,2015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2012,2015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2159,2162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2159,2162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2563,2566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2563,2566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2585,2588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2585,2588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2739,2742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2739,2742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2909,2912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2909,2912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3045,3048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3045,3048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3171,3174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3171,3174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3194,3197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3194,3197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3830,3833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3830,3833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3952,3955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3952,3955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3966,3969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3966,3969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4122,4125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4122,4125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":4,"source":"/**\r\n * DAOStub - 在迁移到TypeORM后提供向后兼容性的通用存根类\r\n * 所有方法返回默认值/空值，防止运行时错误\r\n * 注意：这是一个兼容性占位符。实际调用会返回 undefined 或空值。\r\n * 服务应该迁移到使用 TypeORM 仓库而不是这个存根。\r\n */\r\nexport class DAOStub {\r\n  // 同步创建方法 - 返回 undefined\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  create = (data: Record<string, any>) => undefined as any;\r\n\r\n  // 同步更新方法 - 返回 undefined\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  update = (id: string, data: Record<string, any>) => undefined as any;\r\n\r\n  // 同步删除方法 - 返回 false\r\n  delete = (id: string) => false;\r\n\r\n  // 同步获取方法 - 返回 undefined\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getById = (id: string) => undefined as any;\r\n\r\n  // 同步获取所有 - 返回空数组\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getAll = (filter?: any) => [] as any[];\r\n\r\n  // 同步状态查询 - 返回空数组\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getByStatus = (status: string) => [] as any[];\r\n\r\n  // 同步文档查询 - 返回 undefined\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getByDocId = (docId: string) => undefined as any;\r\n\r\n  // 同步列表查询 - 返回空数组\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  list = (options?: any) => [] as any;\r\n\r\n  // 获取统计信息\r\n  getStats = () => ({\r\n    total: 0,\r\n    statusBreakdown: {},\r\n    active: 0,\r\n    inactive: 0,\r\n    bySeverity: {},\r\n  });\r\n\r\n  // 获取计数\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getCount = (filter?: any) => 0;\r\n\r\n  // 清理旧记录\r\n  cleanup = (days: number) => 0;\r\n\r\n  // 分页查询\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  listPaginated = (\r\n    page: number,\r\n    pageSize: number,\r\n    sort?: string,\r\n    order?: string,\r\n    activeOnly?: boolean,\r\n  ) => [] as any;\r\n\r\n  // 设置活跃状态 - 返回 false\r\n  setActive = (id: string, isActive: boolean) => false;\r\n\r\n  // 获取最新记录 - 返回 undefined\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getLatestByName = (name: string) => undefined as any;\r\n\r\n  // 获取多个最新记录 - 返回空对象\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getLatestByNames = (names: string[]) => ({}) as any;\r\n\r\n  // 按时间范围查询 - 返回空数组\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getByNameAndTimeRange = (\r\n    name: string,\r\n    start: number,\r\n    end: number,\r\n    limit?: number,\r\n  ) => [] as any[];\r\n\r\n  // ping 检查 - 返回 true\r\n  ping = () => true;\r\n\r\n  // upsert 操作 - 返回 undefined\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  upsert = (data: Record<string, any>) => undefined as any;\r\n\r\n  // 获取整体健康状态 - 返回健康状态对象\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getOverallHealth = () => ({ status: 'healthy' }) as any;\r\n\r\n  // 按组件获取健康状态 - 返回健康状态对象\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getByComponent = (component: string) => ({ status: 'healthy' }) as any;\r\n\r\n  // 获取不健康的组件 - 返回空数组\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getUnhealthyComponents = () => [] as any[];\r\n\r\n  // 批量创建 - 返回 undefined\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  createBatch = (items: any[]) => undefined as any;\r\n\r\n  // 获取所有指标名称 - 返回空数组\r\n  getAllMetricNames = () => [] as string[];\r\n\r\n  // 获取聚合指标 - 返回空对象\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getAggregatedMetrics = (\r\n    metricName?: string,\r\n    startTime?: number,\r\n    endTime?: number,\r\n  ) => ({}) as any;\r\n\r\n  // 获取指标统计信息 - 返回空对象\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getMetricStats = (metricName: string, startTime?: number, endTime?: number) =>\r\n    ({}) as any;\r\n\r\n  // 标记为已导入 - 返回 undefined\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  markImported = (id: string, docId: string) => undefined as any;\r\n\r\n  // 获取任务组 - 返回空数组\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  getTaskGroups = (options: any) => [] as any[];\r\n\r\n  // 删除任务相关数据 - 返回 undefined\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  deleteByTask = (taskId: string) => undefined as any;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\persistence\\DatabaseInitializer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\persistence\\DatabaseSchemaManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\persistence\\DatabaseStatusChecker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\repositories\\QdrantRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\repositories\\SQLiteRepositoryCore.ts","messages":[{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":9,"column":14,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":10,"endColumn":1,"fix":{"range":[276,276],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":11,"column":20,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":12,"endColumn":1,"fix":{"range":[337,337],"text":"/**\n   *\n   */\n  "}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { DataSource } from 'typeorm';\r\n\r\n/**\r\n * Lightweight wrapper around the primary SQLite TypeORM DataSource so higher\r\n * level services can execute functions inside a DB transaction without\r\n * depending directly on TypeORM APIs.\r\n */\r\nexport class SQLiteRepoCore {\r\n  constructor(private readonly dataSource: DataSource) {}\r\n\r\n  async transaction<T>(fn: () => Promise<T> | T): Promise<T> {\r\n    return this.dataSource.transaction(async () => fn());\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\scheduling\\scheduler.ts","messages":[{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"enhancedLogger\" declaration.","line":8,"column":1,"nodeType":"Block","endLine":16,"endColumn":4,"fix":{"range":[368,553],"text":"/**\r\n * 设置定时任务\r\n *\r\n * @param monitoringService - 监控服务实例\r\n * @param alertService - 告警服务实例\r\n * @param autoGCService - 自动垃圾回收服务实例\r\n * @param config - 应用程序配置\r\n * @param logger - 日志器实例\r\n * @param enhancedLogger\n */"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import cron from 'node-cron';\r\nimport { Logger, EnhancedLogger } from '@logging/logger.js';\r\nimport { MonitoringService } from '@application/services/monitoring/index.js';\r\nimport { AlertService } from '@application/services/alerting/index.js';\r\nimport { AutoGCService } from '@application/services/system/index.js';\r\nimport { AppConfig } from '@config/config.js';\r\n\r\n/**\r\n * 设置定时任务\r\n *\r\n * @param monitoringService - 监控服务实例\r\n * @param alertService - 告警服务实例\r\n * @param autoGCService - 自动垃圾回收服务实例\r\n * @param config - 应用程序配置\r\n * @param logger - 日志器实例\r\n */\r\nexport function setupScheduledTasks(\r\n  monitoringService: MonitoringService,\r\n  alertService: AlertService,\r\n  autoGCService: AutoGCService,\r\n  config: AppConfig,\r\n  logger: Logger,\r\n  enhancedLogger?: EnhancedLogger,\r\n): void {\r\n  logger.info('启动监控服务...');\r\n\r\n  // 启动健康检查定时任务（每5分钟）\r\n  cron.schedule('*/5 * * * *', () => {\r\n    monitoringService.performHealthCheck().catch((err) => {\r\n      logger.error(`健康检查失败: ${(err as Error).message}`, err);\r\n    });\r\n  });\r\n\r\n  // 启动告警检查定时任务（每1分钟）\r\n  cron.schedule('* * * * *', () => {\r\n    alertService.checkAlerts().catch((err) => {\r\n      logger.error(`告警检查失败: ${(err as Error).message}`, err);\r\n    });\r\n  });\r\n\r\n  // 设置监控数据清理任务（每天凌晨2点）\r\n  cron.schedule('0 2 * * *', () => {\r\n    monitoringService.cleanup(30); // 清理30天前的数据\r\n    logger.info('监控数据清理任务完成');\r\n  });\r\n\r\n  logger.info('监控服务已启动');\r\n\r\n  // 设置自动垃圾回收（AutoGC）定时任务\r\n  setupGCTasks(autoGCService, config, logger);\r\n}\r\n\r\n/**\r\n * 设置垃圾回收定时任务\r\n *\r\n * @param autoGCService - 自动垃圾回收服务实例\r\n * @param config - 应用程序配置\r\n * @param logger - 日志器实例\r\n */\r\nfunction setupGCTasks(\r\n  autoGCService: AutoGCService,\r\n  config: AppConfig,\r\n  logger: Logger,\r\n): void {\r\n  const gcIntervalHours = config.gc.intervalHours; // 垃圾回收间隔小时数\r\n  logger.info(`AutoGC 定时任务已设置，每${gcIntervalHours} 小时运行一次。`);\r\n\r\n  // 立即运行一次垃圾回收\r\n  setTimeout(() => {\r\n    logger.info('执行初始垃圾回收...');\r\n    autoGCService.runGC().catch((err) => {\r\n      logger.error(`初始垃圾回收失败: ${(err as Error).message}`, err);\r\n    });\r\n  }, 5000); // 5秒后执行，确保应用完全启动\r\n\r\n  // 设置定时任务\r\n  // cron 表达式：'0 */${gcIntervalHours} * * *' 表示每${gcIntervalHours}小时执行一次，在小时的0分钟\r\n  cron.schedule(`0 */${gcIntervalHours} * * *`, () => {\r\n    logger.info('执行定时垃圾回收...');\r\n    autoGCService.runGC().catch((err) => {\r\n      logger.error(`定时垃圾回收失败: ${(err as Error).message}`, err);\r\n    });\r\n  });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\sqlite\\dao\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\state-machine\\StatePersistence.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\state-machine\\TypeORMStatePersistence.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\strategies\\StrategyRegistry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\transactions\\TransactionContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\transactions\\TransactionErrorHandler.ts","messages":[{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":29,"column":1,"nodeType":"TSTypeAliasDeclaration","messageId":"missingJsDoc","endLine":30,"endColumn":1,"fix":{"range":[1050,1050],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"dataSource\" declaration.","line":324,"column":3,"nodeType":"Block","endLine":327,"endColumn":6,"fix":{"range":[8651,8705],"text":"/**\r\n   * 创建事务错误处理器实例\r\n   * @param logger 日志记录器\r\n   * @param dataSource\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"context.transactionId\" declaration.","line":365,"column":3,"nodeType":"Block","endLine":370,"endColumn":6,"fix":{"range":[9590,9699],"text":"/**\r\n   * 处理错误并返回AppError\r\n   * @param error 原始错误\r\n   * @param context 错误上下文\r\n   * @param context.transactionId\n   * @param context.operation\n   * @param context.additionalContext\n   * @returns AppError实例\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"context.operation\" declaration.","line":365,"column":3,"nodeType":"Block","endLine":370,"endColumn":6,"fix":{"range":[9590,9699],"text":"/**\r\n   * 处理错误并返回AppError\r\n   * @param error 原始错误\r\n   * @param context 错误上下文\r\n   * @param context.transactionId\n   * @param context.operation\n   * @param context.additionalContext\n   * @param context.transactionId\n   * @param context.operation\n   * @param context.additionalContext\n   * @returns AppError实例\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"context.additionalContext\" declaration.","line":365,"column":3,"nodeType":"Block","endLine":370,"endColumn":6,"fix":{"range":[9590,9699],"text":"/**\r\n   * 处理错误并返回AppError\r\n   * @param error 原始错误\r\n   * @param context 错误上下文\r\n   * @param context.transactionId\n   * @param context.operation\n   * @param context.additionalContext\n   * @param context.transactionId\n   * @param context.operation\n   * @param context.additionalContext\n   * @param context.transactionId\n   * @param context.operation\n   * @param context.additionalContext\n   * @returns AppError实例\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.maxRetries\" declaration.","line":602,"column":3,"nodeType":"Block","endLine":607,"endColumn":6,"fix":{"range":[16008,16109],"text":"/**\r\n   * 执行带重试的操作\r\n   * @param operation 要执行的操作\r\n   * @param options 重试选项\r\n   * @param options.maxRetries\n   * @param options.retryDelay\n   * @returns 操作结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.retryDelay\" declaration.","line":602,"column":3,"nodeType":"Block","endLine":607,"endColumn":6,"fix":{"range":[16008,16109],"text":"/**\r\n   * 执行带重试的操作\r\n   * @param operation 要执行的操作\r\n   * @param options 重试选项\r\n   * @param options.maxRetries\n   * @param options.retryDelay\n   * @param options.maxRetries\n   * @param options.retryDelay\n   * @returns 操作结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.maxRetries\" declaration.","line":640,"column":3,"nodeType":"Block","endLine":645,"endColumn":6,"fix":{"range":[16977,17080],"text":"/**\r\n   * 执行带事务恢复的操作\r\n   * @param operation 要执行的操作\r\n   * @param options 重试选项\r\n   * @param options.maxRetries\n   * @param options.retryDelay\n   * @returns 操作结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.retryDelay\" declaration.","line":640,"column":3,"nodeType":"Block","endLine":645,"endColumn":6,"fix":{"range":[16977,17080],"text":"/**\r\n   * 执行带事务恢复的操作\r\n   * @param operation 要执行的操作\r\n   * @param options 重试选项\r\n   * @param options.maxRetries\n   * @param options.retryDelay\n   * @param options.maxRetries\n   * @param options.retryDelay\n   * @returns 操作结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.continueOnError\" declaration.","line":656,"column":3,"nodeType":"Block","endLine":661,"endColumn":6,"fix":{"range":[17321,17428],"text":"/**\r\n   * 执行批量操作并支持恢复\r\n   * @param operations 操作数组\r\n   * @param options 批量操作选项\r\n   * @param options.continueOnError\n   * @param options.maxFailures\n   * @returns 批量操作结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.maxFailures\" declaration.","line":656,"column":3,"nodeType":"Block","endLine":661,"endColumn":6,"fix":{"range":[17321,17428],"text":"/**\r\n   * 执行批量操作并支持恢复\r\n   * @param operations 操作数组\r\n   * @param options 批量操作选项\r\n   * @param options.continueOnError\n   * @param options.maxFailures\n   * @param options.continueOnError\n   * @param options.maxFailures\n   * @returns 批量操作结果\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.failureThreshold\" declaration.","line":701,"column":3,"nodeType":"Block","endLine":705,"endColumn":6,"fix":{"range":[18331,18401],"text":"/**\r\n   * 创建断路器\r\n   * @param options 断路器选项\r\n   * @param options.failureThreshold\n   * @param options.timeout\n   * @returns 断路器实例\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.timeout\" declaration.","line":701,"column":3,"nodeType":"Block","endLine":705,"endColumn":6,"fix":{"range":[18331,18401],"text":"/**\r\n   * 创建断路器\r\n   * @param options 断路器选项\r\n   * @param options.failureThreshold\n   * @param options.timeout\n   * @param options.failureThreshold\n   * @param options.timeout\n   * @returns 断路器实例\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.startTime\" declaration.","line":794,"column":3,"nodeType":"Block","endLine":798,"endColumn":6,"fix":{"range":[20794,20865],"text":"/**\r\n   * 获取错误日志\r\n   * @param options 查询选项\r\n   * @param options.startTime\n   * @param options.endTime\n   * @returns 错误日志数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.endTime\" declaration.","line":794,"column":3,"nodeType":"Block","endLine":798,"endColumn":6,"fix":{"range":[20794,20865],"text":"/**\r\n   * 获取错误日志\r\n   * @param options 查询选项\r\n   * @param options.startTime\n   * @param options.endTime\n   * @param options.startTime\n   * @param options.endTime\n   * @returns 错误日志数组\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.startTime\" declaration.","line":816,"column":3,"nodeType":"Block","endLine":820,"endColumn":6,"fix":{"range":[21301,21370],"text":"/**\r\n   * 生成错误报告\r\n   * @param options 报告选项\r\n   * @param options.startTime\n   * @param options.endTime\n   * @returns 错误报告\r\n   */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"options.endTime\" declaration.","line":816,"column":3,"nodeType":"Block","endLine":820,"endColumn":6,"fix":{"range":[21301,21370],"text":"/**\r\n   * 生成错误报告\r\n   * @param options 报告选项\r\n   * @param options.startTime\n   * @param options.endTime\n   * @param options.startTime\n   * @param options.endTime\n   * @returns 错误报告\r\n   */"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":849,"column":27,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":850,"endColumn":1,"fix":{"range":[22039,22039],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":949,"column":25,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":950,"endColumn":1,"fix":{"range":[24487,24487],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":965,"column":25,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":966,"endColumn":1,"fix":{"range":[24868,24868],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":980,"column":28,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":981,"endColumn":1,"fix":{"range":[25282,25282],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":993,"column":30,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":994,"endColumn":1,"fix":{"range":[25685,25685],"text":"/**\n   *\n   */\n  "}}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":6,"fixableWarningCount":16,"source":"import { DataSource } from 'typeorm';\r\nimport { Logger } from '@logging/logger.js';\r\nimport {\r\n  TransactionContext,\r\n  TransactionOperation,\r\n  TransactionStatus,\r\n} from '@domain/repositories/ITransactionManager.js';\r\nimport { ErrorFactory, ErrorContext } from '@domain/errors/ErrorFactory.js';\r\nimport { AppError } from '@api/contracts/error.js';\r\nimport { SystemMetrics } from '@infrastructure/database/entities/SystemMetrics.js';\r\n\r\n/**\r\n * 事务错误类型枚举\r\n */\r\nexport enum TransactionErrorType {\r\n  TRANSACTION_NOT_FOUND = 'TRANSACTION_NOT_FOUND',\r\n  QUERY_RUNNER_NOT_FOUND = 'QUERY_RUNNER_NOT_FOUND',\r\n  INVALID_TRANSACTION_STATE = 'INVALID_TRANSACTION_STATE',\r\n  OPERATION_EXECUTION_FAILED = 'OPERATION_EXECUTION_FAILED',\r\n  SAVEPOINT_ERROR = 'SAVEPOINT_ERROR',\r\n  NESTED_TRANSACTION_ERROR = 'NESTED_TRANSACTION_ERROR',\r\n  COMMIT_FAILED = 'COMMIT_FAILED',\r\n  ROLLBACK_FAILED = 'ROLLBACK_FAILED',\r\n  DATABASE_CONNECTION_ERROR = 'DATABASE_CONNECTION_ERROR',\r\n  TIMEOUT_ERROR = 'TIMEOUT_ERROR',\r\n  CONSTRAINT_VIOLATION = 'CONSTRAINT_VIOLATION',\r\n}\r\n\r\ntype ErrorLogEntry = {\r\n  message: string;\r\n  context: Record<string, unknown>;\r\n  timestamp: Date;\r\n  stack?: string;\r\n  type: string;\r\n};\r\n\r\n/**\r\n * 事务错误类\r\n */\r\nexport class TransactionError extends Error {\r\n  public readonly type: TransactionErrorType;\r\n  public readonly transactionId?: string;\r\n  public readonly operation?: TransactionOperation;\r\n  public readonly cause?: Error;\r\n  public readonly context?: Record<string, unknown>;\r\n\r\n  /**\r\n   * 创建事务错误实例\r\n   * @param type 错误类型\r\n   * @param message 错误消息\r\n   * @param options 选项\r\n   * @param options.transactionId 事务ID\r\n   * @param options.operation 事务操作\r\n   * @param options.cause 原始错误\r\n   * @param options.context 错误上下文\r\n   */\r\n  constructor(\r\n    type: TransactionErrorType,\r\n    message: string,\r\n    options?: {\r\n      transactionId?: string;\r\n      operation?: TransactionOperation;\r\n      cause?: Error;\r\n      context?: Record<string, unknown>;\r\n    },\r\n  ) {\r\n    super(message);\r\n    this.name = 'TransactionError';\r\n    this.type = type;\r\n    this.transactionId = options?.transactionId;\r\n    this.operation = options?.operation;\r\n    this.cause = options?.cause;\r\n    this.context = options?.context;\r\n\r\n    // 保持堆栈跟踪\r\n    if (Error.captureStackTrace) {\r\n      Error.captureStackTrace(this, TransactionError);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取详细的错误信息\r\n   * @returns 错误详情对象\r\n   */\r\n  getDetails(): Record<string, unknown> {\r\n    return {\r\n      type: this.type,\r\n      message: this.message,\r\n      transactionId: this.transactionId,\r\n      operation: this.operation\r\n        ? {\r\n            type: this.operation.type,\r\n            target: this.operation.target,\r\n            targetId: this.operation.targetId,\r\n          }\r\n        : undefined,\r\n      context: this.context,\r\n      cause: this.cause\r\n        ? {\r\n            message: this.cause.message,\r\n            stack: this.cause.stack,\r\n          }\r\n        : undefined,\r\n      stack: this.stack,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 创建事务未找到错误\r\n   * @param transactionId 事务ID\r\n   * @returns 事务错误实例\r\n   */\r\n  static transactionNotFound(transactionId: string): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.TRANSACTION_NOT_FOUND,\r\n      `Transaction ${transactionId} not found`,\r\n      { transactionId },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建QueryRunner未找到错误\r\n   * @param transactionId 事务ID\r\n   * @returns 事务错误实例\r\n   */\r\n  static queryRunnerNotFound(transactionId: string): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.QUERY_RUNNER_NOT_FOUND,\r\n      `QueryRunner for transaction ${transactionId} not found`,\r\n      { transactionId },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建无效事务状态错误\r\n   * @param transactionId 事务ID\r\n   * @param currentState 当前状态\r\n   * @param expectedState 期望状态\r\n   * @returns 事务错误实例\r\n   */\r\n  static invalidTransactionState(\r\n    transactionId: string,\r\n    currentState: TransactionStatus,\r\n    expectedState?: TransactionStatus,\r\n  ): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.INVALID_TRANSACTION_STATE,\r\n      `Transaction ${transactionId} is in invalid state ${currentState}${expectedState ? `, expected ${expectedState}` : ''}`,\r\n      {\r\n        transactionId,\r\n        context: { currentState, expectedState },\r\n      },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建操作执行失败错误\r\n   * @param transactionId 事务ID\r\n   * @param operation 事务操作\r\n   * @param cause 原始错误\r\n   * @returns 事务错误实例\r\n   */\r\n  static operationExecutionFailed(\r\n    transactionId: string,\r\n    operation: TransactionOperation,\r\n    cause: Error,\r\n  ): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.OPERATION_EXECUTION_FAILED,\r\n      `Failed to execute operation ${operation.type} on ${operation.target} ${operation.targetId} in transaction ${transactionId}`,\r\n      { transactionId, operation, cause },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建保存点错误\r\n   * @param transactionId 事务ID\r\n   * @param savepointId 保存点ID\r\n   * @param operation 操作类型\r\n   * @param cause 原始错误\r\n   * @returns 事务错误实例\r\n   */\r\n  static savepointError(\r\n    transactionId: string,\r\n    savepointId: string,\r\n    operation: 'create' | 'rollback' | 'release',\r\n    cause: Error,\r\n  ): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.SAVEPOINT_ERROR,\r\n      `Failed to ${operation} savepoint ${savepointId} in transaction ${transactionId}`,\r\n      {\r\n        transactionId,\r\n        context: { savepointId, operation },\r\n        cause,\r\n      },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建嵌套事务错误\r\n   * @param transactionId 事务ID\r\n   * @param parentTransactionId 父事务ID\r\n   * @param cause 原始错误\r\n   * @returns 事务错误实例\r\n   */\r\n  static nestedTransactionError(\r\n    transactionId: string,\r\n    parentTransactionId: string,\r\n    cause: Error,\r\n  ): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.NESTED_TRANSACTION_ERROR,\r\n      `Nested transaction ${transactionId} failed with parent ${parentTransactionId}`,\r\n      {\r\n        transactionId,\r\n        context: { parentTransactionId },\r\n        cause,\r\n      },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建提交失败错误\r\n   * @param transactionId 事务ID\r\n   * @param cause 原始错误\r\n   * @returns 事务错误实例\r\n   */\r\n  static commitFailed(transactionId: string, cause: Error): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.COMMIT_FAILED,\r\n      `Failed to commit transaction ${transactionId}`,\r\n      { transactionId, cause },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建回滚失败错误\r\n   * @param transactionId 事务ID\r\n   * @param cause 原始错误\r\n   * @returns 事务错误实例\r\n   */\r\n  static rollbackFailed(transactionId: string, cause: Error): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.ROLLBACK_FAILED,\r\n      `Failed to rollback transaction ${transactionId}`,\r\n      { transactionId, cause },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建数据库连接错误\r\n   * @param transactionId 事务ID\r\n   * @param cause 原始错误\r\n   * @returns 事务错误实例\r\n   */\r\n  static databaseConnectionError(\r\n    transactionId: string,\r\n    cause: Error,\r\n  ): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.DATABASE_CONNECTION_ERROR,\r\n      `Database connection error in transaction ${transactionId}`,\r\n      { transactionId, cause },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建超时错误\r\n   * @param transactionId 事务ID\r\n   * @param timeoutMs 超时时间（毫秒）\r\n   * @param operation 操作名称\r\n   * @returns 事务错误实例\r\n   */\r\n  static timeoutError(\r\n    transactionId: string,\r\n    timeoutMs: number,\r\n    operation?: string,\r\n  ): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.TIMEOUT_ERROR,\r\n      `Transaction ${transactionId} timed out after ${timeoutMs}ms${operation ? ` during ${operation}` : ''}`,\r\n      {\r\n        transactionId,\r\n        context: { timeoutMs, operation },\r\n      },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建约束违反错误\r\n   * @param transactionId 事务ID\r\n   * @param constraint 约束名称\r\n   * @param operation 事务操作\r\n   * @param cause 原始错误\r\n   * @returns 事务错误实例\r\n   */\r\n  static constraintViolation(\r\n    transactionId: string,\r\n    constraint: string,\r\n    operation: TransactionOperation,\r\n    cause: Error,\r\n  ): TransactionError {\r\n    return new TransactionError(\r\n      TransactionErrorType.CONSTRAINT_VIOLATION,\r\n      `Constraint violation ${constraint} in transaction ${transactionId} during operation ${operation.type} on ${operation.target}`,\r\n      {\r\n        transactionId,\r\n        operation,\r\n        context: { constraint },\r\n        cause,\r\n      },\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * 事务错误处理器\r\n */\r\nexport class TransactionErrorHandler {\r\n  private readonly MAX_ERROR_LOGS = 500;\r\n  private readonly errorLogs: ErrorLogEntry[] = [];\r\n\r\n  /**\r\n   * 创建事务错误处理器实例\r\n   * @param logger 日志记录器\r\n   */\r\n  constructor(\r\n    private readonly logger: Logger,\r\n    private readonly dataSource?: DataSource,\r\n  ) {}\r\n\r\n  /**\r\n   * 处理事务错误\r\n   * @param error 原始错误\r\n   * @param context 错误上下文\r\n   * @param context.transactionId 事务ID\r\n   * @param context.operation 事务操作\r\n   * @param context.additionalContext 额外上下文\r\n   * @returns 处理后的事务错误\r\n   */\r\n  handleError(\r\n    error: Error,\r\n    context?: {\r\n      transactionId?: string;\r\n      operation?: TransactionOperation;\r\n      additionalContext?: Record<string, unknown>;\r\n    },\r\n  ): TransactionError {\r\n    let transactionError: TransactionError;\r\n\r\n    if (error instanceof TransactionError) {\r\n      transactionError = error;\r\n    } else {\r\n      // 根据错误类型创建适当的事务错误\r\n      transactionError = this.classifyError(error, context);\r\n    }\r\n\r\n    // 记录错误\r\n    this.logTransactionError(transactionError);\r\n\r\n    return transactionError;\r\n  }\r\n\r\n  /**\r\n   * 处理错误并返回AppError\r\n   * @param error 原始错误\r\n   * @param context 错误上下文\r\n   * @returns AppError实例\r\n   */\r\n  handleToAppError(\r\n    error: Error,\r\n    context?: {\r\n      transactionId?: string;\r\n      operation?: TransactionOperation;\r\n      additionalContext?: Record<string, unknown>;\r\n    },\r\n  ): AppError {\r\n    const errorContext: ErrorContext = {\r\n      operation: context?.operation?.type,\r\n      transactionId: context?.transactionId,\r\n      resourceId: context?.operation?.targetId,\r\n      ...context?.additionalContext,\r\n    };\r\n\r\n    if (error instanceof TransactionError) {\r\n      return ErrorFactory.fromTransactionError(error, errorContext);\r\n    }\r\n\r\n    return ErrorFactory.fromError(error, errorContext);\r\n  }\r\n\r\n  /**\r\n   * 记录错误信息，便于在测试环境中校验日志和统计\r\n   * @param error 原始错误\r\n   * @param context 附加上下文信息\r\n   */\r\n  async logError(\r\n    error: Error,\r\n    context?: Record<string, unknown>,\r\n  ): Promise<void> {\r\n    const entry = this.createLogEntry(error, context);\r\n    this.recordErrorLog(entry);\r\n\r\n    this.logger.error('Error logged', {\r\n      message: error.message,\r\n      type: entry.type,\r\n      context: entry.context,\r\n      stack: error.stack,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 分类错误并创建适当的事务错误\r\n   * @param error 原始错误\r\n   * @param context 错误上下文\r\n   * @param context.transactionId 事务ID\r\n   * @param context.operation 事务操作\r\n   * @param context.additionalContext 额外上下文\r\n   * @returns 分类后的事务错误\r\n   */\r\n  private classifyError(\r\n    error: Error,\r\n    context?: {\r\n      transactionId?: string;\r\n      operation?: TransactionOperation;\r\n      additionalContext?: Record<string, unknown>;\r\n    },\r\n  ): TransactionError {\r\n    const errorMessage = error.message.toLowerCase();\r\n    const transactionId = context?.transactionId || 'unknown';\r\n    const operation = context?.operation;\r\n\r\n    // 检查数据库连接错误\r\n    if (\r\n      errorMessage.includes('connection') ||\r\n      errorMessage.includes('connect')\r\n    ) {\r\n      return TransactionError.databaseConnectionError(transactionId, error);\r\n    }\r\n\r\n    // 检查超时错误\r\n    if (\r\n      errorMessage.includes('timeout') ||\r\n      errorMessage.includes('timed out')\r\n    ) {\r\n      return TransactionError.timeoutError(\r\n        transactionId,\r\n        30000,\r\n        operation?.type,\r\n      );\r\n    }\r\n\r\n    // 检查约束违反错误\r\n    if (\r\n      errorMessage.includes('constraint') ||\r\n      errorMessage.includes('unique') ||\r\n      errorMessage.includes('foreign key')\r\n    ) {\r\n      const constraint = this.extractConstraintName(errorMessage);\r\n      if (operation) {\r\n        return TransactionError.constraintViolation(\r\n          transactionId,\r\n          constraint,\r\n          operation,\r\n          error,\r\n        );\r\n      }\r\n    }\r\n\r\n    // 检查保存点错误\r\n    if (errorMessage.includes('savepoint')) {\r\n      const savepointOperation = errorMessage.includes('create')\r\n        ? 'create'\r\n        : errorMessage.includes('rollback')\r\n          ? 'rollback'\r\n          : 'release';\r\n      return TransactionError.savepointError(\r\n        transactionId,\r\n        'unknown',\r\n        savepointOperation,\r\n        error,\r\n      );\r\n    }\r\n\r\n    // 默认为操作执行失败\r\n    if (operation) {\r\n      return TransactionError.operationExecutionFailed(\r\n        transactionId,\r\n        operation,\r\n        error,\r\n      );\r\n    }\r\n\r\n    // 通用事务错误\r\n    return new TransactionError(\r\n      TransactionErrorType.OPERATION_EXECUTION_FAILED,\r\n      `Transaction error: ${error.message}`,\r\n      { transactionId, cause: error, context: context?.additionalContext },\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 从错误消息中提取约束名称\r\n   * @param errorMessage 错误消息\r\n   * @returns 约束名称\r\n   */\r\n  private extractConstraintName(errorMessage: string): string {\r\n    const constraintMatch = errorMessage.match(\r\n      /constraint[\"']?([^\"'\\s]+)[\"']?/i,\r\n    );\r\n    return constraintMatch ? constraintMatch[1] : 'unknown';\r\n  }\r\n\r\n  /**\r\n   * 记录错误\r\n   * @param error 事务错误\r\n   */\r\n  private logTransactionError(error: TransactionError): void {\r\n    const context: Record<string, unknown> = {\r\n      ...(error.context ?? {}),\r\n    };\r\n\r\n    if (error.transactionId) {\r\n      context.transactionId = error.transactionId;\r\n    }\r\n\r\n    if (error.operation) {\r\n      context.operation = {\r\n        type: error.operation.type,\r\n        target: error.operation.target,\r\n        targetId: error.operation.targetId,\r\n      };\r\n    }\r\n\r\n    if (error.cause) {\r\n      context.cause = error.cause.message;\r\n    }\r\n\r\n    this.recordErrorLog({\r\n      message: error.message,\r\n      context,\r\n      timestamp: new Date(),\r\n      stack: error.stack,\r\n      type: error.type,\r\n    });\r\n\r\n    // 确保error有getDetails方法\r\n    const errorDetails = error.getDetails\r\n      ? error.getDetails()\r\n      : {\r\n          type: error.type || 'UNKNOWN',\r\n          message: error.message,\r\n          transactionId: error.transactionId,\r\n          operation: error.operation\r\n            ? {\r\n                type: error.operation.type,\r\n                target: error.operation.target,\r\n                targetId: error.operation.targetId,\r\n              }\r\n            : undefined,\r\n          context: error.context,\r\n          cause: error.cause\r\n            ? {\r\n                message: error.cause.message,\r\n                stack: error.cause.stack,\r\n              }\r\n            : undefined,\r\n          stack: error.stack,\r\n        };\r\n\r\n    switch (error.type) {\r\n      case TransactionErrorType.TRANSACTION_NOT_FOUND:\r\n      case TransactionErrorType.QUERY_RUNNER_NOT_FOUND:\r\n      case TransactionErrorType.INVALID_TRANSACTION_STATE:\r\n        this.logger.warn('Transaction state error', errorDetails);\r\n        break;\r\n\r\n      case TransactionErrorType.OPERATION_EXECUTION_FAILED:\r\n      case TransactionErrorType.SAVEPOINT_ERROR:\r\n      case TransactionErrorType.NESTED_TRANSACTION_ERROR:\r\n        this.logger.error('Transaction operation error', errorDetails);\r\n        break;\r\n\r\n      case TransactionErrorType.COMMIT_FAILED:\r\n      case TransactionErrorType.ROLLBACK_FAILED:\r\n        this.logger.error('Transaction lifecycle error', errorDetails);\r\n        break;\r\n\r\n      case TransactionErrorType.DATABASE_CONNECTION_ERROR:\r\n      case TransactionErrorType.TIMEOUT_ERROR:\r\n      case TransactionErrorType.CONSTRAINT_VIOLATION:\r\n        this.logger.error('Transaction system error', errorDetails);\r\n        break;\r\n\r\n      default:\r\n        this.logger.error('Unknown transaction error', errorDetails);\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 执行带重试的操作\r\n   * @param operation 要执行的操作\r\n   * @param options 重试选项\r\n   * @returns 操作结果\r\n   */\r\n  async executeWithRetry<T>(\r\n    operation: () => Promise<T>,\r\n    options: {\r\n      maxRetries: number;\r\n      retryDelay: number;\r\n    },\r\n  ): Promise<T> {\r\n    let lastError: Error;\r\n    \r\n    for (let attempt = 0; attempt <= options.maxRetries; attempt++) {\r\n      try {\r\n        return await operation();\r\n      } catch (error) {\r\n        lastError = error instanceof Error ? error : new Error(String(error));\r\n        \r\n        if (attempt === options.maxRetries) {\r\n          throw lastError;\r\n        }\r\n        \r\n        this.logger.warn(`Operation failed, retrying (${attempt + 1}/${options.maxRetries})`, {\r\n          error: lastError.message,\r\n          attempt: attempt + 1,\r\n        });\r\n        \r\n        // 等待后重试\r\n        await new Promise(resolve => setTimeout(resolve, options.retryDelay));\r\n      }\r\n    }\r\n    \r\n    throw lastError!;\r\n  }\r\n\r\n  /**\r\n   * 执行带事务恢复的操作\r\n   * @param operation 要执行的操作\r\n   * @param options 重试选项\r\n   * @returns 操作结果\r\n   */\r\n  async executeWithTransactionRecovery<T>(\r\n    operation: () => Promise<T>,\r\n    options: {\r\n      maxRetries: number;\r\n      retryDelay: number;\r\n    },\r\n  ): Promise<T> {\r\n    return this.executeWithRetry(operation, options);\r\n  }\r\n\r\n  /**\r\n   * 执行批量操作并支持恢复\r\n   * @param operations 操作数组\r\n   * @param options 批量操作选项\r\n   * @returns 批量操作结果\r\n   */\r\n  async executeBatchWithRecovery<T>(\r\n    operations: Array<() => Promise<T>>,\r\n    options: {\r\n      continueOnError: boolean;\r\n      maxFailures: number;\r\n    },\r\n  ): Promise<{\r\n    successful: number;\r\n    failed: number;\r\n    total: number;\r\n    results: Array<T | Error>;\r\n  }> {\r\n    const results: Array<T | Error> = [];\r\n    let successful = 0;\r\n    let failed = 0;\r\n\r\n    for (const operation of operations) {\r\n      try {\r\n        const result = await operation();\r\n        results.push(result);\r\n        successful++;\r\n      } catch (error) {\r\n        results.push(error instanceof Error ? error : new Error(String(error)));\r\n        failed++;\r\n        \r\n        if (!options.continueOnError || failed > options.maxFailures) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      successful,\r\n      failed,\r\n      total: operations.length,\r\n      results,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 创建断路器\r\n   * @param options 断路器选项\r\n   * @returns 断路器实例\r\n   */\r\n  createCircuitBreaker(options: {\r\n    failureThreshold: number;\r\n    timeout: number;\r\n  }): {\r\n    execute: <T>(operation: () => Promise<T>) => Promise<T>;\r\n    isOpen: () => boolean;\r\n  } {\r\n    let failureCount = 0;\r\n    let lastFailureTime = 0;\r\n    let state: 'CLOSED' | 'OPEN' | 'HALF_OPEN' = 'CLOSED';\r\n\r\n    return {\r\n      async execute<T>(operation: () => Promise<T>): Promise<T> {\r\n        if (state === 'OPEN') {\r\n          if (Date.now() - lastFailureTime > options.timeout) {\r\n            state = 'HALF_OPEN';\r\n          } else {\r\n            throw new Error('Circuit breaker is open');\r\n          }\r\n        }\r\n\r\n        try {\r\n          const result = await operation();\r\n          \r\n          if (state === 'HALF_OPEN') {\r\n            state = 'CLOSED';\r\n            failureCount = 0;\r\n          }\r\n          \r\n          return result;\r\n        } catch (error) {\r\n          failureCount++;\r\n          lastFailureTime = Date.now();\r\n          \r\n          if (failureCount >= options.failureThreshold) {\r\n            state = 'OPEN';\r\n          }\r\n          \r\n          throw error;\r\n        }\r\n      },\r\n      \r\n      isOpen: () => state === 'OPEN',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 执行带降级的操作\r\n   * @param primaryOperation 主要操作\r\n   * @param fallbackOperation 降级操作\r\n   * @returns 操作结果\r\n   */\r\n  async executeWithFallback<T>(\r\n    primaryOperation: () => Promise<T>,\r\n    fallbackOperation: () => Promise<T>,\r\n  ): Promise<T> {\r\n    try {\r\n      return await primaryOperation();\r\n    } catch (primaryError) {\r\n      this.logger.warn('Primary operation failed, trying fallback', {\r\n        error: primaryError instanceof Error ? primaryError.message : String(primaryError),\r\n      });\r\n      \r\n      try {\r\n        return await fallbackOperation();\r\n      } catch (fallbackError) {\r\n        this.logger.error('Both primary and fallback operations failed', {\r\n          primaryError: primaryError instanceof Error ? primaryError.message : String(primaryError),\r\n          fallbackError: fallbackError instanceof Error ? fallbackError.message : String(fallbackError),\r\n        });\r\n        \r\n        throw fallbackError;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 记录错误日志（用于测试）\r\n   * @param error 错误对象\r\n   * @param context 错误上下文\r\n   */\r\n  async logErrorForTest(\r\n    error: Error,\r\n    context?: Record<string, unknown>,\r\n  ): Promise<void> {\r\n    await this.logError(error, context);\r\n  }\r\n\r\n  /**\r\n   * 获取错误日志\r\n   * @param options 查询选项\r\n   * @returns 错误日志数组\r\n   */\r\n  async getErrorLogs(options: {\r\n    startTime: Date;\r\n    endTime: Date;\r\n  }): Promise<Array<{\r\n    message: string;\r\n    context: Record<string, unknown>;\r\n    timestamp: Date;\r\n  }>> {\r\n    const entries = this.filterLogsByRange(options.startTime, options.endTime);\r\n\r\n    return entries.map((entry) => ({\r\n      message: entry.message,\r\n      context: { ...entry.context },\r\n      timestamp: entry.timestamp,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * 生成错误报告\r\n   * @param options 报告选项\r\n   * @returns 错误报告\r\n   */\r\n  async generateErrorReport(options: {\r\n    startTime: Date;\r\n    endTime: Date;\r\n  }): Promise<{\r\n    totalErrors: number;\r\n    errorTypes: Record<string, number>;\r\n    timeRange: {\r\n      start: Date;\r\n      end: Date;\r\n    };\r\n  }> {\r\n    const entries = this.filterLogsByRange(options.startTime, options.endTime);\r\n    const errorTypes: Record<string, number> = {};\r\n\r\n    for (const entry of entries) {\r\n      errorTypes[entry.type] = (errorTypes[entry.type] ?? 0) + 1;\r\n    }\r\n\r\n    return {\r\n      totalErrors: entries.length,\r\n      errorTypes,\r\n      timeRange: {\r\n        start: options.startTime,\r\n        end: options.endTime,\r\n      },\r\n    };\r\n  }\r\n\r\n  async calculateErrorRate(options: {\r\n    timeWindow: number;\r\n  }): Promise<number> {\r\n    if (!this.dataSource || options.timeWindow <= 0) {\r\n      return 0;\r\n    }\r\n\r\n    try {\r\n      const repository = this.dataSource.getRepository(SystemMetrics);\r\n      const endTime = Date.now();\r\n      const startTime = endTime - options.timeWindow;\r\n\r\n      const metrics = await repository\r\n        .createQueryBuilder('metric')\r\n        .where('metric.metric_name = :metricName', {\r\n          metricName: 'operations_total',\r\n        })\r\n        .andWhere('metric.timestamp BETWEEN :start AND :end', {\r\n          start: startTime,\r\n          end: endTime,\r\n        })\r\n        .getMany();\r\n\r\n      let total = 0;\r\n      let errorCount = 0;\r\n\r\n      for (const metric of metrics) {\r\n        const value = metric.metric_value ?? 0;\r\n        total += value;\r\n\r\n        const tags = this.normalizeMetricTags(metric.tags);\r\n        const status = tags.status?.toLowerCase();\r\n\r\n        if (\r\n          status === 'error' ||\r\n          status === 'failed' ||\r\n          status === 'failure'\r\n        ) {\r\n          errorCount += value;\r\n        }\r\n      }\r\n\r\n      if (!total) {\r\n        return 0;\r\n      }\r\n\r\n      return errorCount / total;\r\n    } catch (error) {\r\n      this.logger.error('Failed to calculate error rate', {\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 记录事务性能指标\r\n   * @param transactionId 事务ID\r\n   * @param operation 操作名称\r\n   * @param durationMs 持续时间（毫秒）\r\n   * @param context 上下文信息\r\n   */\r\n  logPerformanceMetrics(\r\n    transactionId: string,\r\n    operation: string,\r\n    durationMs: number,\r\n    context?: Record<string, unknown>,\r\n  ): void {\r\n    const level =\r\n      durationMs > 5000 ? 'warn' : durationMs > 1000 ? 'info' : 'debug';\r\n\r\n    this.logger[level]('Transaction performance metric', {\r\n      transactionId,\r\n      operation,\r\n      durationMs,\r\n      ...context,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 记录事务状态变更\r\n   * @param transactionId 事务ID\r\n   * @param fromState 起始状态\r\n   * @param toState 目标状态\r\n   * @param context 上下文信息\r\n   */\r\n  logStateTransition(\r\n    transactionId: string,\r\n    fromState: TransactionStatus,\r\n    toState: TransactionStatus,\r\n    context?: Record<string, unknown>,\r\n  ): void {\r\n    this.logger.debug('Transaction state transition', {\r\n      transactionId,\r\n      fromState,\r\n      toState,\r\n      ...context,\r\n    });\r\n  }\r\n\r\n  private createLogEntry(\r\n    error: Error,\r\n    context?: Record<string, unknown>,\r\n  ): ErrorLogEntry {\r\n    return {\r\n      message: error.message,\r\n      context: { ...(context ?? {}) },\r\n      timestamp: new Date(),\r\n      stack: error.stack,\r\n      type:\r\n        error instanceof TransactionError\r\n          ? error.type\r\n          : error.name || 'Error',\r\n    };\r\n  }\r\n\r\n  private recordErrorLog(entry: ErrorLogEntry): void {\r\n    const clonedEntry: ErrorLogEntry = {\r\n      message: entry.message,\r\n      context: { ...entry.context },\r\n      timestamp: new Date(entry.timestamp),\r\n      stack: entry.stack,\r\n      type: entry.type,\r\n    };\r\n\r\n    this.errorLogs.push(clonedEntry);\r\n    if (this.errorLogs.length > this.MAX_ERROR_LOGS) {\r\n      this.errorLogs.shift();\r\n    }\r\n  }\r\n\r\n  private filterLogsByRange(\r\n    startTime: Date,\r\n    endTime: Date,\r\n  ): ErrorLogEntry[] {\r\n    const start = Math.min(startTime.getTime(), endTime.getTime());\r\n    const end = Math.max(startTime.getTime(), endTime.getTime());\r\n\r\n    return this.errorLogs.filter((entry) => {\r\n      const timestamp = entry.timestamp.getTime();\r\n      return timestamp >= start && timestamp <= end;\r\n    });\r\n  }\r\n\r\n  private normalizeMetricTags(\r\n    tags?: string | Record<string, unknown> | null,\r\n  ): Record<string, string> {\r\n    if (!tags) {\r\n      return {};\r\n    }\r\n\r\n    if (typeof tags === 'string') {\r\n      try {\r\n        const parsed = JSON.parse(tags);\r\n        if (parsed && typeof parsed === 'object') {\r\n          return this.normalizeMetricTags(parsed as Record<string, unknown>);\r\n        }\r\n      } catch {\r\n        return {};\r\n      }\r\n      return {};\r\n    }\r\n\r\n    const normalized: Record<string, string> = {};\r\n    for (const [key, value] of Object.entries(tags)) {\r\n      if (value === undefined || value === null) {\r\n        continue;\r\n      }\r\n      normalized[key] = String(value);\r\n    }\r\n\r\n    return normalized;\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\transactions\\TransactionManager.ts","messages":[{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":15,"column":1,"nodeType":"TSTypeAliasDeclaration","messageId":"missingJsDoc","endLine":16,"endColumn":1,"fix":{"range":[522,522],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":19,"column":1,"nodeType":"VariableDeclaration","messageId":"missingJsDoc","endLine":20,"endColumn":1,"fix":{"range":[611,611],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":21,"column":1,"nodeType":"ExportNamedDeclaration","messageId":"missingJsDoc","endLine":22,"endColumn":1,"fix":{"range":[665,665],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":21,"column":8,"nodeType":"ClassDeclaration","messageId":"missingJsDoc","endLine":22,"endColumn":1,"fix":{"range":[665,665],"text":"/**\n *\n */\n"}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":27,"column":14,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":28,"endColumn":1,"fix":{"range":[838,838],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":33,"column":25,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":34,"endColumn":1,"fix":{"range":[998,998],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":51,"column":31,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":52,"endColumn":1,"fix":{"range":[1630,1630],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":77,"column":15,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":78,"endColumn":1,"fix":{"range":[2450,2450],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":91,"column":17,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":92,"endColumn":1,"fix":{"range":[3023,3023],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":104,"column":25,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":105,"endColumn":1,"fix":{"range":[3525,3525],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":128,"column":29,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":129,"endColumn":1,"fix":{"range":[4215,4215],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":154,"column":35,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":155,"endColumn":1,"fix":{"range":[5060,5060],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":181,"column":23,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":182,"endColumn":1,"fix":{"range":[5972,5972],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":185,"column":24,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":186,"endColumn":1,"fix":{"range":[6116,6116],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":189,"column":18,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":190,"endColumn":1,"fix":{"range":[6232,6232],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":214,"column":28,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":215,"endColumn":1,"fix":{"range":[6943,6943],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":226,"column":25,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":227,"endColumn":1,"fix":{"range":[7326,7326],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":234,"column":27,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":235,"endColumn":1,"fix":{"range":[7546,7546],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":239,"column":22,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":240,"endColumn":1,"fix":{"range":[7737,7737],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":244,"column":23,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":245,"endColumn":1,"fix":{"range":[7906,7906],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":256,"column":31,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":257,"endColumn":1,"fix":{"range":[8282,8282],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":278,"column":38,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":279,"endColumn":1,"fix":{"range":[8993,8993],"text":"/**\n   *\n   */\n  "}},{"ruleId":"jsdoc/require-jsdoc","severity":2,"message":"Missing JSDoc comment.","line":316,"column":33,"nodeType":"FunctionExpression","messageId":"missingJsDoc","endLine":317,"endColumn":1,"fix":{"range":[10365,10365],"text":"/**\n   *\n   */\n  "}}],"suppressedMessages":[],"errorCount":23,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":23,"fixableWarningCount":0,"source":"import { randomUUID } from 'crypto';\r\nimport { CollectionId, DocId } from '@domain/entities/types.js';\r\nimport {\r\n  ITransactionManager,\r\n  Savepoint,\r\n  TransactionContext,\r\n  TransactionOperation,\r\n  TransactionOperationType,\r\n  TransactionStatus,\r\n} from '@domain/repositories/ITransactionManager.js';\r\nimport { SQLiteRepoCore } from '@infrastructure/repositories/SQLiteRepositoryCore.js';\r\nimport { QdrantRepo } from '@infrastructure/repositories/QdrantRepository.js';\r\nimport { Logger } from '@logging/logger.js';\r\n\r\ntype InternalTransactionContext = TransactionContext & {\r\n  completedAt?: number;\r\n};\r\n\r\nconst DEFAULT_CLEANUP_MAX_AGE_MS = 30 * 60 * 1000;\r\n\r\nexport class TransactionManager implements ITransactionManager {\r\n  private readonly activeTransactions = new Map<\r\n    string,\r\n    InternalTransactionContext\r\n  >();\r\n\r\n  constructor(\r\n    private readonly sqliteCore: SQLiteRepoCore,\r\n    private readonly qdrantRepo: QdrantRepo,\r\n    private readonly logger: Logger,\r\n  ) {}\r\n\r\n  async beginTransaction(metadata?: Record<string, unknown>): Promise<TransactionContext> {\r\n    const transactionId = randomUUID();\r\n    const context: InternalTransactionContext = {\r\n      transactionId,\r\n      status: TransactionStatus.PENDING,\r\n      operations: [],\r\n      startTime: Date.now(),\r\n      metadata,\r\n      parentTransactionId: undefined,\r\n      savepoints: new Map<string, Savepoint>(),\r\n      nestingLevel: 0,\r\n      isRootTransaction: true,\r\n    };\r\n    this.activeTransactions.set(transactionId, context);\r\n    this.logger.info('Transaction started', { transactionId, metadata });\r\n    return context;\r\n  }\r\n\r\n  async beginNestedTransaction(\r\n    parentTransactionId: string,\r\n    metadata?: Record<string, unknown>,\r\n  ): Promise<TransactionContext> {\r\n    const parent = this.getExistingTransaction(parentTransactionId);\r\n    const transactionId = randomUUID();\r\n    const context: InternalTransactionContext = {\r\n      transactionId,\r\n      status: TransactionStatus.PENDING,\r\n      operations: [],\r\n      startTime: Date.now(),\r\n      metadata,\r\n      parentTransactionId,\r\n      savepoints: new Map<string, Savepoint>(),\r\n      nestingLevel: parent.nestingLevel + 1,\r\n      isRootTransaction: false,\r\n    };\r\n    this.activeTransactions.set(transactionId, context);\r\n    this.logger.info('Nested transaction started', {\r\n      transactionId,\r\n      parentTransactionId,\r\n      metadata,\r\n    });\r\n    return context;\r\n  }\r\n\r\n  async commit(transactionId: string): Promise<void> {\r\n    const context = this.getExistingTransaction(transactionId);\r\n    if (context.status !== TransactionStatus.ACTIVE) {\r\n      throw new Error(`Transaction ${transactionId} is not active`);\r\n    }\r\n\r\n    this.logger.info('Committing SQLite transaction', { transactionId });\r\n    await this.sqliteCore.transaction(async () => undefined);\r\n\r\n    context.status = TransactionStatus.COMMITTED;\r\n    context.completedAt = Date.now();\r\n    this.logger.info('Transaction committed successfully', { transactionId });\r\n  }\r\n\r\n  async rollback(transactionId: string): Promise<void> {\r\n    const context = this.getExistingTransaction(transactionId);\r\n    if (context.status !== TransactionStatus.ACTIVE) {\r\n      throw new Error(`Transaction ${transactionId} is not active`);\r\n    }\r\n\r\n    context.status = TransactionStatus.ROLLED_BACK;\r\n    context.completedAt = Date.now();\r\n    context.operations = [];\r\n    context.savepoints.clear();\r\n    this.logger.info('Transaction rolled back successfully', { transactionId });\r\n  }\r\n\r\n  async executeOperation(\r\n    transactionId: string,\r\n    operation: TransactionOperation,\r\n  ): Promise<void> {\r\n    const context = this.getExistingTransaction(transactionId);\r\n    if (\r\n      context.status !== TransactionStatus.PENDING &&\r\n      context.status !== TransactionStatus.ACTIVE\r\n    ) {\r\n      throw new Error(\r\n        `Transaction ${transactionId} is not in a valid state for operations`,\r\n      );\r\n    }\r\n\r\n    if (context.status === TransactionStatus.PENDING) {\r\n      context.status = TransactionStatus.ACTIVE;\r\n    }\r\n\r\n    context.operations.push({\r\n      ...operation,\r\n      timestamp: Date.now(),\r\n    } as TransactionOperation & { timestamp: number });\r\n  }\r\n\r\n  async executeInTransaction<T>(\r\n    fn: (context: TransactionContext) => Promise<T>,\r\n    metadata?: Record<string, unknown>,\r\n  ): Promise<T> {\r\n    const context = await this.beginTransaction(metadata);\r\n    try {\r\n      const result = await fn(context);\r\n      if (context.status === TransactionStatus.PENDING) {\r\n        context.status = TransactionStatus.ACTIVE;\r\n      }\r\n      await this.commit(context.transactionId);\r\n      return result;\r\n    } catch (error) {\r\n      try {\r\n        await this.rollback(context.transactionId);\r\n      } catch (rollbackError) {\r\n        this.logger.error('Failed to rollback transaction', {\r\n          transactionId: context.transactionId,\r\n          error: (rollbackError as Error).message,\r\n          originalError: (error as Error).message,\r\n        });\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async executeInNestedTransaction<T>(\r\n    parentTransactionId: string,\r\n    fn: (context: TransactionContext) => Promise<T>,\r\n    metadata?: Record<string, unknown>,\r\n  ): Promise<T> {\r\n    const context = await this.beginNestedTransaction(parentTransactionId, metadata);\r\n    try {\r\n      const result = await fn(context);\r\n      if (context.status === TransactionStatus.PENDING) {\r\n        context.status = TransactionStatus.ACTIVE;\r\n      }\r\n      await this.commit(context.transactionId);\r\n      return result;\r\n    } catch (error) {\r\n      try {\r\n        await this.rollback(context.transactionId);\r\n      } catch (rollbackError) {\r\n        this.logger.error('Failed to rollback transaction', {\r\n          transactionId: context.transactionId,\r\n          error: (rollbackError as Error).message,\r\n          originalError: (error as Error).message,\r\n        });\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  getTransactionStatus(transactionId: string): TransactionContext | undefined {\r\n    return this.activeTransactions.get(transactionId);\r\n  }\r\n\r\n  getActiveTransactions(): TransactionContext[] {\r\n    return Array.from(this.activeTransactions.values());\r\n  }\r\n\r\n  createSavepoint(\r\n    transactionId: string,\r\n    name: string,\r\n    metadata?: Record<string, unknown>,\r\n  ): Promise<string> {\r\n    const context = this.getExistingTransaction(transactionId);\r\n    if (context.status !== TransactionStatus.ACTIVE) {\r\n      throw new Error(\r\n        `Transaction ${transactionId} is not in a valid state for savepoints`,\r\n      );\r\n    }\r\n\r\n    const savepointId = randomUUID();\r\n    const savepoint: Savepoint = {\r\n      id: savepointId,\r\n      name,\r\n      transactionId,\r\n      createdAt: Date.now(),\r\n      operations: [...context.operations],\r\n      metadata,\r\n    };\r\n    context.savepoints.set(savepointId, savepoint);\r\n    return Promise.resolve(savepointId);\r\n  }\r\n\r\n  async rollbackToSavepoint(\r\n    transactionId: string,\r\n    savepointId: string,\r\n  ): Promise<void> {\r\n    const context = this.getExistingTransaction(transactionId);\r\n    const savepoint = context.savepoints.get(savepointId);\r\n    if (!savepoint) {\r\n      throw new Error(`Savepoint ${savepointId} not found`);\r\n    }\r\n    context.operations = [...savepoint.operations];\r\n  }\r\n\r\n  async releaseSavepoint(\r\n    transactionId: string,\r\n    savepointId: string,\r\n  ): Promise<void> {\r\n    const context = this.getExistingTransaction(transactionId);\r\n    context.savepoints.delete(savepointId);\r\n  }\r\n\r\n  getTransactionSavepoints(transactionId: string): Savepoint[] {\r\n    const context = this.getExistingTransaction(transactionId);\r\n    return Array.from(context.savepoints.values());\r\n  }\r\n\r\n  isNestedTransaction(transactionId: string): boolean {\r\n    const context = this.getExistingTransaction(transactionId);\r\n    return !context.isRootTransaction;\r\n  }\r\n\r\n  getRootTransactionId(transactionId: string): string | undefined {\r\n    let current = this.getExistingTransaction(transactionId);\r\n    while (current.parentTransactionId) {\r\n      const parent = this.activeTransactions.get(current.parentTransactionId);\r\n      if (!parent) {\r\n        break;\r\n      }\r\n      current = parent;\r\n    }\r\n    return current.transactionId;\r\n  }\r\n\r\n  cleanupCompletedTransactions(\r\n    maxAge: number = DEFAULT_CLEANUP_MAX_AGE_MS,\r\n  ): void {\r\n    const now = Date.now();\r\n    let removed = 0;\r\n\r\n    for (const [transactionId, context] of this.activeTransactions.entries()) {\r\n      const isCompleted =\r\n        context.status === TransactionStatus.COMMITTED ||\r\n        context.status === TransactionStatus.ROLLED_BACK ||\r\n        context.status === TransactionStatus.FAILED;\r\n      if (isCompleted && context.startTime + maxAge <= now) {\r\n        this.activeTransactions.delete(transactionId);\r\n        removed += 1;\r\n      }\r\n    }\r\n\r\n    if (removed > 0) {\r\n      this.logger.info('Cleaned up completed transactions', { count: removed });\r\n    }\r\n  }\r\n\r\n  async deleteCollectionInTransaction(\r\n    collectionId: CollectionId,\r\n    collectionsRepo: {\r\n      getById: (id: CollectionId) => { collectionId: CollectionId } | undefined;\r\n      delete: (id: CollectionId) => void;\r\n      chunkMeta: { deleteByCollectionId: (id: CollectionId) => void };\r\n      chunksFts5: { deleteByCollectionId: (id: CollectionId) => void };\r\n      docs: {\r\n        listByCollection: (id: CollectionId) => Array<{ docId: DocId }>;\r\n        hardDelete: (id: DocId) => void;\r\n      };\r\n      listAll: () => unknown;\r\n    },\r\n  ): Promise<void> {\r\n    const collection = collectionsRepo.getById(collectionId);\r\n    if (!collection) {\r\n      this.logger.warn('deleteCollection: no such collectionId', collectionId);\r\n      return;\r\n    }\r\n\r\n    await this.executeInTransaction(async () => {\r\n      collectionsRepo.chunkMeta.deleteByCollectionId(collectionId);\r\n      collectionsRepo.chunksFts5.deleteByCollectionId(collectionId);\r\n\r\n      const docs = collectionsRepo.docs.listByCollection(collectionId) ?? [];\r\n      for (const doc of docs) {\r\n        collectionsRepo.docs.hardDelete(doc.docId);\r\n      }\r\n\r\n      collectionsRepo.delete(collectionId);\r\n      await this.qdrantRepo.deletePointsByCollection(collectionId);\r\n    });\r\n\r\n    this.logger.info(\r\n      `Collection ${collectionId} and its associated data have been deleted.`,\r\n    );\r\n  }\r\n\r\n  private getExistingTransaction(\r\n    transactionId: string,\r\n  ): InternalTransactionContext {\r\n    const context = this.activeTransactions.get(transactionId);\r\n    if (!context) {\r\n      throw new Error(`Transaction ${transactionId} not found`);\r\n    }\r\n    return context;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\transactions\\TransactionManagerFactory.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\infrastructure\\transactions\\TypeORMTransactionManager.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":938,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":938,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27343,27346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27343,27346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":940,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":940,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27440,27443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27440,27443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":996,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":996,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29012,29015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29012,29015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":998,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":998,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29109,29112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29109,29112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DataSource, QueryRunner, TransactionNotStartedError } from 'typeorm';\nimport { Logger } from '@logging/logger.js';\r\nimport {\r\n  ITransactionManager,\r\n  TransactionOperation,\r\n  TransactionOperationType,\r\n  TransactionStatus,\r\n  Savepoint,\r\n} from '@domain/repositories/ITransactionManager.js';\r\nimport { TransactionContext } from '@infrastructure/transactions/TransactionContext.js';\r\nimport { IQdrantRepo } from '@domain/repositories/IQdrantRepo.js';\r\nimport { CollectionId, DocId, PointId } from '@domain/entities/types.js';\r\nimport {\r\n  TransactionErrorHandler,\r\n  TransactionError,\r\n  TransactionErrorType,\r\n} from '@infrastructure/transactions/TransactionErrorHandler.js';\r\n\r\n/**\r\n * TypeORM事务管理器实现\r\n * 利用TypeORM的QueryRunner机制，实现统一事务管理器，确保关键业务流程的原子性，并支持嵌套事务\r\n */\r\nexport class TypeORMTransactionManager implements ITransactionManager {\r\n  private activeTransactions: Map<string, TransactionContext> = new Map();\r\n  private queryRunners: Map<string, QueryRunner> = new Map();\r\n  private readonly DEFAULT_CLEANUP_AGE = 30 * 60 * 1000; // 30分钟\r\n  private readonly errorHandler: TransactionErrorHandler;\r\n\r\n  /**\r\n   * 创建TypeORM事务管理器实例\r\n   *\r\n   * @param dataSource TypeORM数据源\r\n   * @param qdrantRepo Qdrant仓库\r\n   * @param logger 日志记录器\r\n   */\r\n  constructor(\r\n    private readonly dataSource: DataSource,\r\n    private readonly qdrantRepo: IQdrantRepo,\r\n    private readonly logger: Logger,\r\n  ) {\r\n    this.errorHandler = new TransactionErrorHandler(logger, dataSource);\r\n  }\r\n\r\n  /**\r\n   * 开始一个新事务\r\n   * @param metadata 事务元数据（可选）\r\n   * @returns 事务上下文\r\n   */\r\n  async beginTransaction(metadata?: Record<string, unknown>): Promise<TransactionContext> {\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      const context = new TransactionContext({\r\n        metadata,\r\n      });\r\n\r\n      // 创建QueryRunner并开始事务\r\n      const queryRunner = this.dataSource.createQueryRunner();\r\n      queryRunner.startTransaction();\r\n\r\n      this.activeTransactions.set(context.transactionId, context);\r\n      this.queryRunners.set(context.transactionId, queryRunner);\r\n\r\n      // 记录状态变更\r\n      this.errorHandler.logStateTransition(\r\n        context.transactionId,\r\n        TransactionStatus.PENDING,\r\n        TransactionStatus.ACTIVE,\r\n        { metadata, nestingLevel: context.nestingLevel },\r\n      );\r\n\r\n      this.logger.info('TypeORM transaction started', {\r\n        transactionId: context.transactionId,\r\n        metadata,\r\n        nestingLevel: context.nestingLevel,\r\n      });\r\n\r\n      // 记录性能指标\r\n      this.errorHandler.logPerformanceMetrics(\r\n        context.transactionId,\r\n        'beginTransaction',\r\n        Date.now() - startTime,\r\n        { metadata },\r\n      );\r\n\r\n      return context;\r\n    } catch (error) {\r\n      const transactionError = this.errorHandler.handleError(error as Error, {\r\n        additionalContext: { operation: 'beginTransaction', metadata },\r\n      });\r\n      throw transactionError;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 开始一个嵌套事务\r\n   * @param parentTransactionId 父事务ID\r\n   * @param metadata 事务元数据（可选）\r\n   * @returns 嵌套事务上下文\r\n   */\r\n  async beginNestedTransaction(\r\n    parentTransactionId: string,\r\n    metadata?: Record<string, unknown>,\r\n  ): Promise<TransactionContext> {\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      const parentContext = this.activeTransactions.get(parentTransactionId);\r\n      if (!parentContext) {\r\n        throw TransactionError.transactionNotFound(parentTransactionId);\r\n      }\r\n\r\n      const context = new TransactionContext({\r\n        parentTransactionId,\r\n        metadata,\r\n        nestingLevel: parentContext.nestingLevel + 1,\r\n      });\r\n\r\n      // 嵌套事务使用相同的QueryRunner，但创建保存点\r\n      const parentQueryRunner = this.queryRunners.get(parentTransactionId);\r\n      if (!parentQueryRunner) {\r\n        throw TransactionError.queryRunnerNotFound(parentTransactionId);\r\n      }\r\n\r\n      // 为嵌套事务创建保存点\r\n      const savepointName = `sp_${Date.now()}_${Math.random().toString(36).substring(2, 6)}`;\r\n      // TODO: 检查 TypeORM QueryRunner 的保存点方法名\r\n      // await parentQueryRunner.createSavepoint(savepointName);\r\n\r\n      // 在上下文中记录保存点\r\n      context.createSavepoint(savepointName, {\r\n        type: 'nested_transaction',\r\n        transactionId: context.transactionId,\r\n        parentTransactionId,\r\n      });\r\n\r\n      this.activeTransactions.set(context.transactionId, context);\r\n      this.queryRunners.set(context.transactionId, parentQueryRunner);\r\n\r\n      // 记录状态变更\r\n      this.errorHandler.logStateTransition(\r\n        context.transactionId,\r\n        TransactionStatus.PENDING,\r\n        TransactionStatus.ACTIVE,\r\n        {\r\n          parentTransactionId,\r\n          savepointName,\r\n          metadata,\r\n          nestingLevel: context.nestingLevel,\r\n        },\r\n      );\r\n\r\n      this.logger.info('TypeORM nested transaction started with savepoint', {\r\n        transactionId: context.transactionId,\r\n        parentTransactionId,\r\n        savepointName,\r\n        metadata,\r\n        nestingLevel: context.nestingLevel,\r\n      });\r\n\r\n      // 记录性能指标\r\n      this.errorHandler.logPerformanceMetrics(\r\n        context.transactionId,\r\n        'beginNestedTransaction',\r\n        Date.now() - startTime,\r\n        {\r\n          parentTransactionId,\r\n          savepointName,\r\n          metadata,\r\n        },\r\n      );\r\n\r\n      return context;\r\n    } catch (error) {\r\n      const transactionError = this.errorHandler.handleError(error as Error, {\r\n        transactionId: parentTransactionId,\r\n        additionalContext: {\r\n          operation: 'beginNestedTransaction',\r\n          parentTransactionId,\r\n          metadata,\r\n        },\r\n      });\r\n      throw transactionError;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 提交事务\r\n   * @param transactionId 事务ID\r\n   */\r\n  async commit(transactionId: string): Promise<void> {\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      const context = this.activeTransactions.get(transactionId);\r\n      if (!context) {\r\n        throw TransactionError.transactionNotFound(transactionId);\r\n      }\r\n\r\n      const isNestedPending =\r\n        !context.isRootTransaction &&\r\n        context.status === TransactionStatus.PENDING;\r\n\r\n      if (!isNestedPending && context.status !== TransactionStatus.ACTIVE) {\r\n        throw TransactionError.invalidTransactionState(\r\n          transactionId,\r\n          context.status,\r\n          TransactionStatus.ACTIVE,\r\n        );\r\n      }\r\n\r\n      const previousStatus = context.status;\r\n\r\n      const queryRunner = this.queryRunners.get(transactionId);\r\n      if (!queryRunner) {\r\n        throw TransactionError.queryRunnerNotFound(transactionId);\r\n      }\r\n\r\n      // 只有根事务才能实际提交到数据库\r\n      if (context.isRootTransaction) {\r\n        await queryRunner.commitTransaction();\r\n        this.logger.info('TypeORM transaction committed to database', {\r\n          transactionId,\r\n          operations: context.operations.length,\r\n        });\r\n      } else {\r\n        // 嵌套事务提交时，将操作合并到父事务\r\n        await this.commitNestedTransaction(transactionId);\r\n      }\r\n\r\n      // 记录状态变更\r\n      this.errorHandler.logStateTransition(\r\n        transactionId,\r\n        previousStatus,\r\n        TransactionStatus.COMMITTED,\r\n        {\r\n          isRootTransaction: context.isRootTransaction,\r\n          operationsCount: context.operations.length,\r\n        },\r\n      );\r\n\r\n      context.status = TransactionStatus.COMMITTED;\r\n      this.logger.info('Transaction committed successfully', {\r\n        transactionId,\r\n        isRootTransaction: context.isRootTransaction,\r\n        operationsCount: context.operations.length,\r\n      });\r\n\r\n      // 记录性能指标\r\n      this.errorHandler.logPerformanceMetrics(\r\n        transactionId,\r\n        'commit',\r\n        Date.now() - startTime,\r\n        {\r\n          isRootTransaction: context.isRootTransaction,\r\n          operationsCount: context.operations.length,\r\n        },\r\n      );\r\n    } catch (error) {\r\n      const transactionError = this.errorHandler.handleError(error as Error, {\r\n        transactionId,\r\n        additionalContext: { operation: 'commit' },\r\n      });\r\n\r\n      // 更新事务状态为失败\r\n      const context = this.activeTransactions.get(transactionId);\r\n      if (context) {\r\n        this.errorHandler.logStateTransition(\r\n          transactionId,\r\n          context.status,\r\n          TransactionStatus.FAILED,\r\n          { reason: 'commit_failed' },\r\n        );\r\n        context.status = TransactionStatus.FAILED;\r\n      }\r\n\r\n      throw transactionError;\r\n    } finally {\r\n      // 清理事务上下文和QueryRunner\r\n      const context = this.activeTransactions.get(transactionId);\r\n      if (context?.isRootTransaction) {\r\n        const queryRunner = this.queryRunners.get(transactionId);\r\n        if (queryRunner) {\r\n          try {\r\n            await queryRunner.release();\r\n          } catch (releaseError) {\r\n            this.logger.error('Failed to release QueryRunner', {\r\n              transactionId,\r\n              error:\r\n                releaseError instanceof Error\r\n                  ? releaseError.message\r\n                  : String(releaseError),\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      // 总是清理事务上下文和QueryRunner引用\r\n      this.activeTransactions.delete(transactionId);\r\n      this.queryRunners.delete(transactionId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 回滚事务\r\n   * @param transactionId 事务ID\r\n   */\r\n  async rollback(transactionId: string): Promise<void> {\r\n    const startTime = Date.now();\r\n\r\n    try {\r\n      const context = this.activeTransactions.get(transactionId);\r\n      if (!context) {\r\n        throw TransactionError.transactionNotFound(transactionId);\r\n      }\r\n\r\n      const queryRunner = this.queryRunners.get(transactionId);\r\n      if (!queryRunner) {\r\n        throw TransactionError.queryRunnerNotFound(transactionId);\r\n      }\r\n\r\n      // 只有根事务才能实际回滚到数据库\r\n      if (context.isRootTransaction) {\n        try {\n          await queryRunner.rollbackTransaction();\n          this.logger.info('TypeORM transaction rolled back from database', {\n            transactionId,\n          });\n        } catch (rollbackError) {\n          if (rollbackError instanceof TransactionNotStartedError) {\n            this.logger.warn(\n              'Rollback skipped because transaction was not started',\n              { transactionId },\n            );\n          } else {\n            throw rollbackError;\n          }\n        }\n      } else {\r\n        // 嵌套事务回滚时，回滚到创建嵌套事务时的保存点\r\n        const nestedSavepoints = context.getSavepoints();\r\n        const nestedTransactionSavepoint = nestedSavepoints.find(\r\n          (sp) =>\r\n            sp.metadata?.type === 'nested_transaction' &&\r\n            sp.metadata?.transactionId === transactionId,\r\n        );\r\n\r\n        if (nestedTransactionSavepoint) {\r\n          // TODO: 检查 TypeORM QueryRunner 的保存点方法名\r\n          // await queryRunner.rollbackToSavepoint(\r\n          //   nestedTransactionSavepoint.name,\r\n          // );\r\n          this.logger.info('Nested transaction rolled back to savepoint', {\r\n            transactionId,\r\n            savepointName: nestedTransactionSavepoint.name,\r\n            savepointId: nestedTransactionSavepoint.id,\r\n          });\r\n        } else {\r\n          this.logger.warn(\r\n            'No savepoint found for nested transaction rollback',\r\n            {\r\n              transactionId,\r\n              availableSavepoints: nestedSavepoints.map((sp) => ({\r\n                id: sp.id,\r\n                name: sp.name,\r\n                type: sp.metadata?.type,\r\n              })),\r\n            },\r\n          );\r\n        }\r\n      }\r\n\r\n      // 记录状态变更\r\n      this.errorHandler.logStateTransition(\r\n        transactionId,\r\n        context.status,\r\n        TransactionStatus.ROLLED_BACK,\r\n        {\r\n          isRootTransaction: context.isRootTransaction,\r\n          operationsCount: context.operations.length,\r\n        },\r\n      );\r\n\r\n      context.status = TransactionStatus.ROLLED_BACK;\r\n      this.logger.info('Transaction rolled back successfully', {\r\n        transactionId,\r\n        isNested: !context.isRootTransaction,\r\n        operationsCount: context.operations.length,\r\n      });\r\n\r\n      // 记录性能指标\r\n      this.errorHandler.logPerformanceMetrics(\r\n        transactionId,\r\n        'rollback',\r\n        Date.now() - startTime,\r\n        {\r\n          isRootTransaction: context.isRootTransaction,\r\n          operationsCount: context.operations.length,\r\n        },\r\n      );\r\n    } catch (error) {\r\n      const transactionError = this.errorHandler.handleError(error as Error, {\r\n        transactionId,\r\n        additionalContext: { operation: 'rollback' },\r\n      });\r\n\r\n      // 更新事务状态为失败\r\n      const context = this.activeTransactions.get(transactionId);\r\n      if (context) {\r\n        this.errorHandler.logStateTransition(\r\n          transactionId,\r\n          context.status,\r\n          TransactionStatus.FAILED,\r\n          { reason: 'rollback_failed' },\r\n        );\r\n        context.status = TransactionStatus.FAILED;\r\n      }\r\n\r\n      throw transactionError;\r\n    } finally {\r\n      // 清理事务上下文和QueryRunner\r\n      const context = this.activeTransactions.get(transactionId);\r\n      if (context?.isRootTransaction) {\r\n        const queryRunner = this.queryRunners.get(transactionId);\r\n        if (queryRunner) {\r\n          try {\r\n            await queryRunner.release();\r\n          } catch (releaseError) {\r\n            this.logger.error('Failed to release QueryRunner during rollback', {\r\n              transactionId,\r\n              error:\r\n                releaseError instanceof Error\r\n                  ? releaseError.message\r\n                  : String(releaseError),\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      // 总是清理事务上下文和QueryRunner引用\r\n      this.activeTransactions.delete(transactionId);\r\n      this.queryRunners.delete(transactionId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 在事务中执行操作\r\n   * @param transactionId 事务ID\r\n   * @param operation 事务操作\r\n   */\r\n  async executeOperation(\r\n    transactionId: string,\r\n    operation: TransactionOperation,\r\n  ): Promise<void> {\r\n    const context = this.activeTransactions.get(transactionId);\r\n    if (!context) {\r\n      throw new Error(`Transaction ${transactionId} not found`);\r\n    }\r\n\r\n    if (\r\n      context.status !== TransactionStatus.ACTIVE &&\r\n      context.status !== TransactionStatus.PENDING\r\n    ) {\r\n      throw new Error(\r\n        `Transaction ${transactionId} is not in a valid state for operations`,\r\n      );\r\n    }\r\n\r\n    try {\r\n      // 如果是第一个操作，将事务状态设为ACTIVE\r\n      if (context.status === TransactionStatus.PENDING) {\r\n        context.status = TransactionStatus.ACTIVE;\r\n      }\r\n\r\n      // 执行操作并保存回滚数据\r\n      if (operation.data !== undefined) {\r\n        const rollbackData = await this.executeOperationWithRollback(\r\n          operation,\r\n          transactionId,\r\n        );\r\n        operation.rollbackData = rollbackData;\r\n      }\r\n\r\n      context.addOperation(operation);\r\n\r\n      this.logger.debug('Operation executed in transaction', {\r\n        transactionId,\r\n        operationType: operation.type,\r\n        target: operation.target,\r\n        targetId: operation.targetId,\r\n      });\r\n    } catch (error) {\r\n      this.logger.error('Failed to execute operation in transaction', {\r\n        transactionId,\r\n        operation,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 在事务中执行函数\r\n   * @param fn 要执行的函数\r\n   * @param metadata 事务元数据（可选）\r\n   * @returns 函数执行结果\r\n   */\r\n  async executeInTransaction<T>(\r\n    fn: (context: TransactionContext) => Promise<T>,\r\n    metadata?: Record<string, unknown>,\r\n  ): Promise<T> {\r\n    const context = await this.beginTransaction(metadata);\r\n    if (context.status === TransactionStatus.PENDING) {\r\n      context.status = TransactionStatus.ACTIVE;\r\n    }\r\n\r\n    try {\r\n      const result = await fn(context);\r\n      await this.commit(context.transactionId);\r\n      return result;\r\n    } catch (error) {\r\n      try {\r\n        await this.rollback(context.transactionId);\r\n      } catch (rollbackError) {\r\n        this.logger.error('Failed to rollback transaction', {\r\n          transactionId: context.transactionId,\r\n          error:\r\n            rollbackError instanceof Error\r\n              ? rollbackError.message\r\n              : String(rollbackError),\r\n        });\r\n      }\r\n\r\n      throw error;\r\n    } finally {\r\n      // 清理事务上下文和QueryRunner\r\n      this.activeTransactions.delete(context.transactionId);\r\n      this.queryRunners.delete(context.transactionId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 在嵌套事务中执行函数\r\n   * @param parentTransactionId 父事务ID\r\n   * @param fn 要执行的函数\r\n   * @param metadata 事务元数据（可选）\r\n   * @returns 函数执行结果\r\n   */\r\n  async executeInNestedTransaction<T>(\r\n    parentTransactionId: string,\r\n    fn: (context: TransactionContext) => Promise<T>,\r\n    metadata?: Record<string, unknown>,\r\n  ): Promise<T> {\r\n    const context = await this.beginNestedTransaction(\r\n      parentTransactionId,\r\n      metadata,\r\n    );\r\n    if (context.status === TransactionStatus.PENDING) {\r\n      context.status = TransactionStatus.ACTIVE;\r\n    }\r\n\r\n    try {\r\n      const result = await fn(context);\r\n      // 嵌套事务提交时，将操作合并到父事务\r\n      await this.commitNestedTransaction(context.transactionId);\r\n      return result;\r\n    } catch (error) {\r\n      try {\r\n        await this.rollback(context.transactionId);\r\n      } catch (rollbackError) {\r\n        this.logger.error('Failed to rollback nested transaction', {\r\n          transactionId: context.transactionId,\r\n          error:\r\n            rollbackError instanceof Error\r\n              ? rollbackError.message\r\n              : String(rollbackError),\r\n        });\r\n      }\r\n\r\n      throw error;\r\n    } finally {\r\n      // 清理嵌套事务上下文（QueryRunner由父事务管理）\r\n      this.activeTransactions.delete(context.transactionId);\r\n      // 注意：嵌套事务不删除QueryRunner，因为它与父事务共享\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建保存点\r\n   * @param transactionId 事务ID\r\n   * @param name 保存点名称\r\n   * @param metadata 保存点元数据（可选）\r\n   * @returns 保存点ID\r\n   */\r\n  async createSavepoint(\r\n    transactionId: string,\r\n    name: string,\r\n    metadata?: Record<string, unknown>,\r\n  ): Promise<string> {\r\n    const context = this.activeTransactions.get(transactionId);\r\n    if (!context) {\r\n      throw new Error(`Transaction ${transactionId} not found`);\r\n    }\r\n\r\n    const queryRunner = this.queryRunners.get(transactionId);\r\n    if (!queryRunner) {\r\n      throw new Error(`QueryRunner for transaction ${transactionId} not found`);\r\n    }\r\n\r\n    const savepointId = context.createSavepoint(name, metadata);\r\n\r\n    // 在数据库中创建保存点\r\n    // TODO: 检查 TypeORM QueryRunner 的保存点方法名\r\n    // await queryRunner.createSavepoint(savepointId);\r\n\r\n    this.logger.info('Savepoint created', {\r\n      transactionId,\r\n      savepointId,\r\n      savepointName: name,\r\n      operationsCount: context.operations.length,\r\n    });\r\n\r\n    return savepointId;\r\n  }\r\n\r\n  /**\r\n   * 回滚到保存点\r\n   * @param transactionId 事务ID\r\n   * @param savepointId 保存点ID\r\n   */\r\n  async rollbackToSavepoint(\r\n    transactionId: string,\r\n    savepointId: string,\r\n  ): Promise<void> {\r\n    const context = this.activeTransactions.get(transactionId);\r\n    if (!context) {\r\n      throw new Error(`Transaction ${transactionId} not found`);\r\n    }\r\n\r\n    const queryRunner = this.queryRunners.get(transactionId);\r\n    if (!queryRunner) {\r\n      throw new Error(`QueryRunner for transaction ${transactionId} not found`);\r\n    }\r\n\r\n    try {\r\n      // 在数据库中回滚到保存点\r\n      // TODO: 检查 TypeORM QueryRunner 的保存点方法名\r\n      // await queryRunner.rollbackToSavepoint(savepointId);\r\n\r\n      // 在内存中回滚到保存点\r\n      context.rollbackToSavepoint(savepointId);\r\n\r\n      this.logger.info('Transaction rolled back to savepoint', {\r\n        transactionId,\r\n        savepointId,\r\n        operationsCount: context.operations.length,\r\n      });\r\n    } catch (error) {\r\n      this.logger.error('Failed to rollback to savepoint', {\r\n        transactionId,\r\n        savepointId,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 释放保存点\r\n   * @param transactionId 事务ID\r\n   * @param savepointId 保存点ID\r\n   */\r\n  async releaseSavepoint(\r\n    transactionId: string,\r\n    savepointId: string,\r\n  ): Promise<void> {\r\n    const context = this.activeTransactions.get(transactionId);\r\n    if (!context) {\r\n      throw new Error(`Transaction ${transactionId} not found`);\r\n    }\r\n\r\n    const queryRunner = this.queryRunners.get(transactionId);\r\n    if (!queryRunner) {\r\n      throw new Error(`QueryRunner for transaction ${transactionId} not found`);\r\n    }\r\n\r\n    try {\r\n      // 在数据库中释放保存点\r\n      // TODO: 检查 TypeORM QueryRunner 的保存点方法名\r\n      // await queryRunner.releaseSavepoint(savepointId);\r\n\r\n      // 在内存中释放保存点\r\n      context.releaseSavepoint(savepointId);\r\n\r\n      this.logger.info('Savepoint released', {\r\n        transactionId,\r\n        savepointId,\r\n      });\r\n    } catch (error) {\r\n      this.logger.error('Failed to release savepoint', {\r\n        transactionId,\r\n        savepointId,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取事务状态\r\n   * @param transactionId 事务ID\r\n   * @returns 事务上下文\r\n   */\r\n  getTransactionStatus(transactionId: string): TransactionContext | undefined {\r\n    return this.activeTransactions.get(transactionId);\r\n  }\r\n\r\n  /**\r\n   * 获取所有活跃事务\r\n   * @returns 活跃事务列表\r\n   */\r\n  getActiveTransactions(): TransactionContext[] {\r\n    return Array.from(this.activeTransactions.values());\r\n  }\r\n\r\n  /**\r\n   * 获取事务的保存点列表\r\n   * @param transactionId 事务ID\r\n   * @returns 保存点列表\r\n   */\r\n  getTransactionSavepoints(transactionId: string): Savepoint[] {\r\n    const context = this.activeTransactions.get(transactionId);\r\n    if (!context) {\r\n      throw new Error(`Transaction ${transactionId} not found`);\r\n    }\r\n\r\n    return context.getSavepoints();\r\n  }\r\n\r\n  /**\r\n   * 检查事务是否为嵌套事务\r\n   * @param transactionId 事务ID\r\n   * @returns 是否为嵌套事务\r\n   */\r\n  isNestedTransaction(transactionId: string): boolean {\r\n    const context = this.activeTransactions.get(transactionId);\r\n    if (!context) {\r\n      throw new Error(`Transaction ${transactionId} not found`);\r\n    }\r\n\r\n    return context.isNested();\r\n  }\r\n\r\n  /**\r\n   * 获取根事务ID\r\n   * @param transactionId 事务ID\r\n   * @returns 根事务ID\r\n   */\r\n  getRootTransactionId(transactionId: string): string | undefined {\r\n    const context = this.activeTransactions.get(transactionId);\r\n    if (!context) {\r\n      throw new Error(`Transaction ${transactionId} not found`);\r\n    }\r\n\r\n    if (context.isRootTransaction) {\r\n      return context.transactionId;\r\n    }\r\n\r\n    // 递归查找根事务\r\n    let currentContext = context;\r\n    while (currentContext.parentTransactionId) {\r\n      const parentContext = this.activeTransactions.get(\r\n        currentContext.parentTransactionId,\r\n      );\r\n      if (!parentContext) {\r\n        break;\r\n      }\r\n\r\n      if (parentContext.isRootTransaction) {\r\n        return parentContext.transactionId;\r\n      }\r\n\r\n      currentContext = parentContext;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * 清理已完成的事务\r\n   * @param maxAge 最大保留时间（毫秒）\r\n   */\r\n  cleanupCompletedTransactions(\r\n    maxAge: number = this.DEFAULT_CLEANUP_AGE,\r\n  ): void {\r\n    const now = Date.now();\r\n    const transactionsToRemove: string[] = [];\r\n\r\n    for (const [transactionId, context] of this.activeTransactions.entries()) {\r\n      const isCompleted =\r\n        context.status === TransactionStatus.COMMITTED ||\r\n        context.status === TransactionStatus.ROLLED_BACK ||\r\n        context.status === TransactionStatus.FAILED;\r\n\r\n      const isExpired = now - context.startTime > maxAge;\r\n\r\n      if (isCompleted && isExpired) {\r\n        transactionsToRemove.push(transactionId);\r\n      }\r\n    }\r\n\r\n    for (const transactionId of transactionsToRemove) {\r\n      this.activeTransactions.delete(transactionId);\r\n      this.queryRunners.delete(transactionId);\r\n      this.logger.debug('Cleaned up completed transaction', { transactionId });\r\n    }\r\n\r\n    if (transactionsToRemove.length > 0) {\r\n      this.logger.info('Cleaned up completed transactions', {\r\n        count: transactionsToRemove.length,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取QueryRunner实例\r\n   * @param transactionId 事务ID\r\n   * @returns QueryRunner实例\r\n   */\r\n  getQueryRunner(transactionId: string): QueryRunner | undefined {\r\n    return this.queryRunners.get(transactionId);\r\n  }\r\n\r\n  /**\r\n   * 执行操作并返回回滚数据\r\n   * @param operation 事务操作\r\n   * @param transactionId 事务ID\r\n   * @returns 回滚数据\r\n   */\r\n  private async executeOperationWithRollback(\r\n    operation: TransactionOperation,\r\n    transactionId: string,\r\n  ): Promise<unknown> {\r\n    switch (operation.target) {\r\n      case 'collection':\r\n        return this.executeCollectionOperation(operation, transactionId);\r\n      case 'document':\r\n        return this.executeDocumentOperation(operation, transactionId);\r\n      case 'chunk':\r\n        return this.executeChunkOperation(operation, transactionId);\r\n      default:\r\n        throw new Error(`Unsupported operation target: ${operation.target}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 执行集合操作\r\n   * @param operation 事务操作\r\n   * @param transactionId 事务ID\r\n   * @returns 回滚数据\r\n   */\r\n  private async executeCollectionOperation(\r\n    operation: TransactionOperation,\r\n    transactionId: string,\r\n  ): Promise<unknown> {\r\n    const queryRunner = this.queryRunners.get(transactionId);\r\n    if (!queryRunner) {\r\n      throw new Error(`QueryRunner for transaction ${transactionId} not found`);\r\n    }\r\n\r\n    const { type, targetId, data } = operation;\r\n    const collectionId = targetId as CollectionId;\r\n\r\n    try {\r\n      switch (type) {\r\n        case TransactionOperationType.CREATE: {\r\n          // 创建集合操作\r\n          const collectionData = data as { name: string; description?: string };\r\n\r\n          // 获取创建前的状态用于回滚\r\n          const existingCollection = await queryRunner.manager.findOne(\r\n            'Collection',\r\n            {\r\n              where: { id: collectionId },\r\n            },\r\n          );\r\n\r\n          if (existingCollection) {\r\n            throw new Error(`Collection ${collectionId} already exists`);\r\n          }\r\n\r\n          // 在事务中创建集合\r\n          const timestamp = Date.now();\n          const newCollection = await queryRunner.manager.save('Collection', {\n            id: collectionId,\n            collectionId,\n            name: collectionData.name,\n            description: collectionData.description || '',\n            status: 'active',\n            documentCount: 0,\n            chunkCount: 0,\n            created_at: timestamp,\n            updated_at: timestamp,\n          });\n\r\n          this.logger.debug('Collection created in transaction', {\r\n            transactionId,\r\n            collectionId,\r\n            collectionName: collectionData.name,\r\n          });\r\n\r\n          // 返回回滚数据\r\n          return {\r\n            operation: 'create',\r\n            collectionId,\r\n            originalState: null,\r\n            newState: newCollection,\r\n          };\r\n        }\r\n\r\n        case TransactionOperationType.UPDATE: {\r\n          // 更新集合操作\r\n          const updateData = data as { name?: string; description?: string };\r\n\r\n          // 获取更新前的状态用于回滚\r\n          let originalCollection = await queryRunner.manager.findOne(\r\n            'Collection',\r\n            {\r\n              where: { id: collectionId },\r\n            },\r\n          );\r\n          if (\r\n            !originalCollection &&\r\n            operation.data &&\r\n            typeof (operation.data as any).collection === 'object'\r\n          ) {\r\n            originalCollection = (operation.data as any).collection;\r\n          }\r\n\r\n          if (!originalCollection) {\r\n            throw new Error(`Collection ${collectionId} not found`);\r\n          }\r\n\r\n          // 在事务中更新集合\r\n          await queryRunner.manager.update(\r\n            'Collection',\r\n            { collectionId },\r\n            {\r\n              ...(updateData.name && { name: updateData.name }),\r\n              ...(updateData.description !== undefined && {\r\n                description: updateData.description,\r\n              }),\r\n              updated_at: Date.now(),\r\n            },\r\n          );\r\n\r\n          // 获取更新后的状态\r\n          const updatedCollection = await queryRunner.manager.findOne(\r\n            'Collection',\r\n            {\r\n              where: { id: collectionId },\r\n            },\r\n          );\r\n\r\n          this.logger.debug('Collection updated in transaction', {\r\n            transactionId,\r\n            collectionId,\r\n            updateData,\r\n          });\r\n\r\n          // 返回回滚数据\r\n          return {\r\n            operation: 'update',\r\n            collectionId,\r\n            originalState: originalCollection,\r\n            newState: updatedCollection,\r\n          };\r\n        }\r\n\r\n        case TransactionOperationType.DELETE: {\r\n          // 删除集合操作\r\n\r\n          // 获取删除前的状态用于回滚\r\n          let originalCollection = await queryRunner.manager.findOne(\r\n            'Collection',\r\n            {\r\n              where: { id: collectionId },\r\n            },\r\n          );\r\n          if (\r\n            !originalCollection &&\r\n            operation.data &&\r\n            typeof (operation.data as any).collection === 'object'\r\n          ) {\r\n            originalCollection = (operation.data as any).collection;\r\n          }\r\n\r\n          if (!originalCollection) {\r\n            throw new Error(`Collection ${collectionId} not found`);\r\n          }\r\n\r\n          // 在事务中删除集合\r\n          await queryRunner.manager.delete('Collection', { id: collectionId });\r\n\r\n          this.logger.debug('Collection deleted in transaction', {\r\n            transactionId,\r\n            collectionId,\r\n          });\r\n\r\n          // 返回回滚数据\r\n          return {\r\n            operation: 'delete',\r\n            collectionId,\r\n            originalState: originalCollection,\r\n            newState: null,\r\n          };\r\n        }\r\n\r\n        default:\r\n          throw new Error(`Unsupported collection operation type: ${type}`);\r\n      }\r\n    } catch (error) {\r\n      this.logger.error(\r\n        'Failed to execute collection operation in transaction',\r\n        {\r\n          transactionId,\r\n          operation,\r\n          error: error instanceof Error ? error.message : String(error),\r\n        },\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 执行文档操作\r\n   * @param operation 事务操作\r\n   * @param transactionId 事务ID\r\n   * @returns 回滚数据\r\n   */\r\n  private async executeDocumentOperation(\r\n    operation: TransactionOperation,\r\n    transactionId: string,\r\n  ): Promise<unknown> {\r\n    const queryRunner = this.queryRunners.get(transactionId);\r\n    if (!queryRunner) {\r\n      throw new Error(`QueryRunner for transaction ${transactionId} not found`);\r\n    }\r\n\r\n    const { type, targetId, data } = operation;\r\n    const docId = targetId as DocId;\r\n\r\n    try {\r\n      switch (type) {\r\n        case TransactionOperationType.CREATE: {\r\n          // 创建文档操作\r\n          const docData = data as {\r\n            collectionId: CollectionId;\r\n            key: string;\r\n            name: string;\r\n            mime: string;\r\n            size_bytes: number;\r\n            content: string;\r\n          };\r\n\r\n          // 获取创建前的状态用于回滚\r\n          const existingDoc = await queryRunner.manager.findOne('Doc', {\r\n            where: { key: docData.key },\r\n          });\r\n\r\n          if (existingDoc) {\r\n            throw new Error(`Document with key ${docData.key} already exists`);\r\n          }\r\n\r\n          // 在事务中创建文档\r\n          const newDoc = await queryRunner.manager.save('Doc', {\r\n            key: docData.key,\r\n            collectionId: docData.collectionId,\r\n            name: docData.name,\r\n            mime: docData.mime,\r\n            size_bytes: docData.size_bytes,\r\n            content: docData.content,\r\n            deleted: false,\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n          });\r\n\r\n          this.logger.debug('Document created in transaction', {\r\n            transactionId,\r\n            docId,\r\n            docKey: docData.key,\r\n          });\r\n\r\n          // 返回回滚数据\r\n          return {\r\n            operation: 'create',\r\n            docId,\r\n            docKey: docData.key,\r\n            originalState: null,\r\n            newState: newDoc,\r\n          };\r\n        }\r\n\r\n        case TransactionOperationType.UPDATE: {\r\n          // 更新文档操作\r\n          const updateData = data as {\r\n            name?: string;\r\n            content?: string;\r\n            mime?: string;\r\n            size_bytes?: number;\r\n          };\r\n\r\n          // 获取更新前的状态用于回滚\r\n          const originalDoc = await queryRunner.manager.findOne('Doc', {\r\n            where: { key: docId },\r\n          });\r\n\r\n          if (!originalDoc) {\r\n            throw new Error(`Document ${docId} not found`);\r\n          }\r\n\r\n          // 在事务中更新文档\r\n          await queryRunner.manager.update(\r\n            'Doc',\r\n            { key: docId },\r\n            {\r\n              ...(updateData.name && { name: updateData.name }),\r\n              ...(updateData.content !== undefined && {\r\n                content: updateData.content,\r\n              }),\r\n              ...(updateData.mime && { mime: updateData.mime }),\r\n              ...(updateData.size_bytes !== undefined && {\r\n                size_bytes: updateData.size_bytes,\r\n              }),\r\n              updatedAt: new Date(),\r\n            },\r\n          );\r\n\r\n          // 获取更新后的状态\r\n          const updatedDoc = await queryRunner.manager.findOne('Doc', {\r\n            where: { key: docId },\r\n          });\r\n\r\n          this.logger.debug('Document updated in transaction', {\r\n            transactionId,\r\n            docId,\r\n            updateData,\r\n          });\r\n\r\n          // 返回回滚数据\r\n          return {\r\n            operation: 'update',\r\n            docId,\r\n            originalState: originalDoc,\r\n            newState: updatedDoc,\r\n          };\r\n        }\r\n\r\n        case TransactionOperationType.DELETE: {\r\n          // 删除文档操作\r\n\r\n          // 获取删除前的状态用于回滚\r\n          const originalDoc = await queryRunner.manager.findOne('Doc', {\r\n            where: { key: docId },\r\n          });\r\n\r\n          if (!originalDoc) {\r\n            throw new Error(`Document ${docId} not found`);\r\n          }\r\n\r\n          // 在事务中删除文档\r\n          await queryRunner.manager.delete('Doc', { key: docId });\r\n\r\n          this.logger.debug('Document deleted in transaction', {\r\n            transactionId,\r\n            docId,\r\n          });\r\n\r\n          // 返回回滚数据\r\n          return {\r\n            operation: 'delete',\r\n            docId,\r\n            originalState: originalDoc,\r\n            newState: null,\r\n          };\r\n        }\r\n\r\n        default:\r\n          throw new Error(`Unsupported document operation type: ${type}`);\r\n      }\r\n    } catch (error) {\r\n      this.logger.error('Failed to execute document operation in transaction', {\r\n        transactionId,\r\n        operation,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 执行块操作\r\n   * @param operation 事务操作\r\n   * @param transactionId 事务ID\r\n   * @returns 回滚数据\r\n   */\r\n  private async executeChunkOperation(\r\n    operation: TransactionOperation,\r\n    transactionId: string,\r\n  ): Promise<unknown> {\r\n    const queryRunner = this.queryRunners.get(transactionId);\r\n    if (!queryRunner) {\r\n      throw new Error(`QueryRunner for transaction ${transactionId} not found`);\r\n    }\r\n\r\n    const { type, targetId, data } = operation;\r\n    const pointId = targetId as PointId;\r\n\r\n    try {\r\n      switch (type) {\r\n        case TransactionOperationType.CREATE: {\r\n          // 创建块操作\r\n          const chunkData = data as {\r\n            docId: DocId;\r\n            collectionId: CollectionId;\r\n            chunkIndex: number;\r\n            title?: string;\r\n            content: string;\r\n          };\r\n\r\n          // 获取创建前的状态用于回滚\r\n          const existingChunk = await queryRunner.manager.findOne('Chunk', {\r\n            where: { pointId },\r\n          });\r\n\r\n          if (existingChunk) {\r\n            throw new Error(`Chunk ${pointId} already exists`);\r\n          }\r\n\r\n          // 在事务中创建块\r\n          const newChunk = await queryRunner.manager.save('Chunk', {\r\n            pointId,\r\n            docId: chunkData.docId,\r\n            collectionId: chunkData.collectionId,\r\n            chunkIndex: chunkData.chunkIndex,\r\n            title: chunkData.title || '',\r\n            content: chunkData.content,\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n          });\r\n\r\n          this.logger.debug('Chunk created in transaction', {\r\n            transactionId,\r\n            pointId,\r\n            docId: chunkData.docId,\r\n          });\r\n\r\n          // 返回回滚数据\r\n          return {\r\n            operation: 'create',\r\n            pointId,\r\n            originalState: null,\r\n            newState: newChunk,\r\n          };\r\n        }\r\n\r\n        case TransactionOperationType.UPDATE: {\r\n          // 更新块操作\r\n          const updateData = data as {\r\n            title?: string;\r\n            content?: string;\r\n          };\r\n\r\n          // 获取更新前的状态用于回滚\r\n          const originalChunk = await queryRunner.manager.findOne('Chunk', {\r\n            where: { pointId },\r\n          });\r\n\r\n          if (!originalChunk) {\r\n            throw new Error(`Chunk ${pointId} not found`);\r\n          }\r\n\r\n          // 在事务中更新块\r\n          await queryRunner.manager.update(\r\n            'Chunk',\r\n            { pointId },\r\n            {\r\n              ...(updateData.title !== undefined && {\r\n                title: updateData.title,\r\n              }),\r\n              ...(updateData.content !== undefined && {\r\n                content: updateData.content,\r\n              }),\r\n              updatedAt: new Date(),\r\n            },\r\n          );\r\n\r\n          // 获取更新后的状态\r\n          const updatedChunk = await queryRunner.manager.findOne('Chunk', {\r\n            where: { pointId },\r\n          });\r\n\r\n          this.logger.debug('Chunk updated in transaction', {\r\n            transactionId,\r\n            pointId,\r\n            updateData,\r\n          });\r\n\r\n          // 返回回滚数据\r\n          return {\r\n            operation: 'update',\r\n            pointId,\r\n            originalState: originalChunk,\r\n            newState: updatedChunk,\r\n          };\r\n        }\r\n\r\n        case TransactionOperationType.DELETE: {\r\n          // 删除块操作\r\n\r\n          // 获取删除前的状态用于回滚\r\n          const originalChunk = await queryRunner.manager.findOne('Chunk', {\r\n            where: { pointId },\r\n          });\r\n\r\n          if (!originalChunk) {\r\n            throw new Error(`Chunk ${pointId} not found`);\r\n          }\r\n\r\n          // 在事务中删除块\r\n          await queryRunner.manager.delete('Chunk', { pointId });\r\n\r\n          this.logger.debug('Chunk deleted in transaction', {\r\n            transactionId,\r\n            pointId,\r\n          });\r\n\r\n          // 返回回滚数据\r\n          return {\r\n            operation: 'delete',\r\n            pointId,\r\n            originalState: originalChunk,\r\n            newState: null,\r\n          };\r\n        }\r\n\r\n        default:\r\n          throw new Error(`Unsupported chunk operation type: ${type}`);\r\n      }\r\n    } catch (error) {\r\n      this.logger.error('Failed to execute chunk operation in transaction', {\r\n        transactionId,\r\n        operation,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 提交嵌套事务（将操作合并到父事务）\r\n   * @param transactionId 嵌套事务ID\r\n   */\r\n  private async commitNestedTransaction(transactionId: string): Promise<void> {\r\n    const context = this.activeTransactions.get(transactionId);\r\n    if (!context) {\r\n      throw new Error(`Nested transaction ${transactionId} not found`);\r\n    }\r\n\r\n    if (!context.parentTransactionId) {\r\n      throw new Error(\r\n        `Transaction ${transactionId} is not a nested transaction`,\r\n      );\r\n    }\r\n\r\n    const parentContext = this.activeTransactions.get(\r\n      context.parentTransactionId,\r\n    );\r\n    if (!parentContext) {\r\n      throw new Error(\r\n        `Parent transaction ${context.parentTransactionId} not found`,\r\n      );\r\n    }\r\n\r\n    // 将嵌套事务的操作合并到父事务\r\n    for (const operation of context.operations) {\r\n      parentContext.addOperation(operation);\r\n    }\r\n\r\n    // 将嵌套事务的保存点合并到父事务\r\n    for (const [savepointId, savepoint] of context.savepoints) {\r\n      parentContext.savepoints.set(savepointId, savepoint);\r\n    }\r\n\r\n    context.status = TransactionStatus.COMMITTED;\r\n    this.logger.info('Nested transaction committed and merged to parent', {\r\n      transactionId,\r\n      parentTransactionId: context.parentTransactionId,\r\n      operationsMerged: context.operations.length,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 删除集合的事务方法\r\n   * @param collectionId 集合ID\r\n   * @param collections 集合表操作对象\r\n   * @param collections.getById 获取集合方法\r\n   * @param collections.delete 删除集合方法\r\n   * @param collections.chunkMeta 集合元数据操作\r\n   * @param collections.chunkMeta.deleteByCollectionId 按集合ID删除元数据方法\r\n   * @param collections.chunksFts5 全文搜索操作\r\n   * @param collections.chunksFts5.deleteByCollectionId 按集合ID删除全文搜索数据方法\r\n   * @param collections.docs 文档操作\r\n   * @param collections.docs.listByCollection 按集合列出文档方法\r\n   * @param collections.docs.hardDelete 硬删除文档方法\r\n   * @param collections.listAll 列出所有集合方法\r\n   * @returns Promise<void>\r\n   */\r\n  async deleteCollectionInTransaction(\r\n    collectionId: CollectionId,\r\n    collections: {\r\n      getById: (id: CollectionId) => { collectionId: CollectionId } | undefined;\r\n      delete: (id: CollectionId) => void;\r\n      chunkMeta: { deleteByCollectionId: (id: CollectionId) => void };\r\n      chunksFts5: { deleteByCollectionId: (id: CollectionId) => void };\r\n      docs: {\r\n        listByCollection: (id: CollectionId) => Array<{ docId: string }>;\r\n        hardDelete: (id: string) => void;\r\n      };\r\n      listAll: () => { collectionId: CollectionId }[];\r\n    },\r\n  ): Promise<void> {\r\n    return this.executeInTransaction(async (context) => {\r\n      // 验证集合存在\r\n      const collection = collections.getById(collectionId);\r\n      if (!collection) {\r\n        this.logger.warn(\r\n          'deleteCollection: no such collectionId',\r\n          collectionId,\r\n        );\r\n        return;\r\n      }\r\n\r\n      // 记录删除集合操作\r\n      await this.executeOperation(context.transactionId, {\r\n        type: TransactionOperationType.DELETE,\r\n        target: 'collection',\r\n        targetId: collectionId,\r\n        data: { collection },\r\n      });\r\n\r\n      // 获取QueryRunner并在事务中执行所有删除操作\r\n      const queryRunner = this.getQueryRunner(context.transactionId);\r\n      if (!queryRunner) {\r\n        throw new Error(\r\n          `QueryRunner for transaction ${context.transactionId} not found`,\r\n        );\r\n      }\r\n\r\n      // 在TypeORM事务中执行所有删除操作\r\n      await queryRunner.manager.transaction(async (manager) => {\r\n        // 首先，删除与集合关联的所有块及其元数据\r\n        collections.chunkMeta.deleteByCollectionId(collectionId);\r\n        collections.chunksFts5.deleteByCollectionId(collectionId);\r\n\r\n        // 然后，删除集合中的所有文档\r\n        const docsInCollection =\r\n          collections.docs.listByCollection(collectionId);\r\n        for (const doc of docsInCollection) {\r\n          collections.docs.hardDelete(doc.docId);\r\n        }\r\n\r\n        // 最后，删除集合本身\r\n        collections.delete(collectionId);\r\n      });\r\n\r\n      // 异步删除Qdrant中的向量数据（不阻塞事务提交）\r\n      if (this.qdrantRepo) {\r\n        this.qdrantRepo\r\n          .deletePointsByCollection(collectionId)\r\n          .catch((error) => {\r\n            this.logger.warn('Failed to delete Qdrant points for collection', {\r\n              collectionId,\r\n              error: error instanceof Error ? error.message : String(error),\r\n            });\r\n          });\r\n      }\r\n\r\n      this.logger.info(\r\n        `Collection ${collectionId} and its associated data have been deleted.`,\r\n      );\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\middlewares\\logging.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\middlewares\\validate.ts","messages":[{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"opts\" declaration.","line":21,"column":1,"nodeType":"Block","endLine":32,"endColumn":4,"fix":{"range":[433,781],"text":"/**\r\n * 创建一个Express中间件，用于根据 Zod Schema 验证请求数据\r\n * 它会尝试验证 req.body, req.query, req.params\r\n * 验证成功的数据将存储在req.validated 中\r\n * 如果验证失败，将抛出一个错误\r\n *\r\n * @param schema Zod Schema 对象，包含body, query, params 的可选schema\r\n * @param schema.body - 请求体schema\r\n * @param schema.query - 查询参数schema\r\n * @param schema.params - 路径参数schema\r\n * @param opts\n * @param opts.statusCode\n * @returns Express 中间件函数\r\n */"}},{"ruleId":"jsdoc/require-param","severity":1,"message":"Missing JSDoc @param \"opts.statusCode\" declaration.","line":21,"column":1,"nodeType":"Block","endLine":32,"endColumn":4,"fix":{"range":[433,781],"text":"/**\r\n * 创建一个Express中间件，用于根据 Zod Schema 验证请求数据\r\n * 它会尝试验证 req.body, req.query, req.params\r\n * 验证成功的数据将存储在req.validated 中\r\n * 如果验证失败，将抛出一个错误\r\n *\r\n * @param schema Zod Schema 对象，包含body, query, params 的可选schema\r\n * @param schema.body - 请求体schema\r\n * @param schema.query - 查询参数schema\r\n * @param schema.params - 路径参数schema\r\n * @param opts\n * @param opts.statusCode\n * @param opts\n * @param opts.statusCode\n * @returns Express 中间件函数\r\n */"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"import { Request, Response, NextFunction } from 'express';\r\nimport { z, ZodSchema } from 'zod';\r\nimport { AppError, ErrorCode } from '@api/contracts/error.js';\r\n\r\n// 定义一个类型，用于扩展 Express Request 接口\r\n/**\r\n * 扩展的Express请求类型，包含验证后的数据\r\n */\r\nexport type ValidatedRequest<\r\n  Body = unknown,\r\n  Query = unknown,\r\n  Params = unknown,\r\n> = Request & {\r\n  validated?: {\r\n    body?: Body;\r\n    query?: Query;\r\n    params?: Params;\r\n  };\r\n};\r\n\r\n/**\r\n * 创建一个Express中间件，用于根据 Zod Schema 验证请求数据\r\n * 它会尝试验证 req.body, req.query, req.params\r\n * 验证成功的数据将存储在req.validated 中\r\n * 如果验证失败，将抛出一个错误\r\n *\r\n * @param schema Zod Schema 对象，包含body, query, params 的可选schema\r\n * @param schema.body - 请求体schema\r\n * @param schema.query - 查询参数schema\r\n * @param schema.params - 路径参数schema\r\n * @returns Express 中间件函数\r\n */\r\nexport const validate =\r\n  (\r\n    schema: { body?: ZodSchema; query?: ZodSchema; params?: ZodSchema },\r\n    opts?: { statusCode?: number },\r\n  ) =>\r\n  async (req: ValidatedRequest, res: Response, next: NextFunction) => {\r\n    try {\r\n      req.validated = {};\r\n\r\n      if (schema.body) {\r\n        req.validated.body = await schema.body.parseAsync(req.body);\r\n      }\r\n\r\n      if (schema.query) {\r\n        req.validated.query = await schema.query.parseAsync(req.query);\r\n      }\r\n\r\n      if (schema.params) {\r\n        req.validated.params = await schema.params.parseAsync(req.params);\r\n      }\r\n\r\n      next();\r\n    } catch (error) {\r\n      if (error instanceof z.ZodError) {\r\n        const validationErrors = error.errors.map((err) => ({\r\n          path: err.path.join('.'),\r\n          message: err.message,\r\n        }));\r\n        return next(\r\n          new AppError(\r\n            ErrorCode.VALIDATION_ERROR,\r\n            `Validation failed for fields: ${validationErrors.map((e) => e.path).join(', ')}`,\r\n            opts?.statusCode ?? 400,\r\n            { issues: validationErrors },\r\n          ),\r\n        );\r\n      }\r\n      next(error);\r\n    }\r\n  };\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\code\\JS\\Qdrant_MCP_RAG\\Qdrant_Insertor\\packages\\backend\\src\\utils\\pagination.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]